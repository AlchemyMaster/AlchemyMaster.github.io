(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function fe(){}const zt=l=>l;function Vt(l,e){for(const t in e)l[t]=e[t];return l}function Ql(l){return l()}function Xt(){return Object.create(null)}function Ae(l){l.forEach(Ql)}function He(l){return typeof l=="function"}function pe(l,e){return l!=l?e==e:l!==e||l&&typeof l=="object"||typeof l=="function"}let _t;function Ze(l,e){return _t||(_t=document.createElement("a")),_t.href=e,l===_t.href}function mn(l){return Object.keys(l).length===0}function Bt(l,...e){if(l==null)return fe;const t=l.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Le(l,e,t){l.$$.on_destroy.push(Bt(e,t))}function Ye(l,e,t){return l.set(t),e}function at(l){return l&&He(l.destroy)?l.destroy:fe}const $l=typeof window<"u";let en=$l?()=>window.performance.now():()=>Date.now(),Ht=$l?l=>requestAnimationFrame(l):fe;const $e=new Set;function tn(l){$e.forEach(e=>{e.c(l)||($e.delete(e),e.f())}),$e.size!==0&&Ht(tn)}function ln(l){let e;return $e.size===0&&Ht(tn),{promise:new Promise(t=>{$e.add(e={c:l,f:t})}),abort(){$e.delete(e)}}}function m(l,e){l.appendChild(e)}function pn(l){if(!l)return document;const e=l.getRootNode?l.getRootNode():l.ownerDocument;return e&&e.host?e:l.ownerDocument}function hn(l,e){return m(l.head||l,e),e.sheet}function P(l,e,t){l.insertBefore(e,t||null)}function N(l){l.parentNode.removeChild(l)}function Ot(l,e){for(let t=0;t<l.length;t+=1)l[t]&&l[t].d(e)}function w(l){return document.createElement(l)}function Fe(l){return document.createElementNS("http://www.w3.org/2000/svg",l)}function se(l){return document.createTextNode(l)}function j(){return se(" ")}function Je(){return se("")}function te(l,e,t,n){return l.addEventListener(e,t,n),()=>l.removeEventListener(e,t,n)}function v(l,e,t){t==null?l.removeAttribute(e):l.getAttribute(e)!==t&&l.setAttribute(e,t)}function vn(l){return Array.from(l.childNodes)}function he(l,e){e=""+e,l.wholeText!==e&&(l.data=e)}function Kt(l,e){l.value=e==null?"":e}function F(l,e,t,n){t===null?l.style.removeProperty(e):l.style.setProperty(e,t,n?"important":"")}function K(l,e,t){l.classList[t?"add":"remove"](e)}function nn(l,e,{bubbles:t=!1,cancelable:n=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(l,t,n,e),i}const yt=new Map;let kt=0;function bn(l){let e=5381,t=l.length;for(;t--;)e=(e<<5)-e^l.charCodeAt(t);return e>>>0}function wn(l){const e={style_element:w("style"),rules:{}};return yt.set(l,e),e}function Zt(l,e,t,n,i,s,r,o=0){const a=16.666/n;let f=`{
`;for(let b=0;b<=1;b+=a){const y=e+(t-e)*s(b);f+=b*100+`%{${r(y,1-y)}}
`}const c=f+`100% {${r(t,1-t)}}
}`,p=`__svelte_${bn(c)}_${o}`,_=pn(l),{style_element:u,rules:d}=yt.get(_)||wn(_);if(!d[p]){const b=hn(_,u);d[p]=!0,b.insertRule(`@keyframes ${p} ${c}`,b.cssRules.length)}const g=l.style.animation||"";return l.style.animation=`${g?`${g}, `:""}${p} ${n}ms linear ${i}ms 1 both`,kt+=1,p}function yn(l,e){const t=(l.style.animation||"").split(", "),n=t.filter(e?s=>s.indexOf(e)<0:s=>s.indexOf("__svelte")===-1),i=t.length-n.length;i&&(l.style.animation=n.join(", "),kt-=i,kt||kn())}function kn(){Ht(()=>{kt||(yt.forEach(l=>{const{style_element:e}=l;N(e)}),yt.clear())})}let ot;function it(l){ot=l}function Rt(){if(!ot)throw new Error("Function called outside component initialization");return ot}function Sn(l){Rt().$$.on_mount.push(l)}function Be(l){Rt().$$.on_destroy.push(l)}function Ln(){const l=Rt();return(e,t,{cancelable:n=!1}={})=>{const i=l.$$.callbacks[e];if(i){const s=nn(e,t,{cancelable:n});return i.slice().forEach(r=>{r.call(l,s)}),!s.defaultPrevented}return!0}}function Mn(l,e){const t=l.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const st=[],xe=[],bt=[],At=[],Tn=Promise.resolve();let jt=!1;function On(){jt||(jt=!0,Tn.then(sn))}function Ee(l){bt.push(l)}function St(l){At.push(l)}const Ct=new Set;let gt=0;function sn(){const l=ot;do{for(;gt<st.length;){const e=st[gt];gt++,it(e),Dn(e.$$)}for(it(null),st.length=0,gt=0;xe.length;)xe.pop()();for(let e=0;e<bt.length;e+=1){const t=bt[e];Ct.has(t)||(Ct.add(t),t())}bt.length=0}while(st.length);for(;At.length;)At.pop()();jt=!1,Ct.clear(),it(l)}function Dn(l){if(l.fragment!==null){l.update(),Ae(l.before_update);const e=l.dirty;l.dirty=[-1],l.fragment&&l.fragment.p(l.ctx,e),l.after_update.forEach(Ee)}}let nt;function In(){return nt||(nt=Promise.resolve(),nt.then(()=>{nt=null})),nt}function Et(l,e,t){l.dispatchEvent(nn(`${e?"intro":"outro"}${t}`))}const wt=new Set;let qe;function we(){qe={r:0,c:[],p:qe}}function ye(){qe.r||Ae(qe.c),qe=qe.p}function E(l,e){l&&l.i&&(wt.delete(l),l.i(e))}function G(l,e,t,n){if(l&&l.o){if(wt.has(l))return;wt.add(l),qe.c.push(()=>{wt.delete(l),n&&(t&&l.d(1),n())}),l.o(e)}else n&&n()}const Cn={duration:0};function Se(l,e,t,n){let i=e(l,t),s=n?0:1,r=null,o=null,a=null;function f(){a&&yn(l,a)}function c(_,u){const d=_.b-s;return u*=Math.abs(d),{a:s,b:_.b,d,duration:u,start:_.start,end:_.start+u,group:_.group}}function p(_){const{delay:u=0,duration:d=300,easing:g=zt,tick:b=fe,css:y}=i||Cn,h={start:en()+u,b:_};_||(h.group=qe,qe.r+=1),r||o?o=h:(y&&(f(),a=Zt(l,s,_,d,u,g,y)),_&&b(0,1),r=c(h,d),Ee(()=>Et(l,_,"start")),ln(S=>{if(o&&S>o.start&&(r=c(o,d),o=null,Et(l,r.b,"start"),y&&(f(),a=Zt(l,s,r.b,r.duration,0,g,i.css))),r){if(S>=r.end)b(s=r.b,1-s),Et(l,r.b,"end"),o||(r.b?f():--r.group.r||Ae(r.group.c)),r=null;else if(S>=r.start){const T=S-r.start;s=r.a+r.d*g(T/r.duration),b(s,1-s)}}return!!(r||o)}))}return{run(_){He(i)?In().then(()=>{i=i(),p(_)}):p(_)},end(){f(),r=o=null}}}const En=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function rn(l,e){l.d(1),e.delete(l.key)}function et(l,e){G(l,1,1,()=>{e.delete(l.key)})}function Xe(l,e,t,n,i,s,r,o,a,f,c,p){let _=l.length,u=s.length,d=_;const g={};for(;d--;)g[l[d].key]=d;const b=[],y=new Map,h=new Map;for(d=u;d--;){const k=p(i,s,d),C=t(k);let I=r.get(C);I?n&&I.p(k,e):(I=f(C,k),I.c()),y.set(C,b[d]=I),C in g&&h.set(C,Math.abs(d-g[C]))}const S=new Set,T=new Set;function M(k){E(k,1),k.m(o,c),r.set(k.key,k),c=k.first,u--}for(;_&&u;){const k=b[u-1],C=l[_-1],I=k.key,A=C.key;k===C?(c=k.first,_--,u--):y.has(A)?!r.has(I)||S.has(I)?M(k):T.has(A)?_--:h.get(I)>h.get(A)?(T.add(I),M(k)):(S.add(A),_--):(a(C,r),_--)}for(;_--;){const k=l[_];y.has(k.key)||a(k,r)}for(;u;)M(b[u-1]);return b}function Lt(l,e,t){const n=l.$$.props[e];n!==void 0&&(l.$$.bound[n]=t,t(l.$$.ctx[n]))}function ge(l){l&&l.c()}function ue(l,e,t,n){const{fragment:i,on_mount:s,on_destroy:r,after_update:o}=l.$$;i&&i.m(e,t),n||Ee(()=>{const a=s.map(Ql).filter(He);r?r.push(...a):Ae(a),l.$$.on_mount=[]}),o.forEach(Ee)}function de(l,e){const t=l.$$;t.fragment!==null&&(Ae(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function An(l,e){l.$$.dirty[0]===-1&&(st.push(l),On(),l.$$.dirty.fill(0)),l.$$.dirty[e/31|0]|=1<<e%31}function ve(l,e,t,n,i,s,r,o=[-1]){const a=ot;it(l);const f=l.$$={fragment:null,ctx:null,props:s,update:fe,not_equal:i,bound:Xt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:Xt(),dirty:o,skip_bound:!1,root:e.target||a.$$.root};r&&r(f.root);let c=!1;if(f.ctx=t?t(l,e.props||{},(p,_,...u)=>{const d=u.length?u[0]:_;return f.ctx&&i(f.ctx[p],f.ctx[p]=d)&&(!f.skip_bound&&f.bound[p]&&f.bound[p](d),c&&An(l,p)),_}):[],f.update(),c=!0,Ae(f.before_update),f.fragment=n?n(f.ctx):!1,e.target){if(e.hydrate){const p=vn(e.target);f.fragment&&f.fragment.l(p),p.forEach(N)}else f.fragment&&f.fragment.c();e.intro&&E(l.$$.fragment),ue(l,e.target,e.anchor,e.customElement),sn()}it(a)}class be{$destroy(){de(this,1),this.$destroy=fe}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!mn(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function on(l){const e=l-1;return e*e*e+1}function Ie(l,{delay:e=0,duration:t=400,easing:n=zt}={}){const i=+getComputedStyle(l).opacity;return{delay:e,duration:t,easing:n,css:s=>`opacity: ${s*i}`}}function Mt(l,{delay:e=0,duration:t=400,easing:n=on}={}){const i=getComputedStyle(l),s=+i.opacity,r=parseFloat(i.height),o=parseFloat(i.paddingTop),a=parseFloat(i.paddingBottom),f=parseFloat(i.marginTop),c=parseFloat(i.marginBottom),p=parseFloat(i.borderTopWidth),_=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:u=>`overflow: hidden;opacity: ${Math.min(u*20,1)*s};height: ${u*r}px;padding-top: ${u*o}px;padding-bottom: ${u*a}px;margin-top: ${u*f}px;margin-bottom: ${u*c}px;border-top-width: ${u*p}px;border-bottom-width: ${u*_}px;`}}const Qe=[];function Re(l,e=fe){let t;const n=new Set;function i(o){if(pe(l,o)&&(l=o,t)){const a=!Qe.length;for(const f of n)f[1](),Qe.push(f,l);if(a){for(let f=0;f<Qe.length;f+=2)Qe[f][0](Qe[f+1]);Qe.length=0}}}function s(o){i(o(l))}function r(o,a=fe){const f=[o,a];return n.add(f),n.size===1&&(t=e(i)||fe),o(l),()=>{n.delete(f),n.size===0&&(t(),t=null)}}return{set:i,update:s,subscribe:r}}const rt=()=>{},Nt=l=>new Promise(e=>setTimeout(e,l)),Pe=(l,e,t)=>Math.min(t,Math.max(l,e)),Gt=(l={})=>(Object.assign(l,{promise:new Promise((e,t)=>Object.assign(l,{resolve:e,reject:t}))}),l),Ft=(l,e)=>{try{if(l===e)return!0;const t=typeof l;if(t!==typeof e)return!1;switch(t){case"undefined":case"boolean":case"bigint":case"symbol":case"string":return l===e;case"number":return isNaN(l)&&isNaN(e)?!0:l===e}if(l===null||e===null)return l===e;if(t!=="object")return!1;if(Array.isArray(l)&&Array.isArray(e))return l.length!==e.length?!1:l.every((o,a)=>Ft(o,e[a]));const i=Object.entries(l),s=Object.entries(e);if(i.length!==s.length)return!1;const r=new Map(s);return i.every(([o,a])=>!(!r.has(o)||!Ft(a,r.get(o))))}catch{}return!1},jn=l=>{let e=!1,t=[];const n=async i=>{e=!0;let s,r,o;try{s=await l()}catch(a){o=!0,r=a}if(i.map(a=>{o&&a.reject(r),a.resolve(s)}),t.length){const a=t;return t=[],n(a)}e=!1};return()=>{const i=Gt();return e?t.push(i):(e=!0,n([i])),i.promise}},Nn=l=>{const e=Gt();return setTimeout(e.resolve,l),e},Fn=Symbol("RangeLoadList_ItemLastUpdateTime"),Pn=l=>{var J,le,re,ie;const e=Pe(1,((J=l.updateInterval)!=null?J:1e3)|0,36e5),t=Pe(1,((le=l.maxLimit)!=null?le:50)|0,1e3);let n=l.fLoad;const i=(re=l.onUpdateItem)!=null?re:rt,s=(ie=l.onUpdateItemList)!=null?ie:rt,r=!!l.isLoadEnd,o=Fn,a={},f=Re(null),c={subscribe:f.subscribe};let p=0,_=t,u=null;const d=x=>n=x,g=async(x,X)=>{try{const ce=await n({offset:x,limit:X});if(typeof ce.count=="number"&&Array.isArray(ce.results))return ce}catch{}return null},b=async(x,X)=>{const ce=await g(x,X);if(ce){const q=ce.results,oe=Math.max(0,ce.count|0),B=u!==oe,D=Date.now();u=oe;const R=[];for(let V=0,Q=x;V<q.length&&Q<u;V++,Q++){const Te=q[V];a[Q]!==void 0&&Ft(a[Q],Te)||(Te[o]=D,a[Q]=Te,i(Te),R.push(Te))}R.length&&s(R),(B||R.length)&&f.set({total:u,list:a})}},y=async x=>{const X=[];X.push(b(p,_)),u!==null&&p+_<u&&r&&X.push(b(u,t)),await Promise.all(X),u!==null&&p+_<u&&r&&x&&await b(u,t)};let h=!1,S=!0,T,M=1;return(async()=>{let x=0;for(;S;){for(;S&&!h;){const X=M;if(await y(x++===0),X===M)break}T=Nn(e),await T.promise}})(),{setFLoad:d,update:()=>{M++,T&&T.resolve()},setRange:(x,X)=>{p=Math.max(0,x|0),_=Pe(0,X|0,t)},destroy:()=>S=!1,getData_r:()=>c,symbolUpdateTime:o,pause:()=>h=!0,resume:()=>h=!1}},xn=async l=>{const e=t=>{const n=document.createElement("textarea");n.value=t,n.style.top="0",n.style.left="0",n.style.position="fixed",document.body.appendChild(n),n.focus(),n.select();let i=!1;try{i=!!document.execCommand("copy")}catch(s){console.error("Fallback: Oops, unable to copy",s)}return document.body.removeChild(n),i};try{return navigator.clipboard?(await navigator.clipboard.writeText(l),!0):e(l)}catch(t){console.error(t)}return!1},ft=(l,e,t=!0)=>{let n=!0;return(async()=>{for(t&&await Nt(l);n;){try{await e()}catch(i){console.error("setIntervalAwait error",i)}await Nt(l)}})(),()=>n=!1},an=()=>{let l=new Map;try{l=new Map([...new URLSearchParams(location.hash.replace(/^\#/,""))])}catch{}return l},Ut=()=>{const l={};return{on:(n,i)=>{var o;const s={event:n,cb:i},r=l[n]=(o=l[n])!=null?o:[];return r.push(s),()=>{const a=r.findIndex(f=>f===s);a!==-1&&r.splice(a,1)}},emit:(n,...i)=>{var s;return((s=l[n])!=null?s:[]).map(r=>r.cb(...i))}}},fn=(l,e="file-")=>{const t=document.createElement("a");t.href=l;const n=e+t.pathname.split(/[^a-zA-Z0-9\.\-_]/).pop();t.download=n,t.target="blank",document.body.appendChild(t),t.click(),document.body.removeChild(t)},Pt=l=>fn(l,"image-"),zn=l=>{try{if(typeof l.message=="string")return l.message}catch{}return""},Tt=Re(null),cn=Tt.set,mt=(l,e)=>{const{subscribe:t,set:n,update:i}=Re(l);return[{subscribe:t},s=>{n(s),e&&e(s)}]},Bn=(l,e)=>{const{subscribe:t,set:n,update:i}=Re(l);return[{subscribe:t},i]},Hn=l=>parseInt(l.id);function Rn(l,e,t){var oe;const n={},i={...e};Object.assign(n,{appConfig:i}),Object.assign(n,{api:t});const s=Ut();Object.assign(n,{events:s});const r=[],o=B=>r.push(B);Object.assign(n,{destroy:()=>r.map(B=>B())});const f=l,[c]=mt(f),[p,_]=mt(null);let u=0;const[d,g]=mt(u),b=jn(t.operatorSelf_GetOnlineInfo),y=async()=>{g(++u);const B=await b();return B&&_(B),g(--u),B};Object.assign(n,{operatorSelf_r:c,operatorSelfLastOnlineInfo_r:p,operatorSelfLastOnlineInfo_Update:y,operatorSelfLastOnline_SetOnlineFlag:async B=>{g(++u);const D=await t.operatorSelf_SetOnlineFlag(B);return D&&_(D),g(--u),D},operatorSelfLastOnlineInfoLoading_r:d});const S=Object.create(null),[T,M]=Bn(S),k=B=>{!B.length||M(D=>{for(const R of B)D[Hn(R)]=R;return D})},C=B=>k([B]),[I,A]=mt(null);Object.assign(n,{dialogMap_r:T,dialogMap_SetDialogList:k,dialogMap_SetDialog:C,dialogActiveID_r:I,dialogActiveID_Set:A});const U=Object.fromEntries(i==null?void 0:i.lead_StatusList.map(B=>[B.id,B])),Y=Object.entries((oe=i==null?void 0:i.lead_StatusJumpMap)!=null?oe:{}).reduce((B,[D,R])=>(R.map(V=>{var Q;return(B[V]=(Q=B[V])!=null?Q:[]).push(D)}),B),{}),Z=B=>{var R,V,Q;const D=X(B);return{id:B,title:(R=D==null?void 0:D.title)!=null?R:D!=null&&D.id?`#${D==null?void 0:D.id}`:"*UNK*",bgColor:(V=D==null?void 0:D.bgColor)!=null?V:"#000",color:(Q=D==null?void 0:D.color)!=null?Q:"#fff"}},J=B=>Z(B==null?void 0:B.status),le=B=>{var D;try{return(D=i.lead_StatusGetID(B))!=null?D:null}catch{}return null},re=(B,D)=>{var R;try{return(R=i.lead_StatusPrevIDResolve(B,D))!=null?R:null}catch{}return null},ie=(B,D)=>{try{const R=Y==null?void 0:Y[B],V=(R==null?void 0:R.length)===1?R==null?void 0:R[0]:(R==null?void 0:R.length)>1?re(B,D):null,Q=U==null?void 0:U[V];return Q&&!(Q!=null&&Q.stopPrevSearch)?V:null}catch{}return null},x=B=>{let D=le(B);const R=[D];for(;D=ie(D,B),B=null,!!D;)R.unshift(D);return R.map(Z).filter(Boolean)},X=B=>{var D,R;return(R=((D=e==null?void 0:e.lead_StatusList)!=null?D:[]).find(V=>V.id===B))!=null?R:null};return Object.assign(n,{lead_GetStatusOrDefault:J,lead_GetStatusByID:X,lead_GetStatusTitle:B=>{var D,R;return(R=(D=X(B))==null?void 0:D.title)!=null?R:B},lead_GetStatusList:B=>{var D;return((D=e==null?void 0:e.lead_StatusList)!=null?D:[]).filter(R=>R.access==="user").filter(R=>R.id!==B).filter(R=>R.id!=="DL")},lead_GetStatusID:le,lead_StatusPrevIDResolve:re,lead_GetStatusPrevID:ie,lead_GetStatusHistory:x}),o(ft(e.updateIntervals.sync_online_info,y,!1)),Object.freeze(n),n}function Qt(l){let e,t,n;return{c(){e=w("div"),e.textContent="Operators",v(e,"class","item cursor_ptr svelte-vbcb9r"),K(e,"active",l[0]==="operators"),K(e,"disabled",l[1].has("operators"))},m(i,s){P(i,e,s),t||(n=te(e,"click",l[3]("operators")),t=!0)},p(i,s){s&1&&K(e,"active",i[0]==="operators"),s&2&&K(e,"disabled",i[1].has("operators"))},d(i){i&&N(e),t=!1,n()}}}function $t(l){let e,t=l[2].username+"",n,i,s;return{c(){e=w("div"),n=se(t),v(e,"class","item cursor_ptr notHover nowrap textOverEllipsis svelte-vbcb9r"),F(e,"max-width","200px")},m(r,o){P(r,e,o),m(e,n),s=!0},p(r,o){(!s||o&4)&&t!==(t=r[2].username+"")&&he(n,t)},i(r){s||(Ee(()=>{i||(i=Se(e,Ie,{},!0)),i.run(1)}),s=!0)},o(r){i||(i=Se(e,Ie,{},!1)),i.run(0),s=!1},d(r){r&&N(e),r&&i&&i.end()}}}function Gn(l){let e,t,n,i,s,r,o=!l[2]&&Qt(l),a=l[2]&&0,f=l[2]&&$t(l);return{c(){e=w("div"),o&&o.c(),t=j(),a&&a.c(),n=j(),i=w("div"),s=j(),f&&f.c(),v(i,"class","flex flex_grow_1"),v(e,"class","flex flex_cy w100 list unselect svelte-vbcb9r")},m(c,p){P(c,e,p),o&&o.m(e,null),m(e,t),a&&a.m(e,null),m(e,n),m(e,i),m(e,s),f&&f.m(e,null),r=!0},p(c,[p]){c[2]?o&&(o.d(1),o=null):o?o.p(c,p):(o=Qt(c),o.c(),o.m(e,t)),c[2],a&&(a.d(1),a=null),c[2]?f?(f.p(c,p),p&4&&E(f,1)):(f=$t(c),f.c(),E(f,1),f.m(e,null)):f&&(we(),G(f,1,1,()=>{f=null}),ye())},i(c){r||(E(f),r=!0)},o(c){G(f),r=!1},d(c){c&&N(e),o&&o.d(),a&&a.d(),f&&f.d()}}}function Un(l,e,t){let n;Le(l,Tt,o=>t(2,n=o));let{select:i=""}=e,{disabled:s=new Set}=e;s.add("newLeads"),s.add("myLeads");const r=o=>a=>{s.has(o)||t(0,i=o)};return l.$$set=o=>{"select"in o&&t(0,i=o.select),"disabled"in o&&t(1,s=o.disabled)},[i,s,n,r]}class qn extends be{constructor(e){super(),ve(this,e,Un,Gn,pe,{select:0,disabled:1})}}function el(l,e,t){const n=l.slice();return n[4]=e[t],n}function tl(l,e,t){const n=l.slice();return n[7]=e[t],n}function ll(l){let e,t=l[7].text+"",n,i;return{c(){e=w("div"),n=se(t),i=se("\xA0"),v(e,"class","text svelte-13s1vua"),F(e,"color",l[7].color)},m(s,r){P(s,e,r),m(e,n),P(s,i,r)},p(s,r){r&2&&t!==(t=s[7].text+"")&&he(n,t),r&2&&F(e,"color",s[7].color)},d(s){s&&N(e),s&&N(i)}}}function nl(l){let e,t,n=l[4].chunks,i=[];for(let s=0;s<n.length;s+=1)i[s]=ll(tl(l,n,s));return{c(){e=w("div");for(let s=0;s<i.length;s+=1)i[s].c();t=j(),v(e,"class","flex flex_cy line svelte-13s1vua"),K(e,"mini",l[4].type==="mini")},m(s,r){P(s,e,r);for(let o=0;o<i.length;o+=1)i[o].m(e,null);m(e,t)},p(s,r){if(r&2){n=s[4].chunks;let o;for(o=0;o<n.length;o+=1){const a=tl(s,n,o);i[o]?i[o].p(a,r):(i[o]=ll(a),i[o].c(),i[o].m(e,t))}for(;o<i.length;o+=1)i[o].d(1);i.length=n.length}r&2&&K(e,"mini",s[4].type==="mini")},d(s){s&&N(e),Ot(i,s)}}}function Yn(l){let e,t,n,i=l[1],s=[];for(let r=0;r<i.length;r+=1)s[r]=nl(el(l,i,r));return{c(){e=w("div");for(let r=0;r<s.length;r+=1)s[r].c();v(e,"class","flex flex_clm notify svelte-13s1vua"),K(e,"normal",l[0]==="normal"),K(e,"error",l[0]==="error"),K(e,"debug",l[0]==="debug")},m(r,o){P(r,e,o);for(let a=0;a<s.length;a+=1)s[a].m(e,null);n=!0},p(r,[o]){if(o&2){i=r[1];let a;for(a=0;a<i.length;a+=1){const f=el(r,i,a);s[a]?s[a].p(f,o):(s[a]=nl(f),s[a].c(),s[a].m(e,null))}for(;a<s.length;a+=1)s[a].d(1);s.length=i.length}(!n||o&1)&&K(e,"normal",r[0]==="normal"),(!n||o&1)&&K(e,"error",r[0]==="error"),(!n||o&1)&&K(e,"debug",r[0]==="debug")},i(r){n||(r&&Ee(()=>{t||(t=Se(e,Mt,{},!0)),t.run(1)}),n=!0)},o(r){r&&(t||(t=Se(e,Mt,{},!1)),t.run(0)),n=!1},d(r){r&&N(e),Ot(s,r),r&&t&&t.end()}}}function Wn(l,e,t){let{notify:n}=e,i="normal",s=[];const r=()=>{t(0,i=n==null?void 0:n.type),t(1,s=[]),Array.isArray(n==null?void 0:n.data)&&t(1,s=n.data.filter(Boolean).map(o=>{let a="normal",f=[];return typeof o=="string"?f.push({color:"#fff",text:o}):(a=o.type,f=o.chunks?o.chunks:[{color:"#fff",text:o.text}]),f=f.filter(c=>c.text),{type:a,chunks:f}}).filter(o=>o.chunks.length))};return l.$$set=o=>{"notify"in o&&t(2,n=o.notify)},l.$$.update=()=>{l.$$.dirty&4&&r()},[i,s,n]}class Jn extends be{constructor(e){super(),ve(this,e,Wn,Yn,pe,{notify:2})}}function sl(l,e,t){const n=l.slice();return n[4]=e[t],n}function il(l,e){let t,n,i;return n=new Jn({props:{notify:e[4]}}),{key:l,first:null,c(){t=Je(),ge(n.$$.fragment),this.first=t},m(s,r){P(s,t,r),ue(n,s,r),i=!0},p(s,r){e=s;const o={};r&1&&(o.notify=e[4]),n.$set(o)},i(s){i||(E(n.$$.fragment,s),i=!0)},o(s){G(n.$$.fragment,s),i=!1},d(s){s&&N(t),de(n,s)}}}function Vn(l){let e,t=[],n=new Map,i,s=l[0];const r=o=>o[4].id;for(let o=0;o<s.length;o+=1){let a=sl(l,s,o),f=r(a);n.set(f,t[o]=il(f,a))}return{c(){e=w("div");for(let o=0;o<t.length;o+=1)t[o].c();v(e,"class","pos_abs notify_list svelte-11tn2wf")},m(o,a){P(o,e,a);for(let f=0;f<t.length;f+=1)t[f].m(e,null);i=!0},p(o,[a]){a&1&&(s=o[0],we(),t=Xe(t,a,r,1,o,s,n,e,et,il,null,sl),ye())},i(o){if(!i){for(let a=0;a<s.length;a+=1)E(t[a]);i=!0}},o(o){for(let a=0;a<t.length;a+=1)G(t[a]);i=!1},d(o){o&&N(e);for(let a=0;a<t.length;a+=1)t[a].d()}}}const Xn=5e3;function Kn(l,e,t){let{events:n=Ut()}=e,i=1,s=[];const r=o=>a=>{s.push({id:i++,time:Date.now(),type:o,data:a}),t(0,s)};return Be(ft(1e3,()=>{const o=Date.now(),a=s.filter(f=>f.time+Xn>=o);a.length!==s.length&&t(0,s=a)})),Be(n.on("error",r("error"))),an().has("debug")&&Be(n.on("debug",r("debug"))),l.$$set=o=>{"events"in o&&t(1,n=o.events)},[s,n]}class Zn extends be{constructor(e){super(),ve(this,e,Kn,Vn,pe,{events:1})}}function rl(l){return Object.prototype.toString.call(l)==="[object Date]"}function xt(l,e){if(l===e||l!==l)return()=>l;const t=typeof l;if(t!==typeof e||Array.isArray(l)!==Array.isArray(e))throw new Error("Cannot interpolate values of different type");if(Array.isArray(l)){const n=e.map((i,s)=>xt(l[s],i));return i=>n.map(s=>s(i))}if(t==="object"){if(!l||!e)throw new Error("Object cannot be null");if(rl(l)&&rl(e)){l=l.getTime(),e=e.getTime();const s=e-l;return r=>new Date(l+r*s)}const n=Object.keys(e),i={};return n.forEach(s=>{i[s]=xt(l[s],e[s])}),s=>{const r={};return n.forEach(o=>{r[o]=i[o](s)}),r}}if(t==="number"){const n=e-l;return i=>l+i*n}throw new Error(`Cannot interpolate ${t} values`)}function We(l,e={}){const t=Re(l);let n,i=l;function s(r,o){if(l==null)return t.set(l=r),Promise.resolve();i=r;let a=n,f=!1,{delay:c=0,duration:p=400,easing:_=zt,interpolate:u=xt}=Vt(Vt({},e),o);if(p===0)return a&&(a.abort(),a=null),t.set(l=i),Promise.resolve();const d=en()+c;let g;return n=ln(b=>{if(b<d)return!0;f||(g=u(l,r),typeof p=="function"&&(p=p(l,r)),f=!0),a&&(a.abort(),a=null);const y=b-d;return y>p?(t.set(l=r),!1):(t.set(l=g(_(y/p))),!0)}),n.promise}return{set:s,update:(r,o)=>s(r(i,l),o),subscribe:t.subscribe}}function Qn(l){let e,t,n,i,s,r,o,a,f;return{c(){e=w("div"),t=w("div"),n=w("div"),i=j(),s=w("div"),r=j(),o=w("div"),a=j(),f=w("div"),v(n,"class","pos_abs s1 svelte-fxby3d"),v(s,"class","pos_abs s2 svelte-fxby3d"),v(o,"class","pos_abs s3 svelte-fxby3d"),v(f,"class","pos_abs s4 svelte-fxby3d"),v(t,"class","flex pos_rel ellipsis svelte-fxby3d"),F(t,"transform","scale("+l[1]+")"),v(e,"class","flex"),F(e,"height",l[0]+"px"),F(e,"width",l[2]+"px")},m(c,p){P(c,e,p),m(e,t),m(t,n),m(t,i),m(t,s),m(t,r),m(t,o),m(t,a),m(t,f)},p(c,[p]){p&2&&F(t,"transform","scale("+c[1]+")"),p&1&&F(e,"height",c[0]+"px"),p&4&&F(e,"width",c[2]+"px")},i:fe,o:fe,d(c){c&&N(e)}}}function $n(l,e,t){let n,i,{height:s=5}=e;return l.$$set=r=>{"height"in r&&t(0,s=r.height)},l.$$.update=()=>{l.$$.dirty&1&&t(2,n=s/.1625),l.$$.dirty&1&&t(1,i=s/13)},[s,i,n]}class un extends be{constructor(e){super(),ve(this,e,$n,Qn,pe,{height:0})}}function ol(l){let e,t,n,i;return t=new un({props:{height:6}}),{c(){e=w("div"),ge(t.$$.fragment),v(e,"class","flex pos_abs loading svelte-15wz55f")},m(s,r){P(s,e,r),ue(t,e,null),i=!0},i(s){i||(E(t.$$.fragment,s),s&&Ee(()=>{n||(n=Se(e,Ie,{},!0)),n.run(1)}),i=!0)},o(s){G(t.$$.fragment,s),s&&(n||(n=Se(e,Ie,{},!1)),n.run(0)),i=!1},d(s){s&&N(e),de(t),s&&n&&n.end()}}}function es(l){let e,t,n,i,s,r,o,a,f,c,p,_,u,d=l[0]&&ol();return{c(){e=w("div"),t=w("div"),n=j(),i=w("div"),i.textContent="offline",s=j(),r=w("div"),o=se(`online\r
		`),a=w("div"),f=se(l[2]),c=j(),d&&d.c(),v(t,"class","pos_abs h100 onlineProgressTrumb svelte-15wz55f"),F(t,"width",l[1]+"%"),v(i,"class","flex flex_cx flex_cy pos_abs w100 h100 onlineProgressTrackLabel label2 svelte-15wz55f"),K(i,"hideR",l[1]>=1),v(a,"class","pos_abs onlineProgressTrumbLastTime svelte-15wz55f"),v(r,"class","flex flex_cx flex_cy pos_abs w100 h100 onlineProgressTrackLabel  svelte-15wz55f"),K(r,"hideL",l[1]<1),v(e,"class","flex flex_cx flex_cy flex_grow_1 onlineProgressTrack pos_rel overhide unselect cursor_ptr svelte-15wz55f")},m(g,b){P(g,e,b),m(e,t),m(e,n),m(e,i),m(e,s),m(e,r),m(r,o),m(r,a),m(a,f),m(e,c),d&&d.m(e,null),p=!0,_||(u=te(e,"click",l[8]),_=!0)},p(g,[b]){(!p||b&2)&&F(t,"width",g[1]+"%"),(!p||b&2)&&K(i,"hideR",g[1]>=1),(!p||b&4)&&he(f,g[2]),(!p||b&2)&&K(r,"hideL",g[1]<1),g[0]?d?b&1&&E(d,1):(d=ol(),d.c(),E(d,1),d.m(e,null)):d&&(we(),G(d,1,1,()=>{d=null}),ye())},i(g){p||(E(d),p=!0)},o(g){G(d),p=!1},d(g){g&&N(e),d&&d.d(),_=!1,u()}}}function ts(l,e,t){let n,i,s,{endTime:r=0}=e,{intervalTime:o=1}=e,{loading:a=!1}=e;const f=We(0);Le(l,f,d=>t(7,s=d));let c=0;function p(){const d=Math.max(0,r-Date.now());t(1,c=Math.floor(Pe(0,d/o,1)*100)),Ye(f,s=Math.ceil(d/1e3),s)}Be(ft(1e3,p));const _=d=>{const g=Math.floor(d%60);d/=60;const b=Math.floor(d%60);d/=60;const y=Math.floor(d),h=[];return(h.length||y)&&h.push(`${String(y).padStart(h.length?2:1,"0")}h`),(h.length||b)&&h.push(`${String(b).padStart(h.length?2:1,"0")}m`),(h.length||g)&&h.push(`${String(g).padStart(h.length?2:1,"0")}s`),h.join(" ")};function u(d){Mn.call(this,l,d)}return l.$$set=d=>{"endTime"in d&&t(4,r=d.endTime),"intervalTime"in d&&t(5,o=d.intervalTime),"loading"in d&&t(0,a=d.loading)},l.$$.update=()=>{l.$$.dirty&128&&t(6,n=Math.ceil(s)),l.$$.dirty&64&&t(2,i=_(n))},[a,c,i,f,r,o,n,s,u]}class ls extends be{constructor(e){super(),ve(this,e,ts,es,pe,{endTime:4,intervalTime:5,loading:0})}}function ns(l){let e;return{c(){e=se("\xA0")},m(t,n){P(t,e,n)},p:fe,d(t){t&&N(e)}}}function ss(l){let e,t=l[2].username+"",n;return{c(){e=se("@"),n=se(t)},m(i,s){P(i,e,s),P(i,n,s)},p(i,s){s&4&&t!==(t=i[2].username+"")&&he(n,t)},d(i){i&&N(e),i&&N(n)}}}function is(l){var le,re;let e,t,n,i,s=((le=l[2].first_name)!=null?le:"")+"",r,o,a,f,c,p=((re=l[2].last_name)!=null?re:"")+"",_,u,d,g,b,y,h,S,T,M,k,C,I,A,U;function Y(ie,x){return ie[2].username?ss:ns}let Z=Y(l),J=Z(l);return M=new ls({props:{intervalTime:l[1],endTime:l[0],loading:l[3]}}),M.$on("click",l[8]),{c(){e=w("div"),t=w("div"),n=w("div"),i=w("div"),r=se(s),o=j(),a=w("div"),f=j(),c=w("div"),_=se(p),u=se("\xA0"),d=j(),g=w("div"),J.c(),b=j(),y=w("div"),y.innerHTML='<img src="assets/icons/logout.png" draggable="false" class="pos_abs w100 h100 svelte-1qt21qp"/>',h=j(),S=w("div"),T=j(),ge(M.$$.fragment),k=j(),C=w("div"),F(a,"width","8px"),v(n,"class","flex nowrap textOverEllipsis name svelte-1qt21qp"),v(g,"class","nowrap textOverEllipsis username svelte-1qt21qp"),v(y,"class","pos_abs btnLogout svelte-1qt21qp"),v(t,"class","flex flex_clm cursor_ptr pos_rel unselect operator svelte-1qt21qp"),F(S,"height","8px"),F(C,"height","8px"),v(e,"class","flex flex_clm cnt svelte-1qt21qp")},m(ie,x){P(ie,e,x),m(e,t),m(t,n),m(n,i),m(i,r),m(n,o),m(n,a),m(n,f),m(n,c),m(c,_),m(c,u),m(t,d),m(t,g),J.m(g,null),m(t,b),m(t,y),m(e,h),m(e,S),m(e,T),ue(M,e,null),m(e,k),m(e,C),I=!0,A||(U=te(y,"click",l[7]),A=!0)},p(ie,[x]){var ce,q;(!I||x&4)&&s!==(s=((ce=ie[2].first_name)!=null?ce:"")+"")&&he(r,s),(!I||x&4)&&p!==(p=((q=ie[2].last_name)!=null?q:"")+"")&&he(_,p),Z===(Z=Y(ie))&&J?J.p(ie,x):(J.d(1),J=Z(ie),J&&(J.c(),J.m(g,null)));const X={};x&2&&(X.intervalTime=ie[1]),x&1&&(X.endTime=ie[0]),x&8&&(X.loading=ie[3]),M.$set(X)},i(ie){I||(E(M.$$.fragment,ie),I=!0)},o(ie){G(M.$$.fragment,ie),I=!1},d(ie){ie&&N(e),J.d(),de(M),A=!1,U()}}}function rs(l,e,t){let n,i,s,{app:r}=e;const{operatorSelf_r:o,operatorSelfLastOnlineInfo_r:a,operatorSelfLastOnlineInfoLoading_r:f,operatorSelfLastOnline_SetOnlineFlag:c}=r;Le(l,o,y=>t(2,i=y)),Le(l,a,y=>t(10,n=y)),Le(l,f,y=>t(3,s=y));const p=()=>cn(null);let _=0,u=1;const d=y=>{if(!y){t(0,_=0),t(1,u=1);return}t(0,_=+new Date(y.offline_at)),t(1,u=Pe(1,(y.interval|0)*1e3,1e9))};let g=!1;const b=async()=>{var y;!((y=r.appConfig)!=null&&y.operatorSelf_CanSetOnline)||g||(g=!0,await c(!0),g=!1)};return l.$$set=y=>{"app"in y&&t(9,r=y.app)},l.$$.update=()=>{l.$$.dirty&1024&&d(n)},[_,u,i,s,o,a,f,p,b,r,n]}class os extends be{constructor(e){super(),ve(this,e,rs,is,pe,{app:9})}}const Dt=(l,e)=>{let t=null,n=null,i=!0;const s=()=>{i&&setTimeout(s,10);const o=l.parentNode;if(o){const a=o.getBoundingClientRect();(t!==a.width||n!==a.height)&&(t=a.width,n=a.height,l.style.width=`${t}px`,l.style.height=`${n}px`,e&&e.set(a))}};return s(),{destroy:()=>i=!1}},as=(l,e)=>{let t=null,n=null,i=null,s=null,r=!0;const o=()=>{r&&setTimeout(o,10);const f=l.getBoundingClientRect();(t!==f.width||n!==f.height||i!==f.x||s!==f.y)&&(t=f.width,n=f.height,i=f.x,s=f.y,e&&e.set(f))};return o(),{destroy:()=>r=!1}};function fs(l){let e,t,n,i,s,r,o,a,f,c,p,_,u,d,g,b,y;return{c(){e=w("div"),t=w("div"),n=w("div"),i=j(),s=w("div"),r=j(),o=w("div"),a=j(),f=w("div"),c=j(),p=w("div"),_=j(),u=w("div"),d=j(),g=w("div"),b=j(),y=w("div"),v(n,"class","svelte-1lltvmx"),v(s,"class","svelte-1lltvmx"),v(o,"class","svelte-1lltvmx"),v(f,"class","svelte-1lltvmx"),v(p,"class","svelte-1lltvmx"),v(u,"class","svelte-1lltvmx"),v(g,"class","svelte-1lltvmx"),v(y,"class","svelte-1lltvmx"),v(t,"class","lds-roller svelte-1lltvmx"),F(t,"transform","scale("+l[2]+")"),F(t,"--loadingItemColor",l[1]),v(e,"class","flex"),F(e,"height",l[0]+"px"),F(e,"width",l[0]+"px")},m(h,S){P(h,e,S),m(e,t),m(t,n),m(t,i),m(t,s),m(t,r),m(t,o),m(t,a),m(t,f),m(t,c),m(t,p),m(t,_),m(t,u),m(t,d),m(t,g),m(t,b),m(t,y)},p(h,[S]){S&4&&F(t,"transform","scale("+h[2]+")"),S&2&&F(t,"--loadingItemColor",h[1]),S&1&&F(e,"height",h[0]+"px"),S&1&&F(e,"width",h[0]+"px")},i:fe,o:fe,d(h){h&&N(e)}}}function cs(l,e,t){let n,{size:i=80}=e,{color:s="#000"}=e;return l.$$set=r=>{"size"in r&&t(0,i=r.size),"color"in r&&t(1,s=r.color)},l.$$.update=()=>{l.$$.dirty&1&&t(2,n=i/80)},[i,s,n]}class dn extends be{constructor(e){super(),ve(this,e,cs,fs,pe,{size:0,color:1})}}function al(l){let e,t,n,i;return t=new dn({props:{color:"#fff",size:"32"}}),{c(){e=w("div"),ge(t.$$.fragment),v(e,"class","pos_abs loading svelte-1r93skw")},m(s,r){P(s,e,r),ue(t,e,null),i=!0},i(s){i||(E(t.$$.fragment,s),s&&Ee(()=>{n||(n=Se(e,Ie,{},!0)),n.run(1)}),i=!0)},o(s){G(t.$$.fragment,s),s&&(n||(n=Se(e,Ie,{},!1)),n.run(0)),i=!1},d(s){s&&N(e),de(t),s&&n&&n.end()}}}function fl(l){let e,t,n,i;return t=new dn({props:{color:"#fff",size:"24"}}),{c(){e=w("div"),ge(t.$$.fragment),v(e,"class","pos_abs flex flex_cy h100 loading svelte-1r93skw")},m(s,r){P(s,e,r),ue(t,e,null),i=!0},i(s){i||(E(t.$$.fragment,s),s&&Ee(()=>{n||(n=Se(e,Ie,{},!0)),n.run(1)}),i=!0)},o(s){G(t.$$.fragment,s),s&&(n||(n=Se(e,Ie,{},!1)),n.run(0)),i=!1},d(s){s&&N(e),de(t),s&&n&&n.end()}}}function us(l){var T;let e,t,n,i,s,r,o,a=((T=l[0])!=null?T:0)+"",f,c,p,_,u,d,g,b,y,h=l[1]&&al(),S=l[2]&&fl();return{c(){e=w("div"),t=w("div"),n=w("div"),n.textContent="New leads",i=j(),h&&h.c(),s=j(),r=w("div"),o=w("div"),f=se(a),c=j(),p=w("div"),_=j(),u=w("div"),S&&S.c(),d=se(`\r
		Get one`),v(n,"class","flex mainLabel svelte-1r93skw"),v(o,"class","flex labelCountNum svelte-1r93skw"),v(r,"class","flex flex_cx flex_cy labelCount svelte-1r93skw"),v(t,"class","flex flex_cx flex_cy flex_clm header pos_rel w100 svelte-1r93skw"),F(p,"height","4px"),v(u,"class","flex flex_cx flex_cy cursor_ptr noselect pos_rel bntMain svelte-1r93skw"),K(u,"disabled",!l[0]&&!l[2]&&!l[3]),K(u,"btnLoading",l[2]),K(u,"animationDone",l[3]==="done"),K(u,"animationFail",l[3]==="fail"),v(e,"class","flex flex_clm wrapMain flex_grow_1 w100 unselect svelte-1r93skw")},m(M,k){P(M,e,k),m(e,t),m(t,n),m(t,i),h&&h.m(t,null),m(t,s),m(t,r),m(r,o),m(o,f),m(e,c),m(e,p),m(e,_),m(e,u),S&&S.m(u,null),m(u,d),g=!0,b||(y=te(u,"click",l[4]),b=!0)},p(M,[k]){var C;M[1]?h?k&2&&E(h,1):(h=al(),h.c(),E(h,1),h.m(t,s)):h&&(we(),G(h,1,1,()=>{h=null}),ye()),(!g||k&1)&&a!==(a=((C=M[0])!=null?C:0)+"")&&he(f,a),M[2]?S?k&4&&E(S,1):(S=fl(),S.c(),E(S,1),S.m(u,d)):S&&(we(),G(S,1,1,()=>{S=null}),ye()),(!g||k&13)&&K(u,"disabled",!M[0]&&!M[2]&&!M[3]),(!g||k&4)&&K(u,"btnLoading",M[2]),(!g||k&8)&&K(u,"animationDone",M[3]==="done"),(!g||k&8)&&K(u,"animationFail",M[3]==="fail")},i(M){g||(E(h),E(S),g=!0)},o(M){G(h),G(S),g=!1},d(M){M&&N(e),h&&h.d(),S&&S.d(),b=!1,y()}}}function ds(l,e,t){var f,c;let{app:n}=e,i=0,s=!0,r=!1,o=null;const a=async()=>{if(r||o||!i)return;t(2,r=!0);const p=await n.api.lead_AssignOneLead();t(2,r=!1),t(3,o=p?"done":"fail"),await Nt(1e3),t(3,o=null)};return Be(ft(Pe(100,((c=(f=n==null?void 0:n.appConfig)==null?void 0:f.updateIntervals)==null?void 0:c.new_leads_count)|0,36e5),async()=>{var p;t(0,i=((p=await n.api.lead_GetUnassignedLeadCount())==null?void 0:p.count)|0),t(1,s=!1)},!1)),l.$$set=p=>{"app"in p&&t(5,n=p.app)},[i,s,r,o,a,n]}class _s extends be{constructor(e){super(),ve(this,e,ds,us,pe,{app:5})}}function gs(l){let e,t,n,i,s,r,o,a,f,c,p,_,u,d,g,b,y,h;return{c(){e=w("label"),t=w("input"),n=j(),i=Fe("svg"),s=Fe("symbol"),r=Fe("path"),o=Fe("defs"),a=Fe("mask"),f=Fe("use"),c=Fe("use"),p=Fe("path"),_=j(),u=Fe("svg"),d=Fe("path"),g=Fe("path"),b=Fe("path"),v(t,"type","checkbox"),v(t,"class","svelte-13drl8w"),v(r,"d","M5.22003 7.26C5.72003 7.76 7.57 9.7 8.67 11.45C12.2 6.05 15.65 3.5 19.19 1.69"),v(r,"fill","none"),v(r,"stroke-width","2.25"),v(r,"stroke-linecap","round"),v(r,"stroke-linejoin","round"),v(s,"id","tick-path"),v(s,"viewBox","0 0 21 18"),v(s,"xmlns","http://www.w3.org/2000/svg"),v(f,"class","tick mask svelte-13drl8w"),v(f,"href","#tick-path"),v(a,"id","tick"),v(c,"class","tick svelte-13drl8w"),v(c,"href","#tick-path"),v(c,"stroke","currentColor"),v(p,"fill","white"),v(p,"mask","url(#tick)"),v(p,"d","M18 9C18 10.4464 17.9036 11.8929 17.7589 13.1464C17.5179 15.6054 15.6054 17.5179 13.1625 17.7589C11.8929 17.9036 10.4464 18 9 18C7.55357 18 6.10714 17.9036 4.85357 17.7589C2.39464 17.5179 0.498214 15.6054 0.241071 13.1464C0.0964286 11.8929 0 10.4464 0 9C0 7.55357 0.0964286 6.10714 0.241071 4.8375C0.498214 2.39464 2.39464 0.482143 4.85357 0.241071C6.10714 0.0964286 7.55357 0 9 0C10.4464 0 11.8929 0.0964286 13.1625 0.241071C15.6054 0.482143 17.5179 2.39464 17.7589 4.8375C17.9036 6.10714 18 7.55357 18 9Z"),v(i,"viewBox","0 0 21 18"),v(i,"class","svelte-13drl8w"),v(d,"d","M5.88086 5.89441L9.53504 4.26746"),v(g,"d","M5.5274 8.78838L9.45391 9.55161"),v(b,"d","M3.49371 4.22065L5.55387 0.79198"),v(u,"class","lines svelte-13drl8w"),v(u,"viewBox","0 0 11 11"),v(e,"class","checkbox svelte-13drl8w")},m(S,T){P(S,e,T),m(e,t),t.checked=l[0],m(e,n),m(e,i),m(i,s),m(s,r),m(i,o),m(o,a),m(a,f),m(i,c),m(i,p),m(e,_),m(e,u),m(u,d),m(u,g),m(u,b),y||(h=te(t,"change",l[1]),y=!0)},p(S,[T]){T&1&&(t.checked=S[0])},i:fe,o:fe,d(S){S&&N(e),y=!1,h()}}}function ms(l,e,t){let{checked:n=!1}=e;function i(){n=this.checked,t(0,n)}return l.$$set=s=>{"checked"in s&&t(0,n=s.checked)},[n,i]}class ps extends be{constructor(e){super(),ve(this,e,ms,gs,pe,{checked:0})}}function cl(l,e,t){const n=l.slice();return n[17]=e[t],n}function ul(l,e){let t,n=e[17].title.toLowerCase()+"",i;return{key:l,first:null,c(){t=w("div"),i=se(n),v(t,"class","flex tag svelte-n8zo8q"),F(t,"background",e[17].background_color),F(t,"color",e[17].color),this.first=t},m(s,r){P(s,t,r),m(t,i)},p(s,r){e=s,r&8&&n!==(n=e[17].title.toLowerCase()+"")&&he(i,n),r&8&&F(t,"background",e[17].background_color),r&8&&F(t,"color",e[17].color)},d(s){s&&N(t)}}}function dl(l){var i;let e,t=l[12]((i=l[3])==null?void 0:i._lastTime)+"",n;return{c(){e=w("div"),n=se(t),v(e,"class","pos_abs flex flex_cx flex_cy lastTime svelte-n8zo8q")},m(s,r){P(s,e,r),m(e,n)},p(s,r){var o;r&8&&t!==(t=s[12]((o=s[3])==null?void 0:o._lastTime)+"")&&he(n,t)},d(s){s&&N(e)}}}function _l(l){var i;let e,t=((i=l[3])==null?void 0:i.unread_messages_count)+"",n;return{c(){e=w("div"),n=se(t),v(e,"class","pos_abs flex flex_cx flex_cy unreadMsgs svelte-n8zo8q")},m(s,r){P(s,e,r),m(e,n)},p(s,r){var o;r&8&&t!==(t=((o=s[3])==null?void 0:o.unread_messages_count)+"")&&he(n,t)},d(s){s&&N(e)}}}function hs(l){var Te,je,Oe,ke,me,Ce,O,L,z,W,$,ne,ee,_e;let e,t,n,i,s,r,o=((Oe=(je=(Te=l[3])==null?void 0:Te.lead)==null?void 0:je.first_name)!=null?Oe:"")+"",a,f,c,p,_,u=((Ce=(me=(ke=l[3])==null?void 0:ke.lead)==null?void 0:me.last_name)!=null?Ce:"")+"",d,g,b,y,h=((z=(L=(O=l[3])==null?void 0:O.last_message)==null?void 0:L.text)!=null?z:"")+"",S,T,M,k,C,I,A,U,Y=((W=l[4])==null?void 0:W.title)+"",Z,J,le,re,ie,x=[],X=new Map,ce,q,oe,B,D=(ne=($=l[3])==null?void 0:$.tag)!=null?ne:[];const R=H=>H[17].id;for(let H=0;H<D.length;H+=1){let ae=cl(l,D,H),Me=R(ae);X.set(Me,x[H]=ul(Me,ae))}let V=((ee=l[3])==null?void 0:ee._lastTime)&&dl(l),Q=((_e=l[3])==null?void 0:_e.unread_messages_count)&&_l(l);return{c(){e=w("div"),t=w("div"),n=w("div"),i=w("div"),s=j(),r=w("div"),a=se(o),f=j(),c=w("div"),p=j(),_=w("div"),d=se(u),g=se("\xA0"),b=j(),y=w("div"),S=se(h),T=se("\xA0"),M=j(),k=w("div"),C=w("div"),I=w("img"),U=j(),Z=se(Y),J=j(),le=w("div"),re=j(),ie=w("div");for(let H=0;H<x.length;H+=1)x[H].c();ce=j(),V&&V.c(),q=j(),Q&&Q.c(),F(i,"width","8px"),F(c,"width","8px"),v(n,"class","flex nowrap textOverEllipsis userFirstLastName pos_rel svelte-n8zo8q"),v(y,"class","nowrap textOverEllipsis lastMessage pos_rel svelte-n8zo8q"),Ze(I.src,A="assets/icons/status1.png")||v(I,"src",A),v(I,"draggable","false"),v(I,"class","pos_abs statusIcon svelte-n8zo8q"),v(C,"class","flex flex_cy leadStatus pos_rel svelte-n8zo8q"),F(C,"background",l[4].bgColor),F(C,"color",l[4].color),F(le,"width","4px"),v(ie,"class","flex tag_list svelte-n8zo8q"),v(k,"class","flex"),v(t,"class","flex flex_clm cursor_ptr item flex_cx unselect pos_rel svelte-n8zo8q"),F(t,"height",l[0]+"px"),K(t,"active",l[1]===l[6]),K(t,"disabled",l[11](l[3])),v(e,"class","pos_abs w100 cntWrapper svelte-n8zo8q"),F(e,"transform","translate3d(0px, "+(l[5]+l[2])+"px, 0px)")},m(H,ae){P(H,e,ae),m(e,t),m(t,n),m(n,i),m(n,s),m(n,r),m(r,a),m(n,f),m(n,c),m(n,p),m(n,_),m(_,d),m(_,g),m(t,b),m(t,y),m(y,S),m(y,T),m(t,M),m(t,k),m(k,C),m(C,I),m(C,U),m(C,Z),m(k,J),m(k,le),m(k,re),m(k,ie);for(let Me=0;Me<x.length;Me+=1)x[Me].m(ie,null);m(t,ce),V&&V.m(t,null),m(t,q),Q&&Q.m(t,null),oe||(B=te(t,"click",l[10]),oe=!0)},p(H,[ae]){var Me,Ne,Ge,ze,tt,lt,De,Ke,ct,ut,dt,Yt,Wt,Jt;ae&8&&o!==(o=((Ge=(Ne=(Me=H[3])==null?void 0:Me.lead)==null?void 0:Ne.first_name)!=null?Ge:"")+"")&&he(a,o),ae&8&&u!==(u=((lt=(tt=(ze=H[3])==null?void 0:ze.lead)==null?void 0:tt.last_name)!=null?lt:"")+"")&&he(d,u),ae&8&&h!==(h=((ct=(Ke=(De=H[3])==null?void 0:De.last_message)==null?void 0:Ke.text)!=null?ct:"")+"")&&he(S,h),ae&16&&Y!==(Y=((ut=H[4])==null?void 0:ut.title)+"")&&he(Z,Y),ae&16&&F(C,"background",H[4].bgColor),ae&16&&F(C,"color",H[4].color),ae&8&&(D=(Yt=(dt=H[3])==null?void 0:dt.tag)!=null?Yt:[],x=Xe(x,ae,R,1,H,D,X,ie,rn,ul,null,cl)),(Wt=H[3])!=null&&Wt._lastTime?V?V.p(H,ae):(V=dl(H),V.c(),V.m(t,q)):V&&(V.d(1),V=null),(Jt=H[3])!=null&&Jt.unread_messages_count?Q?Q.p(H,ae):(Q=_l(H),Q.c(),Q.m(t,null)):Q&&(Q.d(1),Q=null),ae&1&&F(t,"height",H[0]+"px"),ae&66&&K(t,"active",H[1]===H[6]),ae&2056&&K(t,"disabled",H[11](H[3])),ae&36&&F(e,"transform","translate3d(0px, "+(H[5]+H[2])+"px, 0px)")},i:fe,o:fe,d(H){H&&N(e);for(let ae=0;ae<x.length;ae+=1)x[ae].d();V&&V.d(),Q&&Q.d(),oe=!1,B()}}}function vs(l,e,t){let n,i,s,r,o,{app:a}=e;const{dialogMap_r:f,dialogActiveID_r:c,dialogActiveID_Set:p}=a;Le(l,f,T=>t(15,s=T)),Le(l,c,T=>t(6,o=T));let{height:_=54}=e,{dialog_id:u}=e,{y:d=0}=e,{scrollY:g=0}=e;const b=We(d);Le(l,b,T=>t(5,r=T));const y=T=>{n&&!h(n)&&p(n.id)},h=T=>{var M;return((M=T==null?void 0:T.lead)==null?void 0:M.status)==="DL"},S=T=>{if(!T)return"";const M=C=>String(C).padStart(2,"0"),k=new Date;return T=new Date(T),T.getYear()===k.getYear()&&T.getMonth()===k.getMonth()?T.getDate()===k.getDate()?`${M(T.getHours())}:${M(T.getMinutes())}`:`${M(T.getDate())}d ${M(T.getHours())}:${M(T.getMinutes())}`:`${M(T.getDate())}.${M(T.getMonth())}.${T.getFullYear()}`};return l.$$set=T=>{"app"in T&&t(13,a=T.app),"height"in T&&t(0,_=T.height),"dialog_id"in T&&t(1,u=T.dialog_id),"y"in T&&t(14,d=T.y),"scrollY"in T&&t(2,g=T.scrollY)},l.$$.update=()=>{l.$$.dirty&16384&&Ye(b,r=d,r),l.$$.dirty&32770&&t(3,n=s[u]),l.$$.dirty&8200&&t(4,i=a.lead_GetStatusOrDefault(n==null?void 0:n.lead))},[_,u,g,n,i,r,o,f,c,b,y,h,S,a,d,s]}class bs extends be{constructor(e){super(),ve(this,e,vs,hs,pe,{app:13,height:0,dialog_id:1,y:14,scrollY:2})}}function ws(l){let e,t,n,i;return{c(){e=w("div"),t=w("div"),v(t,"class","pos_abs thumb w100 svelte-5ca5ia"),F(t,"height",l[1]+"px"),F(t,"transform","translate(0px, "+l[5](l[0],l[2],l[1])+"px)"),K(t,"active",l[3]),v(e,"class","pos_rel h100 unselect line svelte-5ca5ia"),K(e,"active",l[3])},m(s,r){P(s,e,r),m(e,t),n||(i=[te(window,"mousemove",l[7]),te(window,"mouseup",l[8]),te(window,"blur",l[8]),te(t,"mousedown",l[6]),at(as.call(null,e,l[4])),te(e,"mousedown",l[9])],n=!0)},p(s,[r]){r&2&&F(t,"height",s[1]+"px"),r&7&&F(t,"transform","translate(0px, "+s[5](s[0],s[2],s[1])+"px)"),r&8&&K(t,"active",s[3]),r&8&&K(e,"active",s[3])},i:fe,o:fe,d(s){s&&N(e),n=!1,Ae(i)}}}function ys(l,e,t){let n;const i=S=>Pe(0,Array.isArray(S)?S[0]:S,1);let{value_in:s=0}=e,{value_out:r=i(s)}=e,{thumb_Height:o=20}=e,{thumb_HeightRate:a=null}=e;const f=Re(null);Le(l,f,S=>t(2,n=S));const c=()=>n?n.height-o:1,p=S=>n?S*c():0,_=()=>{if(!n)return 1;if(a===null)return o;t(1,o=Pe(.1,a,1)*n.height)};let u=null;const d=S=>{!n||t(3,u={y:S.clientY,value_out:r})},g=S=>{if(!n||!u)return;const T=S.clientY-u.y;if(n.height){const M=T/c();t(0,r=Pe(0,u.value_out+M,1))}},b=S=>{t(3,u=null)},y=S=>{!n||u||(t(0,r=Pe(0,(S.clientY-n.y-o/2)/c(),1)),t(3,u={y:S.clientY,value_out:r}))},h=()=>{if(!n)return 0;u||t(0,r=i(s))};return l.$$set=S=>{"value_in"in S&&t(10,s=S.value_in),"value_out"in S&&t(0,r=S.value_out),"thumb_Height"in S&&t(1,o=S.thumb_Height),"thumb_HeightRate"in S&&t(11,a=S.thumb_HeightRate)},l.$$.update=()=>{l.$$.dirty&2052&&_(),l.$$.dirty&1024&&h()},[r,o,n,u,f,p,d,g,b,y,s,a]}class _n extends be{constructor(e){super(),ve(this,e,ys,ws,pe,{value_in:10,value_out:0,thumb_Height:1,thumb_HeightRate:11})}}const{Map:ks}=En;function gl(l,e,t){const n=l.slice();return n[24]=e[t],n}function ml(l,e){let t,n,i;return n=new bs({props:{app:e[0],dialog_id:e[24].dialog_id,scrollY:-e[2],y:e[24].y}}),{key:l,first:null,c(){t=Je(),ge(n.$$.fragment),this.first=t},m(s,r){P(s,t,r),ue(n,s,r),i=!0},p(s,r){e=s;const o={};r&1&&(o.app=e[0]),r&16&&(o.dialog_id=e[24].dialog_id),r&4&&(o.scrollY=-e[2]),r&16&&(o.y=e[24].y),n.$set(o)},i(s){i||(E(n.$$.fragment,s),i=!0)},o(s){G(n.$$.fragment,s),i=!1},d(s){s&&N(t),de(n,s)}}}function pl(l){let e,t,n,i;function s(o){l[14](o)}let r={value_in:l[5],thumb_HeightRate:l[6]};return l[1]!==void 0&&(r.value_out=l[1]),t=new _n({props:r}),xe.push(()=>Lt(t,"value_out",s)),{c(){e=w("div"),ge(t.$$.fragment),v(e,"class","pos_abs h100 dialogScroll svelte-1l0pdn")},m(o,a){P(o,e,a),ue(t,e,null),i=!0},p(o,a){const f={};a&32&&(f.value_in=o[5]),a&64&&(f.thumb_HeightRate=o[6]),!n&&a&2&&(n=!0,f.value_out=o[1],St(()=>n=!1)),t.$set(f)},i(o){i||(E(t.$$.fragment,o),i=!0)},o(o){G(t.$$.fragment,o),i=!1},d(o){o&&N(e),de(t)}}}function hl(l){let e,t,n,i,s;return{c(){e=w("div"),e.innerHTML='<img class="flex" draggable="false" style="filter: invert(1);" src="assets/icons/arrow-up.png"/>',v(e,"class","flex pos_abs cursor_ptr btnScrollUp svelte-1l0pdn")},m(r,o){P(r,e,o),n=!0,i||(s=te(e,"click",l[15]),i=!0)},p:fe,i(r){n||(r&&Ee(()=>{t||(t=Se(e,Ie,{},!0)),t.run(1)}),n=!0)},o(r){r&&(t||(t=Se(e,Ie,{},!1)),t.run(0)),n=!1},d(r){r&&N(e),r&&t&&t.end(),i=!1,s()}}}function Ss(l){let e,t,n=[],i=new ks,s,r,o,a,f,c=l[4];const p=d=>d[24].dialog_id;for(let d=0;d<c.length;d+=1){let g=gl(l,c,d),b=p(g);i.set(b,n[d]=ml(b,g))}let _=l[6]<1&&pl(l),u=l[6]<1&&l[7]&&hl(l);return{c(){e=w("div"),t=w("div");for(let d=0;d<n.length;d+=1)n[d].c();s=j(),_&&_.c(),r=j(),u&&u.c(),v(t,"class","flex overhide pos_rel"),v(e,"class","flex flex_grow_1 pos_rel"),F(e,"--itemHeight",Ve+"px")},m(d,g){P(d,e,g),m(e,t);for(let b=0;b<n.length;b+=1)n[b].m(t,null);m(e,s),_&&_.m(e,null),m(e,r),u&&u.m(e,null),o=!0,a||(f=[at(Dt.call(null,t,l[8])),te(e,"wheel",l[10],{passive:!0})],a=!0)},p(d,[g]){g&21&&(c=d[4],we(),n=Xe(n,g,p,1,d,c,i,t,et,ml,null,gl),ye()),d[6]<1?_?(_.p(d,g),g&64&&E(_,1)):(_=pl(d),_.c(),E(_,1),_.m(e,r)):_&&(we(),G(_,1,1,()=>{_=null}),ye()),d[6]<1&&d[7]?u?(u.p(d,g),g&192&&E(u,1)):(u=hl(d),u.c(),E(u,1),u.m(e,null)):u&&(we(),G(u,1,1,()=>{u=null}),ye())},i(d){if(!o){for(let g=0;g<c.length;g+=1)E(n[g]);E(_),E(u),o=!0}},o(d){for(let g=0;g<n.length;g+=1)G(n[g]);G(_),G(u),o=!1},d(d){d&&N(e);for(let g=0;g<n.length;g+=1)n[g].d();_&&_.d(),u&&u.d(),a=!1,Ae(f)}}}const Ve=54;function Ls(l,e,t){let n,i,s=fe,r=()=>(s(),s=Bt(d,J=>t(13,i=J)),d),o;l.$$.on_destroy.push(()=>s());let{app:a}=e;const{dialogMap_SetDialogList:f}=a;let{filter:c={}}=e;const p=J=>{var le;return[c.filterUnreadFirst?1:0,(le=c.filterTag)!=null?le:""].join("/")};let _={},u=null,d=Re(null);r();function g(){const J={...c},le=p();_[le]||(_[le]=Pn({fLoad:re=>(re={unread_first:J.filterUnreadFirst?1:0,...re},J.filterTag&&(re.tag=J.filterTag),a.api.dialog_GetList(re)),updateInterval:500,isLoadEnd:!1,onUpdateItemList:f})),u!==_[le]&&([...Object.values(_)].map(re=>re.pause()),u=_[le],u.resume(),console.log({filterHash:le}),r(t(3,d=u.getData_r())))}Be(()=>[...Object.values(_)].map(J=>J.destroy()));let b=[];const y=Re(null);Le(l,y,J=>t(12,n=J));let h=0,S=0,T=1,M=0,k=We(M,{duration:200});Le(l,k,J=>t(2,o=J));function C(){if(!n||!i)return;const J=Math.max(1,Math.floor(n.height)),le=i.total*Ve,re=le-J;t(6,T=le?Pe(0,J/le,1):1),re<0?M=0:M=S*re,Ye(k,o=M,o)}let I=!1;function A(){if(!n||!i)return;const J=i,le=Math.max(1,Math.floor(n.height)),re=Math.ceil(le/Ve);i.total*Ve;let x=Math.max(0,Math.floor(o/Ve)-1);const X=re+2;x>J.total&&(x=Math.max(0,J.total-X)),u&&u.setRange(x,X);const ce=[];for(let q=x,oe=0;oe<X&&q<J.total;oe++,q++){const B=J.list[q];ce.push({index:q,item:B,y:q*Ve})}t(4,b=[...new Map(ce.filter(q=>q.item).map(q=>[q.item.id,q]))].map(([q,oe])=>({dialog_id:oe.item.id,y:oe.y}))),t(7,I=x>1)}const U=J=>{if(!n||!i)return;const le=i,re=Math.max(1,Math.floor(n.height)),x=le.total*Ve-re;if(x<0)return;const X=J.deltaY>0?1:-1;t(5,h=[S+Ve/x*X])};function Y(J){S=J,t(1,S)}const Z=()=>t(5,h=[0]);return l.$$set=J=>{"app"in J&&t(0,a=J.app),"filter"in J&&t(11,c=J.filter)},l.$$.update=()=>{l.$$.dirty&2048&&g(),l.$$.dirty&12290&&C(),l.$$.dirty&12292&&A()},[a,S,o,d,b,h,T,I,y,k,U,c,n,i,Y,Z]}class Ms extends be{constructor(e){super(),ve(this,e,Ls,Ss,pe,{app:0,filter:11})}}function vl(l,e,t){const n=l.slice();return n[5]=e[t],n}function bl(l,e){let t,n=e[5].title+"",i,s,r;function o(){return e[4](e[5])}return{key:l,first:null,c(){t=w("div"),i=se(n),v(t,"class","cursor_ptr filter_tag inactive svelte-1t7cez8"),F(t,"background",e[5].background_color),F(t,"color",e[5].color),K(t,"active",e[0]===e[5].title),this.first=t},m(a,f){P(a,t,f),m(t,i),s||(r=te(t,"click",o),s=!0)},p(a,f){e=a,f&3&&K(t,"active",e[0]===e[5].title)},d(a){a&&N(t),s=!1,r()}}}function Ts(l){let e,t,n,i,s,r,o=[],a=new Map,f,c,p=l[1];const _=u=>u[5].title;for(let u=0;u<p.length;u+=1){let d=vl(l,p,u),g=_(d);a.set(g,o[u]=bl(g,d))}return{c(){e=w("div"),t=w("div"),t.textContent="Filter tag",n=j(),i=w("div"),s=w("div"),s.textContent="all",r=j();for(let u=0;u<o.length;u+=1)o[u].c();v(t,"class","flex label svelte-1t7cez8"),v(s,"class","cursor_ptr filter_tag inactive svelte-1t7cez8"),F(s,"background","#fff"),F(s,"color","#000"),K(s,"active",l[0]===null),v(i,"class","flex filter_tag_list svelte-1t7cez8"),v(e,"class","flex flex_clm cnt unselect svelte-1t7cez8")},m(u,d){P(u,e,d),m(e,t),m(e,n),m(e,i),m(i,s),m(i,r);for(let g=0;g<o.length;g+=1)o[g].m(i,null);f||(c=te(s,"click",l[3]),f=!0)},p(u,[d]){d&1&&K(s,"active",u[0]===null),d&3&&(p=u[1],o=Xe(o,d,_,1,u,p,a,i,rn,bl,null,vl))},i:fe,o:fe,d(u){u&&N(e);for(let d=0;d<o.length;d+=1)o[d].d();f=!1,c()}}}function Os(l,e,t){let{app:n}=e,{filterTag:i=null}=e,s=[...g_Config.pinnedTags];const r=()=>t(0,i=null),o=a=>t(0,i=a.title);return l.$$set=a=>{"app"in a&&t(2,n=a.app),"filterTag"in a&&t(0,i=a.filterTag)},[i,s,n,r,o]}class Ds extends be{constructor(e){super(),ve(this,e,Os,Ts,pe,{app:2,filterTag:0})}}function wl(l){let e,t,n,i,s,r,o,a,f;return{c(){e=w("img"),n=j(),i=w("div"),s=w("div"),s.innerHTML='<img class="w100 h100 svelte-1m8yuzj" draggable="false" src="assets/icons/download.png"/>',r=j(),o=w("div"),o.innerHTML='<img class="w100 h100 svelte-1m8yuzj" draggable="false" src="assets/icons/fullscreen.png"/>',v(e,"class","a_img svelte-1m8yuzj"),Ze(e.src,t=l[2].url)||v(e,"src",t),F(e,"max-height",l[4]+"px"),v(s,"class","flex cursor_ptr imgCtrlBtn svelte-1m8yuzj"),v(o,"class","flex cursor_ptr imgCtrlBtn svelte-1m8yuzj"),v(i,"class","flex pos_abs imgCtrlBtnGroup svelte-1m8yuzj")},m(c,p){P(c,e,p),P(c,n,p),P(c,i,p),m(i,s),m(i,r),m(i,o),a||(f=[te(s,"click",function(){He(l[5](l[2]))&&l[5](l[2]).apply(this,arguments)}),te(o,"click",function(){He(l[6](l[2]))&&l[6](l[2]).apply(this,arguments)})],a=!0)},p(c,p){l=c,p&4&&!Ze(e.src,t=l[2].url)&&v(e,"src",t),p&16&&F(e,"max-height",l[4]+"px")},d(c){c&&N(e),c&&N(n),c&&N(i),a=!1,Ae(f)}}}function yl(l){let e,t,n,i,s,r,o;return{c(){e=w("img"),n=j(),i=w("div"),s=w("div"),s.innerHTML='<img class="w100 h100 svelte-1m8yuzj" draggable="false" src="assets/icons/download.png"/>',v(e,"class","a_img fileIcon svelte-1m8yuzj"),Ze(e.src,t="assets/icons/folder.png")||v(e,"src",t),F(e,"max-height",l[4]+"px"),v(s,"class","flex cursor_ptr imgCtrlBtn svelte-1m8yuzj"),v(i,"class","flex pos_abs imgCtrlBtnGroup svelte-1m8yuzj")},m(a,f){P(a,e,f),P(a,n,f),P(a,i,f),m(i,s),r||(o=te(s,"click",l[13]),r=!0)},p(a,f){f&16&&F(e,"max-height",a[4]+"px")},d(a){a&&N(e),a&&N(n),a&&N(i),r=!1,o()}}}function kl(l){var i;let e,t=((i=l[0])==null?void 0:i.text)+"",n;return{c(){e=w("pre"),n=se(t),v(e,"class","w100 text textPre svelte-1m8yuzj")},m(s,r){P(s,e,r),m(e,n)},p(s,r){var o;r&1&&t!==(t=((o=s[0])==null?void 0:o.text)+"")&&he(n,t)},d(s){s&&N(e)}}}function Is(l){var p,_;let e,t,n,i,s,r=l[7]((p=l[0])==null?void 0:p.received_at)+"",o,a=l[2]&&wl(l),f=l[3]&&yl(l),c=((_=l[0])==null?void 0:_.text)&&kl(l);return{c(){var u,d,g,b;e=w("div"),a&&a.c(),t=j(),f&&f.c(),n=j(),c&&c.c(),i=j(),s=w("div"),o=se(r),v(s,"class","flex pos_abs unselect date svelte-1m8yuzj"),K(s,"attachment_mode",l[2]&&!((u=l[0])!=null&&u.text)),v(e,"class","flex flex_clm overhide pos_abs chat_item svelte-1m8yuzj"),K(e,"chat_item_other",(d=l[0])==null?void 0:d.incoming),K(e,"chat_item_self",!((g=l[0])!=null&&g.incoming)),K(e,"has_text",(b=l[0])==null?void 0:b.text)},m(u,d){P(u,e,d),a&&a.m(e,null),m(e,t),f&&f.m(e,null),m(e,n),c&&c.m(e,null),m(e,i),m(e,s),m(s,o),l[14](e)},p(u,[d]){var g,b,y,h,S,T;u[2]?a?a.p(u,d):(a=wl(u),a.c(),a.m(e,t)):a&&(a.d(1),a=null),u[3]?f?f.p(u,d):(f=yl(u),f.c(),f.m(e,n)):f&&(f.d(1),f=null),(g=u[0])!=null&&g.text?c?c.p(u,d):(c=kl(u),c.c(),c.m(e,i)):c&&(c.d(1),c=null),d&1&&r!==(r=u[7]((b=u[0])==null?void 0:b.received_at)+"")&&he(o,r),d&5&&K(s,"attachment_mode",u[2]&&!((y=u[0])!=null&&y.text)),d&1&&K(e,"chat_item_other",(h=u[0])==null?void 0:h.incoming),d&1&&K(e,"chat_item_self",!((S=u[0])!=null&&S.incoming)),d&1&&K(e,"has_text",(T=u[0])==null?void 0:T.text)},i:fe,o:fe,d(u){u&&N(e),a&&a.d(),f&&f.d(),c&&c.d(),l[14](null)}}}function Cs(l,e,t){let{app:n}=e,{bbox:i=null}=e,{message:s=null}=e,{render_Width:r=1}=e,{render_X:o=-r*2}=e,a=null,f=null,c=null,p=null,_=[],u=[],d=1;function g(k){var I;_=[],u=[],k&&(I=k.attachments)!=null&&I.length&&(_=k.attachments.filter(A=>A.file_type==="IM").map(A=>({url:A.url})),u=k.attachments.filter(A=>A.file_type==="DC").map(A=>({url:A.url})));const C=i.height*.7;i.width,t(4,d=C),t(2,c=_==null?void 0:_[0]),t(3,p=u==null?void 0:u[0])}function b(k){if(!k||!Array.isArray(k.attachments)){t(0,f=null);return}if(!f){t(0,f=k);return}if(f.text!==k.text||f.incoming!==k.incoming||f.received_at!==k.received_at||f.attachments.length!==k.attachments.length){t(0,f=k);return}if(!f.attachments.map((C,I)=>[C,k.attachments[I]]).every(([C,I])=>C.file_type===I.file_type&&C.url===I.url)){t(0,f=k);return}}const y=k=>C=>{k&&k.url&&Pt(k.url)},h=k=>C=>{k&&k.url&&n.events.emit("openOverlayImageView",k.url)},S=k=>{if(k===null)return"";const C=A=>String(A).padStart(2,"0"),I=new Date;return k=new Date(k),k.getYear()===I.getYear()&&k.getMonth()===I.getMonth()&&k.getDate()===I.getDate()?`${C(k.getHours())}:${C(k.getMinutes())}`:`${C(k.getDate())}.${C(k.getMonth())}.${k.getFullYear()} ${C(k.getHours())}:${C(k.getMinutes())}`},T=()=>fn(p.url);function M(k){xe[k?"unshift":"push"](()=>{a=k,t(1,a)})}return l.$$set=k=>{"app"in k&&t(8,n=k.app),"bbox"in k&&t(9,i=k.bbox),"message"in k&&t(10,s=k.message),"render_Width"in k&&t(11,r=k.render_Width),"render_X"in k&&t(12,o=k.render_X)},l.$$.update=()=>{l.$$.dirty&1024&&b(s),l.$$.dirty&1&&g(f)},[f,a,c,p,d,y,h,S,n,i,s,r,o,T,M]}class Es extends be{constructor(e){super(),ve(this,e,Cs,Is,pe,{app:8,bbox:9,message:10,render_Width:11,render_X:12})}}function As(l){let e;return{c(){e=w("div"),e.innerHTML=`<div class="svelte-j15bjw"></div> 
	<div class="svelte-j15bjw"></div> 
	<div class="svelte-j15bjw"></div>`,v(e,"class","lds-roller svelte-j15bjw")},m(t,n){P(t,e,n)},p:fe,i:fe,o:fe,d(t){t&&N(e)}}}class It extends be{constructor(e){super(),ve(this,e,null,As,pe,{})}}const Sl=(l,{delay:e=0,duration:t=400,easing:n=on}={})=>{const i=getComputedStyle(l),s=+i.opacity,r=parseFloat(i.width),o=parseFloat(i.paddingTop),a=parseFloat(i.paddingBottom),f=parseFloat(i.marginTop),c=parseFloat(i.marginBottom),p=parseFloat(i.borderTopWidth),_=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:u=>`overflow: hidden;opacity: ${Math.min(u*20,1)*s};width: ${u*r}px;padding-top: ${u*o}px;padding-bottom: ${u*a}px;margin-top: ${u*f}px;margin-bottom: ${u*c}px;border-top-width: ${u*p}px;border-bottom-width: ${u*_}px;`}};function Ll(l){let e;return{c(){e=w("div"),e.textContent=">",v(e,"class","flex flex_cx flex_cy statusItemDlm svelte-1pt3u5i")},m(t,n){P(t,e,n)},d(t){t&&N(e)}}}function js(l){var f,c,p,_;let e,t,n,i,s=((_=(f=l[2])==null?void 0:f.title)!=null?_:(c=l[2])!=null&&c.id?`#${(p=l[2])==null?void 0:p.id}`:"*UNK*")+"",r,o,a=l[0]&&Ll();return{c(){var u,d,g,b;e=w("div"),t=w("div"),a&&a.c(),n=j(),i=w("div"),r=se(s),v(i,"class","flex flex_cx flex_cy nowrap statusItem svelte-1pt3u5i"),F(i,"background",(d=(u=l[2])==null?void 0:u.bgColor)!=null?d:"#000"),F(i,"color",(b=(g=l[2])==null?void 0:g.color)!=null?b:"#fff"),v(t,"class","flex"),v(e,"class","flex flex_cy h100 overhide itemWrapper svelte-1pt3u5i"),v(e,"style",o=l[1]?"width: 0px;":"")},m(u,d){P(u,e,d),m(e,t),a&&a.m(t,null),m(t,n),m(t,i),m(i,r),l[5](t),l[6](e)},p(u,[d]){var g,b,y,h,S,T,M,k;u[0]?a||(a=Ll(),a.c(),a.m(t,n)):a&&(a.d(1),a=null),d&4&&s!==(s=((h=(g=u[2])==null?void 0:g.title)!=null?h:(b=u[2])!=null&&b.id?`#${(y=u[2])==null?void 0:y.id}`:"*UNK*")+"")&&he(r,s),d&4&&F(i,"background",(T=(S=u[2])==null?void 0:S.bgColor)!=null?T:"#000"),d&4&&F(i,"color",(k=(M=u[2])==null?void 0:M.color)!=null?k:"#fff"),d&2&&o!==(o=u[1]?"width: 0px;":"")&&v(e,"style",o)},i:fe,o:fe,d(u){u&&N(e),a&&a.d(),l[5](null),l[6](null)}}}function Ns(l,e,t){let{beforeDlm:n=!1}=e,{hide:i=!1}=e,{status:s={}}=e,r,o;Sn(()=>{r&&o&&t(3,r.style.width=o.offsetWidth+"px",r)});function a(c){xe[c?"unshift":"push"](()=>{o=c,t(4,o)})}function f(c){xe[c?"unshift":"push"](()=>{r=c,t(3,r)})}return l.$$set=c=>{"beforeDlm"in c&&t(0,n=c.beforeDlm),"hide"in c&&t(1,i=c.hide),"status"in c&&t(2,s=c.status)},[n,i,s,r,o,a,f]}class Fs extends be{constructor(e){super(),ve(this,e,Ns,js,pe,{beforeDlm:0,hide:1,status:2})}}function Ml(l,e,t){const n=l.slice();return n[8]=e[t],n[10]=t,n}function Tl(l,e){var s;let t,n,i;return n=new Fs({props:{beforeDlm:(s=e[8].status)==null?void 0:s.beforeDlm,status:e[8].status,hide:e[8].hide}}),{key:l,first:null,c(){t=Je(),ge(n.$$.fragment),this.first=t},m(r,o){P(r,t,o),ue(n,r,o),i=!0},p(r,o){var f;e=r;const a={};o&1&&(a.beforeDlm=(f=e[8].status)==null?void 0:f.beforeDlm),o&1&&(a.status=e[8].status),o&1&&(a.hide=e[8].hide),n.$set(a)},i(r){i||(E(n.$$.fragment,r),i=!0)},o(r){G(n.$$.fragment,r),i=!1},d(r){r&&N(t),de(n,r)}}}function Ps(l){let e,t=[],n=new Map,i,s=l[0];const r=o=>o[8].rID;for(let o=0;o<s.length;o+=1){let a=Ml(l,s,o),f=r(a);n.set(f,t[o]=Tl(f,a))}return{c(){e=w("div");for(let o=0;o<t.length;o+=1)t[o].c();v(e,"class","flex h100")},m(o,a){P(o,e,a);for(let f=0;f<t.length;f+=1)t[f].m(e,null);i=!0},p(o,[a]){a&1&&(s=o[0],we(),t=Xe(t,a,r,1,o,s,n,e,et,Tl,null,Ml),ye())},i(o){if(!i){for(let a=0;a<s.length;a+=1)E(t[a]);i=!0}},o(o){for(let a=0;a<t.length;a+=1)G(t[a]);i=!1},d(o){o&&N(e);for(let a=0;a<t.length;a+=1)t[a].d()}}}function xs(l,e,t){let{app:n}=e,{statusList:i=[]}=e,{statusSelectList:s=[]}=e,r=[],o=1;Be(ft(1e3,()=>{const f=Date.now();t(0,r=r.filter(c=>!c.hide||c.hide<=f))}));const a=()=>{r.forEach(f=>{f.hide||i.find(c=>{var p;return((p=f==null?void 0:f.status)==null?void 0:p.id)===(c==null?void 0:c.id)})||(f.hide=Date.now()+1e3)}),i.forEach(f=>{r.find(c=>{var p;return!c.hide&&((p=c==null?void 0:c.status)==null?void 0:p.id)===(f==null?void 0:f.id)})||r.push({rID:o++,status:f,hide:!1})}),t(0,r)};return l.$$set=f=>{"app"in f&&t(1,n=f.app),"statusList"in f&&t(2,i=f.statusList),"statusSelectList"in f&&t(3,s=f.statusSelectList)},l.$$.update=()=>{l.$$.dirty&4&&a()},[r,n,i,s]}class zs extends be{constructor(e){super(),ve(this,e,xs,Ps,pe,{app:1,statusList:2,statusSelectList:3})}}function Ol(l,e,t){const n=l.slice();return n[29]=e[t],n[31]=t,n}function Dl(l){let e,t,n,i,s,r,o,a,f,c,p,_,u,d;f=new zs({props:{statusList:l[0]}});let g=l[3]&&!l[4]&&Il(l),b=l[4]&&El();return{c(){e=w("div"),t=w("div"),n=w("div"),i=j(),s=w("img"),o=j(),a=w("div"),ge(f.$$.fragment),c=j(),g&&g.c(),p=j(),b&&b.c(),v(n,"class","pos_abs w100 h100 deleteProgress svelte-socr2e"),F(n,"width",l[2]+"%"),v(t,"class","pos_abs w100 h100 overhide bg svelte-socr2e"),Ze(s.src,r="assets/icons/status1.png")||v(s,"src",r),v(s,"draggable","false"),v(s,"class","pos_abs statusIcon svelte-socr2e"),v(a,"class","flex flex_cy "),F(a,"z-index","200"),v(e,"class","flex flex_cx flex_cy cursor_ptr unselect statusCnt pos_rel svelte-socr2e"),K(e,"loading",l[4])},m(y,h){P(y,e,h),m(e,t),m(t,n),m(e,i),m(e,s),m(e,o),m(e,a),ue(f,a,null),m(e,c),g&&g.m(e,null),m(e,p),b&&b.m(e,null),l[16](e),_=!0,u||(d=[te(e,"mouseenter",l[17]),te(e,"mouseleave",l[18]),te(e,"click",l[19])],u=!0)},p(y,h){(!_||h[0]&4)&&F(n,"width",y[2]+"%");const S={};h[0]&1&&(S.statusList=y[0]),f.$set(S),y[3]&&!y[4]?g?(g.p(y,h),h[0]&24&&E(g,1)):(g=Il(y),g.c(),E(g,1),g.m(e,p)):g&&(we(),G(g,1,1,()=>{g=null}),ye()),y[4]?b?h[0]&16&&E(b,1):(b=El(),b.c(),E(b,1),b.m(e,null)):b&&(we(),G(b,1,1,()=>{b=null}),ye()),(!_||h[0]&16)&&K(e,"loading",y[4])},i(y){_||(E(f.$$.fragment,y),E(g),E(b),_=!0)},o(y){G(f.$$.fragment,y),G(g),G(b),_=!1},d(y){y&&N(e),de(f),g&&g.d(),b&&b.d(),l[16](null),u=!1,Ae(d)}}}function Il(l){let e,t,n,i=l[7],s=[];for(let r=0;r<i.length;r+=1)s[r]=Cl(Ol(l,i,r));return{c(){e=w("div");for(let r=0;r<s.length;r+=1)s[r].c();v(e,"class","flex flex_cy"),F(e,"z-index","100")},m(r,o){P(r,e,o);for(let a=0;a<s.length;a+=1)s[a].m(e,null);n=!0},p(r,o){if(o[0]&3202){i=r[7];let a;for(a=0;a<i.length;a+=1){const f=Ol(r,i,a);s[a]?s[a].p(f,o):(s[a]=Cl(f),s[a].c(),s[a].m(e,null))}for(;a<s.length;a+=1)s[a].d(1);s.length=i.length}},i(r){n||(r&&Ee(()=>{t||(t=Se(e,Sl,{},!0)),t.run(1)}),n=!0)},o(r){r&&(t||(t=Se(e,Sl,{},!1)),t.run(0)),n=!1},d(r){r&&N(e),Ot(s,r),r&&t&&t.end()}}}function Bs(l){let e;return{c(){e=w("div"),F(e,"min-width","4px")},m(t,n){P(t,e,n)},d(t){t&&N(e)}}}function Hs(l){let e;return{c(){e=w("div"),e.textContent=">",v(e,"class","flex flex_cx flex_cy statusItemDlm svelte-socr2e")},m(t,n){P(t,e,n)},d(t){t&&N(e)}}}function Cl(l){let e,t,n=l[29].title+"",i,s,r;function o(c,p){return c[31]===0?Hs:Bs}let f=o(l)(l);return{c(){f.c(),e=j(),t=w("div"),i=se(n),v(t,"class","flex flex_cx flex_cy nowrap statusItem select svelte-socr2e"),F(t,"background",l[29].bgColor),F(t,"color",l[29].color)},m(c,p){f.m(c,p),P(c,e,p),P(c,t,p),m(t,i),s||(r=[te(t,"click",function(){He(l[10](l[1],l[29]))&&l[10](l[1],l[29]).apply(this,arguments)}),te(t,"mousedown",function(){He(l[11](l[1],l[29]))&&l[11](l[1],l[29]).apply(this,arguments)})],s=!0)},p(c,p){l=c,p[0]&128&&n!==(n=l[29].title+"")&&he(i,n),p[0]&128&&F(t,"background",l[29].bgColor),p[0]&128&&F(t,"color",l[29].color)},d(c){f.d(c),c&&N(e),c&&N(t),s=!1,Ae(r)}}}function El(l){let e,t,n,i;return t=new un({props:{height:"6"}}),{c(){e=w("div"),ge(t.$$.fragment),v(e,"class","flex pos_abs flex_cy h100 loadingInd svelte-socr2e"),F(e,"filter","invert(0)")},m(s,r){P(s,e,r),ue(t,e,null),i=!0},i(s){i||(E(t.$$.fragment,s),s&&Ee(()=>{n||(n=Se(e,Ie,{},!0)),n.run(1)}),i=!0)},o(s){G(t.$$.fragment,s),s&&(n||(n=Se(e,Ie,{},!1)),n.run(0)),i=!1},d(s){s&&N(e),de(t),s&&n&&n.end()}}}function Rs(l){let e,t,n,i,s=l[1]&&l[1].lead&&Dl(l);return{c(){s&&s.c(),e=Je()},m(r,o){s&&s.m(r,o),P(r,e,o),t=!0,n||(i=[te(window,"mouseup",l[12]),te(window,"mousedown",l[9]),te(window,"blur",l[9])],n=!0)},p(r,o){r[1]&&r[1].lead?s?(s.p(r,o),o[0]&2&&E(s,1)):(s=Dl(r),s.c(),E(s,1),s.m(e.parentNode,e)):s&&(we(),G(s,1,1,()=>{s=null}),ye())},i(r){t||(E(s),t=!0)},o(r){G(s),t=!1},d(r){s&&s.d(r),r&&N(e),n=!1,Ae(i)}}}function Gs(l,e,t){let n,i,s,r,o,a=fe,f=()=>(a(),a=Bt(C,x=>t(2,o=x)),C);l.$$.on_destroy.push(()=>a());let{app:c}=e;const{dialogMap_r:p,dialogMap_SetDialog:_}=c;Le(l,p,x=>t(15,r=x));let{dialog_id:u}=e,d=!1,g=!1;const b=()=>{var x;return!(!n||!n.lead||((x=n==null?void 0:n.lead)==null?void 0:x.status)==="DL"||g)};let y;const h=x=>{let X=x.target;for(;X;){if(X===y)return;X=X.parentNode}t(3,d=!1)},S=(x,X,ce=!1)=>async q=>{if(!b()||!ce&&X.protection)return;const oe=X.id;if(t(3,d=!1),Y({status:oe}).length||t(7,s=[]),t(4,g=!0),x){const B=await c.api.lead_SetStatus(x.lead.tg_id,oe);B&&x&&x.lead&&x.lead.tg_id===B.tg_id&&(x.lead=B,_(x))}t(4,g=!1)};let T=null,M=null,k=Number.POSITIVE_INFINITY,C=We(0,{duration:2e3});f();const I=(x,X)=>ce=>{var q;!X.protection||(T=(q=x==null?void 0:x.lead)==null?void 0:q.tg_id,k=Date.now(),M=X,f(t(6,C=We(o,{duration:2e3}))),Ye(C,o=100,o))},A=x=>{t(3,d=!1),T=null,k=Number.POSITIVE_INFINITY,f(t(6,C=We(o,{duration:200}))),Ye(C,o=0,o)},U=async()=>{var x;!b()||(M&&k+1200<Date.now()&&T===((x=n==null?void 0:n.lead)==null?void 0:x.tg_id)&&await S(n,M,!0)(),A())},Y=x=>{var X,ce,q,oe;try{const B=c.lead_GetStatusID(x);return(c.lead_GetStatusByID(B)?(ce=(X=c==null?void 0:c.appConfig)==null?void 0:X.lead_StatusJumpMap)==null?void 0:ce[B]:(oe=(q=c==null?void 0:c.appConfig)==null?void 0:q.lead_StatusNextListForUnkStatus)!=null?oe:[]).map(c==null?void 0:c.lead_GetStatusByID).filter(Boolean)}catch{}return[]},Z=x=>c.lead_GetStatusHistory(x).map((X,ce)=>({...X,beforeDlm:ce!==0}));function J(x){xe[x?"unshift":"push"](()=>{y=x,t(5,y)})}const le=()=>t(3,d=!0),re=()=>t(3,d=!1),ie=()=>t(3,d=!0);return l.$$set=x=>{"app"in x&&t(13,c=x.app),"dialog_id"in x&&t(14,u=x.dialog_id)},l.$$.update=()=>{var x;l.$$.dirty[0]&4&&o>=100&&U(),l.$$.dirty[0]&49152&&t(1,n=r[u]),l.$$.dirty[0]&2&&t(0,i=Z(n==null?void 0:n.lead)),l.$$.dirty[0]&2&&t(7,s=Y(n==null?void 0:n.lead)),l.$$.dirty[0]&3&&console.log((x=n==null?void 0:n.lead)==null?void 0:x.status,i)},[i,n,o,d,g,y,C,s,p,h,S,I,A,c,u,r,J,le,re,ie]}class Us extends be{constructor(e){super(),ve(this,e,Gs,Rs,pe,{app:13,dialog_id:14},null,[-1,-1])}}function Al(l,e,t){const n=l.slice();return n[20]=e[t],n}function jl(l,e,t){const n=l.slice();return n[20]=e[t],n}function Nl(l){var u,d;let e,t,n,i=[],s=new Map,r,o,a,f,c=(d=(u=l[0])==null?void 0:u.tag)!=null?d:[];const p=g=>g[20].id;for(let g=0;g<c.length;g+=1){let b=jl(l,c,g),y=p(b);s.set(y,i[g]=Pl(y,b))}let _=l[1]!==null&&l[0]&&l[1]===l[0].id&&l[3].length&&xl(l);return{c(){e=w("div"),t=w("div"),t.innerHTML=`Add tag
			<div class="flex flex_cx flex_cy h100 pos_abs tag_delete_btn svelte-elfos6">+</div>`,n=j();for(let g=0;g<i.length;g+=1)i[g].c();r=j(),_&&_.c(),v(t,"class","flex flex_cx flex_cy overhide cursor_ptr pos_rel tag_add tag svelte-elfos6"),K(t,"disabled",l[3].length===0),v(e,"class","flex tag_list unselect pos_rel svelte-elfos6")},m(g,b){P(g,e,b),m(e,t),m(e,n);for(let y=0;y<i.length;y+=1)i[y].m(e,null);m(e,r),_&&_.m(e,null),l[14](e),o=!0,a||(f=te(t,"click",l[13]),a=!0)},p(g,b){var y,h;(!o||b&8)&&K(t,"disabled",g[3].length===0),b&325&&(c=(h=(y=g[0])==null?void 0:y.tag)!=null?h:[],we(),i=Xe(i,b,p,1,g,c,s,e,et,Pl,r,jl),ye()),g[1]!==null&&g[0]&&g[1]===g[0].id&&g[3].length?_?(_.p(g,b),b&11&&E(_,1)):(_=xl(g),_.c(),E(_,1),_.m(e,null)):_&&(we(),G(_,1,1,()=>{_=null}),ye())},i(g){if(!o){for(let b=0;b<c.length;b+=1)E(i[b]);E(_),o=!0}},o(g){for(let b=0;b<i.length;b+=1)G(i[b]);G(_),o=!1},d(g){g&&N(e);for(let b=0;b<i.length;b+=1)i[b].d();_&&_.d(),l[14](null),a=!1,f()}}}function Fl(l){let e,t,n;return t=new It({}),{c(){e=w("div"),ge(t.$$.fragment),v(e,"class","pos_abs tag_loading svelte-elfos6")},m(i,s){P(i,e,s),ue(t,e,null),n=!0},i(i){n||(E(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&N(e),de(t)}}}function Pl(l,e){let t,n=e[20].title.toLowerCase()+"",i,s,r,o,a=e[2]===e[6](e[0].id,e[20]),f,c,p,_=a&&Fl();return{key:l,first:null,c(){t=w("div"),i=se(n),s=j(),r=w("div"),r.textContent="X",o=j(),_&&_.c(),v(r,"class","flex flex_cx flex_cy h100 pos_abs tag_delete_btn svelte-elfos6"),v(t,"class","flex flex_cx flex_cy overhide cursor_ptr pos_rel tag svelte-elfos6"),F(t,"background",e[20].background_color),F(t,"color",e[20].color),K(t,"disabled",e[2]),this.first=t},m(u,d){P(u,t,d),m(t,i),m(t,s),m(t,r),m(t,o),_&&_.m(t,null),f=!0,c||(p=te(t,"click",function(){He(e[8](e[20]))&&e[8](e[20]).apply(this,arguments)}),c=!0)},p(u,d){e=u,(!f||d&1)&&n!==(n=e[20].title.toLowerCase()+"")&&he(i,n),d&5&&(a=e[2]===e[6](e[0].id,e[20])),a?_?d&5&&E(_,1):(_=Fl(),_.c(),E(_,1),_.m(t,null)):_&&(we(),G(_,1,1,()=>{_=null}),ye()),(!f||d&1)&&F(t,"background",e[20].background_color),(!f||d&1)&&F(t,"color",e[20].color),(!f||d&4)&&K(t,"disabled",e[2])},i(u){f||(E(_),f=!0)},o(u){G(_),f=!1},d(u){u&&N(t),_&&_.d(),c=!1,p()}}}function xl(l){let e,t,n=[],i=new Map,s,r,o=l[3];const a=f=>f[20].title;for(let f=0;f<o.length;f+=1){let c=Al(l,o,f),p=a(c);i.set(p,n[f]=Bl(p,c))}return{c(){e=w("div"),t=w("div");for(let f=0;f<n.length;f+=1)n[f].c();v(t,"class","flex tagAddList1 svelte-elfos6"),F(t,"flex-wrap","wrap"),v(e,"class","pos_abs tag_settings flex flex_clm svelte-elfos6")},m(f,c){P(f,e,c),m(e,t);for(let p=0;p<n.length;p+=1)n[p].m(t,null);r=!0},p(f,c){c&205&&(o=f[3],we(),n=Xe(n,c,a,1,f,o,i,t,et,Bl,null,Al),ye())},i(f){if(!r){for(let c=0;c<o.length;c+=1)E(n[c]);f&&Ee(()=>{s||(s=Se(e,Mt,{},!0)),s.run(1)}),r=!0}},o(f){for(let c=0;c<n.length;c+=1)G(n[c]);f&&(s||(s=Se(e,Mt,{},!1)),s.run(0)),r=!1},d(f){f&&N(e);for(let c=0;c<n.length;c+=1)n[c].d();f&&s&&s.end()}}}function zl(l){let e,t,n;return t=new It({}),{c(){e=w("div"),ge(t.$$.fragment),v(e,"class","pos_abs tag_loading svelte-elfos6")},m(i,s){P(i,e,s),ue(t,e,null),n=!0},i(i){n||(E(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&N(e),de(t)}}}function Bl(l,e){let t,n=e[20].title+"",i,s,r,o=e[2]===e[6](e[0].id,e[20]),a,f,c,p,_=o&&zl();return{key:l,first:null,c(){t=w("div"),i=se(n),s=w("div"),s.textContent="+",r=j(),_&&_.c(),a=j(),v(s,"class","flex flex_cx flex_cy h100 pos_abs tag_delete_btn svelte-elfos6"),v(t,"class","flex flex_cx flex_cy overhide cursor_ptr pos_rel tag_add tag svelte-elfos6"),F(t,"background",e[20].background_color),F(t,"color",e[20].color),K(t,"disabled",e[2]),this.first=t},m(u,d){P(u,t,d),m(t,i),m(t,s),m(t,r),_&&_.m(t,null),m(t,a),f=!0,c||(p=te(t,"click",function(){He(e[7](e[20]))&&e[7](e[20]).apply(this,arguments)}),c=!0)},p(u,d){e=u,(!f||d&8)&&n!==(n=e[20].title+"")&&he(i,n),d&13&&(o=e[2]===e[6](e[0].id,e[20])),o?_?d&13&&E(_,1):(_=zl(),_.c(),E(_,1),_.m(t,a)):_&&(we(),G(_,1,1,()=>{_=null}),ye()),(!f||d&8)&&F(t,"background",e[20].background_color),(!f||d&8)&&F(t,"color",e[20].color),(!f||d&4)&&K(t,"disabled",e[2])},i(u){f||(E(_),f=!0)},o(u){G(_),f=!1},d(u){u&&N(t),_&&_.d(),c=!1,p()}}}function qs(l){let e,t,n,i,s=l[0]&&Nl(l);return{c(){s&&s.c(),e=Je()},m(r,o){s&&s.m(r,o),P(r,e,o),t=!0,n||(i=[te(window,"mousedown",l[9]),te(window,"blur",l[9])],n=!0)},p(r,[o]){r[0]?s?(s.p(r,o),o&1&&E(s,1)):(s=Nl(r),s.c(),E(s,1),s.m(e.parentNode,e)):s&&(we(),G(s,1,1,()=>{s=null}),ye())},i(r){t||(E(s),t=!0)},o(r){G(s),t=!1},d(r){s&&s.d(r),r&&N(e),n=!1,Ae(i)}}}function Ys(l,e,t){let n,i,{app:s}=e;const{dialogMap_r:r,dialogMap_SetDialog:o}=s;Le(l,r,M=>t(12,i=M));let{dialog_id:a=null}=e,f=null,c=!1;const p=async(M,k)=>{const C=await s.api.dialog_SetTags(n.id,k);return C&&o(C),C},_=(M,k)=>{var C;return`${M}|${(C=k==null?void 0:k.title)!=null?C:"*"}`},u=M=>async k=>{if(!n||c)return;t(2,c=_(n.id,M));const C={color:"#fff",background_color:"#f00",...M,title:M.title.toLowerCase().trim()};await p(n.id,[...n.tag,C]),t(2,c=!1)},d=M=>async k=>{if(!n||c)return;t(2,c=_(n.id,M));const C=n.tag.filter(I=>I.id!==M.id).map(I=>({title:I.title,color:I.color,background_color:I.background_color}));await p(n.id,C),t(2,c=!1)};let g=[];function b(){var k;if(!n)return;const M=new Set(((k=n==null?void 0:n.tag)!=null?k:[]).map(C=>C.title));t(3,g=g_Config.pinnedTags.filter(C=>!M.has(C.title)))}let y;const h=M=>{let k=M.target;for(;k;){if(k===y)return;k=k.parentNode}t(1,f=null)},S=()=>t(1,f=n.id);function T(M){xe[M?"unshift":"push"](()=>{y=M,t(4,y)})}return l.$$set=M=>{"app"in M&&t(10,s=M.app),"dialog_id"in M&&t(11,a=M.dialog_id)},l.$$.update=()=>{l.$$.dirty&6144&&t(0,n=i[a]),l.$$.dirty&1&&b()},[n,f,c,g,y,r,_,u,d,h,s,a,i,S,T]}class Ws extends be{constructor(e){super(),ve(this,e,Ys,qs,pe,{app:10,dialog_id:11})}}function Hl(l){var J,le,re,ie,x,X,ce,q,oe,B;let e,t,n,i,s=((re=(le=(J=l[2])==null?void 0:J.lead)==null?void 0:le.first_name)!=null?re:"")+"",r,o,a,f,c,p=((X=(x=(ie=l[2])==null?void 0:ie.lead)==null?void 0:x.last_name)!=null?X:"")+"",_,u,d,g,b,y,h,S,T,M,k,C,I,A,U,Y=((q=(ce=l[2])==null?void 0:ce.lead)==null?void 0:q.username)&&Rl(l),Z=((B=(oe=l[2])==null?void 0:oe.lead)==null?void 0:B.ref_link)&&Gl(l);return S=new Us({props:{app:l[0],dialog_id:l[2].id}}),C=new Ws({props:{app:l[0],dialog_id:l[2].id}}),{c(){e=w("div"),t=w("div"),n=j(),i=w("div"),r=se(s),o=j(),a=w("div"),f=j(),c=w("div"),_=se(p),u=se("\xA0"),d=j(),g=w("div"),Y&&Y.c(),b=j(),Z&&Z.c(),y=j(),h=w("div"),ge(S.$$.fragment),T=j(),M=w("div"),k=j(),ge(C.$$.fragment),I=j(),A=w("div"),F(t,"width","8px"),F(a,"width","8px"),v(e,"class","flex nowrap textOverEllipsis userFirstLastName pos_rel svelte-qywc37"),v(g,"class","nowrap textOverEllipsis username svelte-qywc37"),F(M,"width","4px"),v(h,"class","flex"),F(A,"height","4px")},m(D,R){P(D,e,R),m(e,t),m(e,n),m(e,i),m(i,r),m(e,o),m(e,a),m(e,f),m(e,c),m(c,_),m(c,u),P(D,d,R),P(D,g,R),Y&&Y.m(g,null),P(D,b,R),Z&&Z.m(D,R),P(D,y,R),P(D,h,R),ue(S,h,null),m(h,T),m(h,M),m(h,k),ue(C,h,null),P(D,I,R),P(D,A,R),U=!0},p(D,R){var Te,je,Oe,ke,me,Ce,O,L,z,W;(!U||R&4)&&s!==(s=((Oe=(je=(Te=D[2])==null?void 0:Te.lead)==null?void 0:je.first_name)!=null?Oe:"")+"")&&he(r,s),(!U||R&4)&&p!==(p=((Ce=(me=(ke=D[2])==null?void 0:ke.lead)==null?void 0:me.last_name)!=null?Ce:"")+"")&&he(_,p),(L=(O=D[2])==null?void 0:O.lead)!=null&&L.username?Y?Y.p(D,R):(Y=Rl(D),Y.c(),Y.m(g,null)):Y&&(Y.d(1),Y=null),(W=(z=D[2])==null?void 0:z.lead)!=null&&W.ref_link?Z?Z.p(D,R):(Z=Gl(D),Z.c(),Z.m(y.parentNode,y)):Z&&(Z.d(1),Z=null);const V={};R&1&&(V.app=D[0]),R&4&&(V.dialog_id=D[2].id),S.$set(V);const Q={};R&1&&(Q.app=D[0]),R&4&&(Q.dialog_id=D[2].id),C.$set(Q)},i(D){U||(E(S.$$.fragment,D),E(C.$$.fragment,D),U=!0)},o(D){G(S.$$.fragment,D),G(C.$$.fragment,D),U=!1},d(D){D&&N(e),D&&N(d),D&&N(g),Y&&Y.d(),D&&N(b),Z&&Z.d(D),D&&N(y),D&&N(h),de(S),de(C),D&&N(I),D&&N(A)}}}function Rl(l){let e,t=l[2].lead.username+"",n;return{c(){e=se("@"),n=se(t)},m(i,s){P(i,e,s),P(i,n,s)},p(i,s){s&4&&t!==(t=i[2].lead.username+"")&&he(n,t)},d(i){i&&N(e),i&&N(n)}}}function Gl(l){var p,_;let e,t,n,i,s=((_=(p=l[2])==null?void 0:p.lead)==null?void 0:_.ref_link)+"",r,o,a,f,c;return{c(){e=w("div"),t=w("div"),t.innerHTML=`Ref link
						<img src="assets/icons/copy-clipboard.png" class="refLinkIcon svelte-qywc37" style="width: 14px; height: 14px; filter: invert(1);"/>`,n=j(),i=w("div"),r=se(s),o=j(),a=w("div"),v(t,"class","flex flex_cy h100 refLinkLabel svelte-qywc37"),v(i,"class","flex flex_cy h100 overhide textOverEllipsis nowrap refLinkContent svelte-qywc37"),v(e,"class","flex flex_cy nowrap refLink overhide textOverEllipsis cursor_ptr unselect svelte-qywc37"),F(a,"height","4px")},m(u,d){P(u,e,d),m(e,t),m(e,n),m(e,i),m(i,r),P(u,o,d),P(u,a,d),f||(c=te(e,"click",l[6]),f=!0)},p(u,d){var g,b;d&4&&s!==(s=((b=(g=u[2])==null?void 0:g.lead)==null?void 0:b.ref_link)+"")&&he(r,s)},d(u){u&&N(e),u&&N(o),u&&N(a),f=!1,c()}}}function Ul(l){let e,t,n,i;return t=new It({}),{c(){e=w("div"),ge(t.$$.fragment),v(e,"class","pos_abs loading svelte-qywc37")},m(s,r){P(s,e,r),ue(t,e,null),i=!0},i(s){i||(E(t.$$.fragment,s),s&&Ee(()=>{n||(n=Se(e,Ie,{},!0)),n.run(1)}),i=!0)},o(s){G(t.$$.fragment,s),s&&(n||(n=Se(e,Ie,{},!1)),n.run(0)),i=!1},d(s){s&&N(e),de(t),s&&n&&n.end()}}}function Js(l){let e,t,n,i,s=l[2]&&Hl(l),r=l[1]&&Ul();return{c(){e=w("div"),t=w("div"),s&&s.c(),n=j(),r&&r.c(),v(t,"class","flex flex_clm flex_cx flex_grow_1"),v(e,"class","flex flex_cy header pos_rel svelte-qywc37")},m(o,a){P(o,e,a),m(e,t),s&&s.m(t,null),m(e,n),r&&r.m(e,null),i=!0},p(o,[a]){o[2]?s?(s.p(o,a),a&4&&E(s,1)):(s=Hl(o),s.c(),E(s,1),s.m(t,null)):s&&(we(),G(s,1,1,()=>{s=null}),ye()),o[1]?r?a&2&&E(r,1):(r=Ul(),r.c(),E(r,1),r.m(e,null)):r&&(we(),G(r,1,1,()=>{r=null}),ye())},i(o){i||(E(s),E(r),i=!0)},o(o){G(s),G(r),i=!1},d(o){o&&N(e),s&&s.d(),r&&r.d()}}}function Vs(l,e,t){let n,i,{app:s}=e;const{dialogMap_r:r}=s;Le(l,r,c=>t(5,i=c));let{dialog_id:o=null}=e,{loading:a=!1}=e;const f=()=>{var c;return xn((c=n==null?void 0:n.lead)==null?void 0:c.ref_link)};return l.$$set=c=>{"app"in c&&t(0,s=c.app),"dialog_id"in c&&t(4,o=c.dialog_id),"loading"in c&&t(1,a=c.loading)},l.$$.update=()=>{l.$$.dirty&48&&t(2,n=i[o])},[s,a,n,r,o,i,f]}class Xs extends be{constructor(e){super(),ve(this,e,Vs,Js,pe,{app:0,dialog_id:4,loading:1})}}function ql(l,e,t){const n=l.slice();return n[36]=e[t],n}function Yl(l,e){let t,n,i;return n=new Es({props:{app:e[0],bbox:e[9],message:e[36],render_Width:e[8]}}),{key:l,first:null,c(){t=Je(),ge(n.$$.fragment),this.first=t},m(s,r){P(s,t,r),ue(n,s,r),i=!0},p(s,r){e=s;const o={};r[0]&1&&(o.app=e[0]),r[0]&512&&(o.bbox=e[9]),r[0]&4&&(o.message=e[36]),r[0]&256&&(o.render_Width=e[8]),n.$set(o)},i(s){i||(E(n.$$.fragment,s),i=!0)},o(s){G(n.$$.fragment,s),i=!1},d(s){s&&N(t),de(n,s)}}}function Ks(l){let e,t,n,i,s,r,o,a=[],f=new Map,c,p,_,u,d,g,b,y,h,S;t=new Xs({props:{app:l[0],dialog_id:l[1],loading:l[3]}});let T=l[2];const M=I=>I[36].index;for(let I=0;I<T.length;I+=1){let A=ql(l,T,I),U=M(A);f.set(U,a[I]=Yl(U,A))}function k(I){l[17](I)}let C={value_in:l[4]};return l[5]!==void 0&&(C.value_out=l[5]),_=new _n({props:C}),xe.push(()=>Lt(_,"value_out",k)),{c(){e=w("div"),ge(t.$$.fragment),n=j(),i=w("div"),s=w("div"),r=w("div"),o=w("div");for(let I=0;I<a.length;I+=1)a[I].c();c=j(),p=w("div"),ge(_.$$.fragment),d=j(),g=w("div"),b=w("textarea"),v(o,"class","pos_rel w100 h100"),v(p,"class","pos_abs h100 chatScroll svelte-1khz9us"),v(r,"class","pos_rel w100 h100"),v(s,"class","flex pos_abs overhide"),v(i,"class","flex flex_grow_1 pos_rel overhide"),v(b,"class","flex flex_grow_1 chat_input_textarea svelte-1khz9us"),v(g,"class","flex chat_input svelte-1khz9us"),v(e,"class","flex flex_clm flex_grow_1 overhide cnt svelte-1khz9us")},m(I,A){P(I,e,A),ue(t,e,null),m(e,n),m(e,i),m(i,s),m(s,r),m(r,o);for(let U=0;U<a.length;U+=1)a[U].m(o,null);l[16](o),m(r,c),m(r,p),ue(_,p,null),m(e,d),m(e,g),m(g,b),Kt(b,l[7]),y=!0,h||(S=[te(r,"wheel",l[13],{passive:!0}),at(Dt.call(null,s,l[11])),te(b,"input",l[18]),te(b,"keyup",l[12]),te(b,"keydown",l[12])],h=!0)},p(I,A){const U={};A[0]&1&&(U.app=I[0]),A[0]&2&&(U.dialog_id=I[1]),A[0]&8&&(U.loading=I[3]),t.$set(U),A[0]&773&&(T=I[2],we(),a=Xe(a,A,M,1,I,T,f,o,et,Yl,null,ql),ye());const Y={};A[0]&16&&(Y.value_in=I[4]),!u&&A[0]&32&&(u=!0,Y.value_out=I[5],St(()=>u=!1)),_.$set(Y),A[0]&128&&Kt(b,I[7])},i(I){if(!y){E(t.$$.fragment,I);for(let A=0;A<T.length;A+=1)E(a[A]);E(_.$$.fragment,I),y=!0}},o(I){G(t.$$.fragment,I);for(let A=0;A<a.length;A+=1)G(a[A]);G(_.$$.fragment,I),y=!1},d(I){I&&N(e),de(t);for(let A=0;A<a.length;A+=1)a[A].d();l[16](null),de(_),h=!1,Ae(S)}}}const Wl=10,pt=4;function Zs(l,e,t){let n,i,s,{app:r}=e;const{dialogMap_r:o}=r;Le(l,o,q=>t(15,i=q));let{dialog_id:a=null}=e,f=[],c=[],p=new Set,_=0,u=0,d=1,g=1,b=null;const y=Re(null);Le(l,y,q=>t(9,s=q)),new Date().toJSON();let h=-1;async function S(q,oe=0,B=20){const D=await r.api.message_GetList({dialog_id:q,offset:oe,limit:B});if(!!D&&n&&n.id===q){for(_=D.count;f.length<_;){const V=f.length;f.push({id:h--,index:V,_isFakeMsg:!0})}const R=D.results.map(V=>{var Q;return(Q=V==null?void 0:V.attachments)!=null&&Q.length&&V.attachments.map(Te=>{var je,Oe,ke,me,Ce,O,L,z;if((Oe=(je=r==null?void 0:r.appConfig)==null?void 0:je.api)!=null&&Oe.attachments_OverwriteApiHostProtocol)try{const W=new URL(Te.url);W.protocol=(Ce=(me=(ke=r==null?void 0:r.appConfig)==null?void 0:ke.api)==null?void 0:me.protocol)!=null?Ce:location.protocol,W.host=(z=(L=(O=r==null?void 0:r.appConfig)==null?void 0:O.api)==null?void 0:L.host)!=null?z:location.host,Te.url=String(W)}catch{}}),V});R.map((V,Q)=>V.index=oe+Q),R.map(V=>f[V.index]=V)}}let T="";const M=async q=>{if(q.which===13&&!q.shiftKey&&!q.ctrlKey&&(q.preventDefault(),t(7,T=T.trim()),T)){const oe=T;t(7,T=""),n&&await r.api.message_Create(n.id,oe)}};function k(){f=[],t(2,c=[]),p=new Set,_=0,console.log("clear all")}let C=null,I=null;async function A(q){if(!q){if(!C)return;C=null,k();return}I!==q.id&&(C=q,I=q.id,k(),f=[],t(2,c=[]),_=0,t(3,u++,u),await S(q.id),_&&await S(q.id,Math.max(_-20,0),20),await r.api.dialog_SetReadFlagAllMessages(q.id),t(3,u--,u))}let U=1,Y=!0;function Z(){if(Y&&requestAnimationFrame(Z),!s||!b||!f.length)return;s.width;const q=s.height,oe=s.width-Wl*2,B=Wl;t(8,U=oe-Math.max(120,Math.floor(oe*.1)));const D=1+g*(f.length-1);let R=Math.floor(D),V=D-R;R>=f.length&&(R=f.length-1,V=1);const Q=[],Te=[];let je=null;t(2,c=[]);for(let ke=R-100,me=0,Ce=!0;ke<R+100;ke++)ke<0||ke>=f.length||(f[ke]._isFakeMsg&&p.add(ke),c[me]!==f[ke]&&(Ce&&(Ce=!1,c.splice(me,1e9)),t(2,c[me]=f[ke],c),t(2,c)),t(2,c[me]._drawIndex=me,c),ke<R&&Q.push(c[me]),ke>R&&Te.push(c[me]),ke===R&&(je=c[me]),me++);const Oe=[...b.children];if(Oe.length===c.length){Oe.map((L,z)=>{const W=c[z];if(!W||L._remove)return;const $=L.getBoundingClientRect();L._bbox=$;const ne=Math.floor(B+(W.incoming?0:Math.max(100,s.width*.05)));L.__cacheWidth!==U&&(L.__cacheWidth=U,L.style.maxWidth=U+"px"),L.__cacheLeft!==ne&&(L.__cacheLeft=ne,L.style.left=ne+"px")});const ke=(L,z,W=1)=>(L.__cacheTop!==z&&(L.__cacheTop=z,L.style.transform=`translate3d(0px, ${z}px, 0px)`),z+(L._bbox.height+pt)*W);let me=0,Ce=0;const O=Oe[je._drawIndex];if(O){const L=O;me=q+pt-(L._bbox.height+pt)*V,Ce=me,me=ke(L,me,1)}Te.map((L,z)=>{const W=Oe[L._drawIndex];me=ke(W,me,1)}),me=Ce,Q.reverse().map((L,z)=>{const W=Oe[L._drawIndex];me-=W._bbox.height+pt,ke(W,me,0)})}}requestAnimationFrame(Z),Be(()=>Y=!1);async function J(){if(p.size){const q=[...p].sort((D,R)=>D-R);p.clear();const oe=[];let B={offset:null,limit:0};for(const D of q){if(B.offset!==null){if(B.limit<=500&&B.offset+B.limit===D){B.limit++;continue}oe.push(B)}B={offset:D,limit:1}}B.offset!==null&&oe.push(B),n&&(t(3,u++,u),await Promise.all(oe.map(D=>S(n.id,D.offset,D.limit))),t(3,u--,u))}Y&&setTimeout(J,500)}J();async function le(){n&&await r.api.dialog_SetReadFlagAllMessages(n.id),Y&&setTimeout(le,5e3)}le();async function re(){n&&await S(n.id,_,20),Y&&setTimeout(re,500)}re();const ie=q=>{t(4,d=f.length?g+Math.sign(q.deltaY)/(f.length-1):0)};function x(q){xe[q?"unshift":"push"](()=>{b=q,t(6,b)})}function X(q){g=q,t(5,g)}function ce(){T=this.value,t(7,T)}return l.$$set=q=>{"app"in q&&t(0,r=q.app),"dialog_id"in q&&t(1,a=q.dialog_id)},l.$$.update=()=>{l.$$.dirty[0]&32770&&t(14,n=i[a]),l.$$.dirty[0]&16384&&A(n)},[r,a,c,u,d,g,b,T,U,s,o,y,M,ie,n,i,x,X,ce]}class Qs extends be{constructor(e){super(),ve(this,e,Zs,Ks,pe,{app:0,dialog_id:1},null,[-1,-1])}}function $s(l){let e,t,n,i,s,r,o,a,f,c,p,_,u,d,g,b,y,h,S,T,M;function k(U){l[5](U)}let C={};l[2]!==void 0&&(C.checked=l[2]),c=new ps({props:C}),xe.push(()=>Lt(c,"checked",k));function I(U){l[6](U)}let A={app:l[0]};return l[1]!==void 0&&(A.filterTag=l[1]),u=new Ds({props:A}),xe.push(()=>Lt(u,"filterTag",I)),h=new Ms({props:{app:l[0],filter:{filterTag:l[1],filterUnreadFirst:l[2]}}}),T=new Qs({props:{app:l[0],dialog_id:l[3]}}),{c(){e=w("div"),t=w("div"),n=w("div"),i=j(),s=w("div"),r=w("label"),o=se(`First unread \r
				`),a=w("div"),f=j(),ge(c.$$.fragment),_=j(),ge(u.$$.fragment),g=j(),b=w("div"),y=j(),ge(h.$$.fragment),S=j(),ge(T.$$.fragment),F(n,"height","2px"),F(a,"width","4px"),v(r,"class","flex flex_cy cursor_ptr unselect firstUnread svelte-14xikx8"),v(s,"class","flex flex_clm flex_cx header pos_rel svelte-14xikx8"),F(b,"height","20px"),v(t,"class","flex flex_clm list svelte-14xikx8"),v(e,"class","flex flex_grow_1")},m(U,Y){P(U,e,Y),m(e,t),m(t,n),m(t,i),m(t,s),m(s,r),m(r,o),m(r,a),m(r,f),ue(c,r,null),m(s,_),ue(u,s,null),m(t,g),m(t,b),m(t,y),ue(h,t,null),m(e,S),ue(T,e,null),M=!0},p(U,[Y]){const Z={};!p&&Y&4&&(p=!0,Z.checked=U[2],St(()=>p=!1)),c.$set(Z);const J={};Y&1&&(J.app=U[0]),!d&&Y&2&&(d=!0,J.filterTag=U[1],St(()=>d=!1)),u.$set(J);const le={};Y&1&&(le.app=U[0]),Y&6&&(le.filter={filterTag:U[1],filterUnreadFirst:U[2]}),h.$set(le);const re={};Y&1&&(re.app=U[0]),Y&8&&(re.dialog_id=U[3]),T.$set(re)},i(U){M||(E(c.$$.fragment,U),E(u.$$.fragment,U),E(h.$$.fragment,U),E(T.$$.fragment,U),M=!0)},o(U){G(c.$$.fragment,U),G(u.$$.fragment,U),G(h.$$.fragment,U),G(T.$$.fragment,U),M=!1},d(U){U&&N(e),de(c),de(u),de(h),de(T)}}}function ei(l,e,t){let n,{app:i}=e;const{dialogActiveID_r:s}=i;Le(l,s,c=>t(3,n=c));let r=null,o=1;function a(c){o=c,t(2,o)}function f(c){r=c,t(1,r)}return l.$$set=c=>{"app"in c&&t(0,i=c.app)},[i,r,o,n,s,a,f]}class ti extends be{constructor(e){super(),ve(this,e,ei,$s,pe,{app:0})}}function li(l){let e,t,n,i,s,r,o,a,f,c,p,_,u,d,g,b;return{c(){e=w("div"),t=w("div"),n=w("div"),i=w("img"),r=j(),o=w("div"),a=w("div"),a.innerHTML='<img class="w100 h100 svelte-d45see" draggable="false" src="assets/icons/rotate.png"/>',f=j(),c=w("div"),c.innerHTML='<img class="w100 h100 svelte-d45see" draggable="false" src="assets/icons/download.png"/>',p=j(),_=w("div"),_.innerHTML='<img class="w100 h100 svelte-d45see" draggable="false" src="assets/icons/close.png"/>',v(i,"class","img svelte-d45see"),v(i,"draggable","false"),Ze(i.src,s=l[0])||v(i,"src",s),F(i,"transform","rotate("+l[3]+"deg)"),v(n,"class","pos_abs flex flex_cx flex_cy pad svelte-d45see"),F(n,"width",l[5]+"px"),F(n,"height",l[4]+"px"),v(t,"class","pos_abs flex flex_cx flex_cy pos_abs w100 h100 "),F(t,"transform","translate("+l[1]+"px, "+l[2]+"px)"),v(a,"class","flex cursor_ptr imgCtrlBtn svelte-d45see"),v(c,"class","flex cursor_ptr imgCtrlBtn svelte-d45see"),v(_,"class","flex cursor_ptr imgCtrlBtn svelte-d45see"),v(o,"class","flex pos_abs imgCtrlBtnGroup svelte-d45see"),v(e,"class","pos_abs w100 h100 unselect cnt layer_bg svelte-d45see")},m(y,h){P(y,e,h),m(e,t),m(t,n),m(n,i),m(e,r),m(e,o),m(o,a),m(o,f),m(o,c),m(o,p),m(o,_),d=!0,g||(b=[te(window,"mousemove",l[14]),te(window,"mouseup",l[13]),te(window,"blur",l[13]),te(window,"keydown",l[16]),te(i,"mousedown",l[12]),at(Dt.call(null,t,l[6])),te(a,"click",l[10]),te(c,"click",function(){He(Pt(l[0]))&&Pt(l[0]).apply(this,arguments)}),te(_,"click",l[15]),te(e,"wheel",l[11])],g=!0)},p(y,[h]){l=y,(!d||h&1&&!Ze(i.src,s=l[0]))&&v(i,"src",s),(!d||h&8)&&F(i,"transform","rotate("+l[3]+"deg)"),(!d||h&32)&&F(n,"width",l[5]+"px"),(!d||h&16)&&F(n,"height",l[4]+"px"),(!d||h&6)&&F(t,"transform","translate("+l[1]+"px, "+l[2]+"px)")},i(y){d||(Ee(()=>{u||(u=Se(e,Ie,{duration:100},!0)),u.run(1)}),d=!0)},o(y){u||(u=Se(e,Ie,{duration:100},!1)),u.run(0),d=!1},d(y){y&&N(e),y&&u&&u.end(),g=!1,Ae(b)}}}function ni(l,e,t){let n,i,s,r,{url:o=null}=e;const a=Ln(),f=Re(null);Le(l,f,A=>t(18,n=A));const c=We(0);Le(l,c,A=>t(3,i=A));const p=We(0);Le(l,p,A=>t(5,r=A));const _=We(0);Le(l,_,A=>t(4,s=A));let u=0,d=0,g={rotate:0,scale:1,whInverse:!1};const b=()=>{if(!n||!g)return;const A=g.whInverse?n.height:n.width,U=g.whInverse?n.width:n.height;Ye(p,r=A*g.scale,r),Ye(_,s=U*g.scale,s),Ye(c,i=g.rotate,i)},y=()=>{!n||!g||(t(17,g.rotate+=90,g),t(17,g.whInverse=!g.whInverse,g),t(17,g))},h=A=>{t(17,g.scale=Pe(.1,g.scale+Math.sign(A.deltaY)*.1,10),g)};let S=null;const T=A=>S=[A.clientX,A.clientY,u,d],M=A=>S=null,k=A=>{!S||t(1,[u,d]=[A.clientX,A.clientY].map((U,Y)=>U-S[Y]+S[Y+2]),u,t(2,d))},C=A=>a("close"),I=A=>A.which===27&&C();return l.$$set=A=>{"url"in A&&t(0,o=A.url)},l.$$.update=()=>{l.$$.dirty&393216&&b()},[o,u,d,i,s,r,f,c,p,_,y,h,T,M,k,C,I,g,n]}class si extends be{constructor(e){super(),ve(this,e,ni,li,pe,{url:0})}}function Jl(l){let e=l[0],t,n,i=Vl(l);return{c(){i.c(),t=Je()},m(s,r){i.m(s,r),P(s,t,r),n=!0},p(s,r){r&1&&pe(e,e=s[0])?(we(),G(i,1,1,fe),ye(),i=Vl(s),i.c(),E(i,1),i.m(t.parentNode,t)):i.p(s,r)},i(s){n||(E(i),n=!0)},o(s){G(i),n=!1},d(s){s&&N(t),i.d(s)}}}function Vl(l){let e,t;return e=new si({props:{url:l[1]}}),e.$on("close",l[3]),{c(){ge(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},p(n,i){const s={};i&2&&(s.url=n[1]),e.$set(s)},i(n){t||(E(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){de(e,n)}}}function ii(l){let e,t,n=l[1]&&Jl(l);return{c(){n&&n.c(),e=Je()},m(i,s){n&&n.m(i,s),P(i,e,s),t=!0},p(i,[s]){i[1]?n?(n.p(i,s),s&2&&E(n,1)):(n=Jl(i),n.c(),E(n,1),n.m(e.parentNode,e)):n&&(we(),G(n,1,1,()=>{n=null}),ye())},i(i){t||(E(n),t=!0)},o(i){G(n),t=!1},d(i){n&&n.d(i),i&&N(e)}}}function ri(l,e,t){let n=1,i=null,{events:s}=e;Be(s.on("openOverlayImageView",o=>{t(0,n++,n),t(1,i=o)}));const r=()=>t(1,i=null);return l.$$set=o=>{"events"in o&&t(2,s=o.events)},[n,i,s,r]}class oi extends be{constructor(e){super(),ve(this,e,ri,ii,pe,{events:2})}}function ai(l){let e,t,n,i,s,r,o,a,f,c,p,_=fi;return i=new os({props:{app:l[0]}}),r=new _s({props:{app:l[0]}}),a=new ti({props:{app:l[0]}}),c=new oi({props:{events:l[0].events}}),{c(){e=w("div"),t=j(),n=w("div"),ge(i.$$.fragment),s=j(),ge(r.$$.fragment),o=j(),ge(a.$$.fragment),f=j(),ge(c.$$.fragment),v(n,"class","flex flex_clm flex_grow_1 leftBlock svelte-ufyhtq"),v(e,"class","flex w100 h100 pos_rel")},m(u,d){P(u,e,d),m(e,t),m(e,n),ue(i,n,null),m(n,s),ue(r,n,null),m(e,o),ue(a,e,null),m(e,f),ue(c,e,null),p=!0},p(u,[d]){},i(u){p||(E(_),E(i.$$.fragment,u),E(r.$$.fragment,u),E(a.$$.fragment,u),E(c.$$.fragment,u),p=!0)},o(u){G(_),G(i.$$.fragment,u),G(r.$$.fragment,u),G(a.$$.fragment,u),G(c.$$.fragment,u),p=!1},d(u){u&&N(e),de(i),de(r),de(a),de(c)}}}const fi=!1;function ci(l,e,t){let{operatorSelf:n}=e,{config:i}=e,{notifyEvents:s}=e,{createApi:r}=e;const o=r(n.username),a=Rn(n,i,o);return Be(a.destroy),l.$$set=f=>{"operatorSelf"in f&&t(1,n=f.operatorSelf),"config"in f&&t(2,i=f.config),"notifyEvents"in f&&t(3,s=f.notifyEvents),"createApi"in f&&t(4,r=f.createApi)},[a,n,i,s,r]}class ui extends be{constructor(e){super(),ve(this,e,ci,ai,pe,{operatorSelf:1,config:2,notifyEvents:3,createApi:4})}}function Xl(l,e,t){const n=l.slice();return n[6]=e[t],n}function di(l){let e,t,n=l[0],i=[];for(let r=0;r<n.length;r+=1)i[r]=Zl(Xl(l,n,r));const s=r=>G(i[r],1,1,()=>{i[r]=null});return{c(){for(let r=0;r<i.length;r+=1)i[r].c();e=Je()},m(r,o){for(let a=0;a<i.length;a+=1)i[a].m(r,o);P(r,e,o),t=!0},p(r,o){if(o&5){n=r[0];let a;for(a=0;a<n.length;a+=1){const f=Xl(r,n,a);i[a]?(i[a].p(f,o),E(i[a],1)):(i[a]=Zl(f),i[a].c(),E(i[a],1),i[a].m(e.parentNode,e))}for(we(),a=n.length;a<i.length;a+=1)s(a);ye()}},i(r){if(!t){for(let o=0;o<n.length;o+=1)E(i[o]);t=!0}},o(r){i=i.filter(Boolean);for(let o=0;o<i.length;o+=1)G(i[o]);t=!1},d(r){Ot(i,r),r&&N(e)}}}function _i(l){let e,t,n,i,s;return i=new It({}),{c(){e=w("div"),t=w("div"),n=j(),ge(i.$$.fragment),F(t,"height","20px"),v(e,"class","flex flex_clm flex_grow_1 flex_cy")},m(r,o){P(r,e,o),m(e,t),m(e,n),ue(i,e,null),s=!0},p:fe,i(r){s||(E(i.$$.fragment,r),s=!0)},o(r){G(i.$$.fragment,r),s=!1},d(r){r&&N(e),de(i)}}}function Kl(l){let e,t,n=l[6].username+"",i;return{c(){e=w("div"),t=se("@"),i=se(n),v(e,"class","nowrap textOverEllipsis")},m(s,r){P(s,e,r),m(e,t),m(e,i)},p(s,r){r&1&&n!==(n=s[6].username+"")&&he(i,n)},d(s){s&&N(e)}}}function Zl(l){var S,T;let e,t,n,i=((S=l[6].first_name)!=null?S:"")+"",s,r,o,a,f,c=((T=l[6].last_name)!=null?T:"")+"",p,_,u,d,g,b,y,h=l[6].username&&Kl(l);return{c(){e=w("div"),t=w("div"),n=w("div"),s=se(i),r=j(),o=w("div"),a=j(),f=w("div"),p=se(c),_=j(),h&&h.c(),u=j(),F(o,"width","8px"),v(t,"class","flex nowrap textOverEllipsis"),v(e,"class","flex flex_clm cursor_ptr item unselect svelte-1n771m2")},m(M,k){P(M,e,k),m(e,t),m(t,n),m(n,s),m(t,r),m(t,o),m(t,a),m(t,f),m(f,p),m(e,_),h&&h.m(e,null),m(e,u),g=!0,b||(y=te(e,"click",function(){He(l[2](l[6]))&&l[2](l[6]).apply(this,arguments)}),b=!0)},p(M,k){var C,I;l=M,(!g||k&1)&&i!==(i=((C=l[6].first_name)!=null?C:"")+"")&&he(s,i),(!g||k&1)&&c!==(c=((I=l[6].last_name)!=null?I:"")+"")&&he(p,c),l[6].username?h?h.p(l,k):(h=Kl(l),h.c(),h.m(e,u)):h&&(h.d(1),h=null)},i(M){g||(M&&Ee(()=>{d||(d=Se(e,Ie,{},!0)),d.run(1)}),g=!0)},o(M){M&&(d||(d=Se(e,Ie,{},!1)),d.run(0)),g=!1},d(M){M&&N(e),h&&h.d(),M&&d&&d.end(),b=!1,y()}}}function gi(l){let e,t,n,i;const s=[_i,di],r=[];function o(a,f){return a[1]?0:1}return t=o(l),n=r[t]=s[t](l),{c(){e=w("div"),n.c(),v(e,"class","flex list flex_grow_1 svelte-1n771m2")},m(a,f){P(a,e,f),r[t].m(e,null),i=!0},p(a,[f]){let c=t;t=o(a),t===c?r[t].p(a,f):(we(),G(r[c],1,1,()=>{r[c]=null}),ye(),n=r[t],n?n.p(a,f):(n=r[t]=s[t](a),n.c()),E(n,1),n.m(e,null))},i(a){i||(E(n),i=!0)},o(a){G(n),i=!1},d(a){a&&N(e),r[t].d()}}}function mi(l,e,t){let{api:n}=e,i=[],s=!1;const r=async()=>{var f,c;t(1,s=!0),t(0,i=(c=(f=await n.operator_GetList())==null?void 0:f.results)!=null?c:[]),t(1,s=!1)};let o=!1;const a=f=>c=>{o||(cn(f),o=!0)};return r(),l.$$set=f=>{"api"in f&&t(3,n=f.api)},[i,s,a,n]}class pi extends be{constructor(e){super(),ve(this,e,mi,gi,pe,{api:3})}}const hi=l=>typeof l=="number"&&String(l|0)===String(l);class gn extends Error{}const Ue=async(l,e=null)=>{try{return await l()}catch{}return e},qt=l=>async e=>{if(await Ue(()=>e.response.status===l))return e;throw new Error(`Invalid response status, expected ${l}`)},vi=qt(200),bi=qt(201),wi=qt(204),yi=async l=>{if(await Ue(()=>hi(l.result.count)&&Array.isArray(l.result.results)))return l;throw new Error("Invalid result, expected list container")},ht=async l=>{if(await Ue(()=>l.result.detail==="Authentication credentials were not provided.")===!0)throw new gn("Not authorized");return l},vt=async l=>({...l,result:l.response.status===204?null:await l.response.json()}),ki=(l,e)=>{var a,f,c;const t=(a=l==null?void 0:l.protocol)!=null?a:location.protocol,n=(f=l==null?void 0:l.host)!=null?f:location.host,i=(c=l==null?void 0:l.path_base)!=null?c:"/",s=`${t}//${n}/${i}`,r=new Set(["POST","PATCH","PUT"]),o={...e!=null?e:{},"content-type":"application/json"};return(p,_,u)=>{const d=p.toUpperCase().trim(),g=_!=null?_:"",b=u!=null?u:{},y=new URL(s);d==="GET"&&Object.entries(b).map(([S,T])=>y.searchParams.append(S,T)),y.pathname=[y.pathname,g].join("/").split("/").filter(Boolean).concat(" ").filter(Boolean).join("/").trim();const h=r.has(d)?JSON.stringify(b):null;return new Request(y,{method:d,headers:o,body:h})}},Si=(l,e,t)=>{var g,b,y;const n=ki(l,e.operator?{"x-username":e.operator}:{}),i=(g=e.onerror)!=null?g:rt,s=(b=e.onnotify)!=null?b:rt,r=(y=e.onNotAuthorizedError)!=null?y:rt,o=t!=null?t:(h,S)=>S(),a=async([h,S,T],M)=>{let k=null,C=null,I={},A=null,U=!1;try{I.request=k=n(h,S,T),I.response=C=await o({request:k,method:h,path:S,options:T},()=>fetch(k));for(const Z of M)I=await Z(I)}catch(Z){A=Z,U=!0}await Ue(()=>{A instanceof gn&&r()});const Y=[];return Y.push(...await Ue(async()=>{const Z=new URL(k.url);return[{type:"normal",chunks:[{color:"#fff",text:k.method},{color:"#000",text:`${Z.pathname}${String(Z.searchParams)?"?"+Z.searchParams:""}`},{color:"#f00",text:await Ue(()=>C.status,"")}]},{type:"mini",text:`${Z.protocol}//${Z.host}`}]},[`${h} ${S}`])),Y.push(await Ue(()=>k.body?"Body: "+JSON.stringify(T).slice(0,100):"")),Y.push(await Ue(()=>I.result.detail?`Detail: ${I.result.detail}`:"")),Y.push(zn(A)),U?i(Y):s(Y),!U&&I.hasOwnProperty("result")?I.result:null},f=[vt,ht],c=[vt,ht,bi],p=[vt,ht,vi],_=[vt,ht,wi],u=[...p,yi],d={};return d.message_GetList=h=>a(["GET","messages",h],u),d.message_Create=(h,S)=>a(["POST","messages",{dialog:h,text:S,is_read:!0}],c),d.dialog_GetList=h=>a(["GET","dialogs",h],u),d.dialog_SetTags=(h,S)=>a(["PATCH",`dialogs/${h}`,{tag:S}],p),d.dialog_SetReadFlagAllMessages=h=>a(["POST",`dialogs/${h}/read`,{}],_),d.lead_GetUnassignedList=h=>a(["GET","leads/unassigned",h],u),d.lead_AssignOperatorSelft=h=>a(["POST",`leads/${h}/assign`,{}],p),d.lead_SetStatus=(h,S)=>a(["PATCH",`leads/${h}`,{status:S}],p),d.lead_GetUnassignedLeadCount=()=>a(["GET","leads/count_free",{}],p),d.lead_AssignOneLead=()=>a(["POST","leads/get_one",{}],[...f,async h=>await Ue(()=>{var S;return h.result=(S={200:!0,400:!1}[h.response.status])!=null?S:null,h})]),d.operatorSelf_GetOnlineInfo=()=>a(["GET","online",{}],p),d.operatorSelf_SetOnlineFlag=h=>a(["PUT","online",{online:!!h}],p),d.operator_GetList=h=>a(["GET","operators",h],u),d},Li=()=>{const l=()=>!0,e=O=>new Promise(L=>setTimeout(L,O)),t=(O,L)=>e(O+Math.round(Math.random()*(L-O))),n=(O,L,z)=>Math.min(z,Math.max(O,L)),i=(O=0)=>new Date(Date.now()+(O!=null?O:0)).toJSON(),s=(O,L)=>{var ee;const z=Math.max(0,(L==null?void 0:L.offset)|0),W=n(1,((ee=L==null?void 0:L.limit)!=null?ee:20)|0,1e6),$=O.length,ne=O.slice(z,z+W);return{count:$,results:ne}};let r=1;const o=O=>(O!=null?O:[]).map(L=>({...L,id:r++}));let a=1;const f=[],c={},p=O=>{var L;return(L=c[O])!=null?L:null},_=()=>f,u=O=>{var z,W,$;const L={operator_id:a++,username:(z=O.username)!=null?z:null,first_name:(W=O.first_name)!=null?W:null,last_name:($=O.last_name)!=null?$:null};return f.push(L),c[L.username]=L,V(L.username),L};let d=123123124;const g=[],b={},y=O=>{var L;return(L=b[O])!=null?L:null},h=()=>g.filter(O=>!O.hasOperator).sort((O,L)=>O._date_joined_msec-L._date_joined_msec),S=()=>({count:g.filter(O=>!O.hasOperator).length}),T=O=>{var W,$,ne;const L=d++,z={tg_id:L,username:(W=O.username)!=null?W:null,first_name:($=O.first_name)!=null?$:null,last_name:(ne=O.last_name)!=null?ne:null,date_joined:i(O.timeDelta),esub:null,pub_id:null,refcode:null,subpub:null,hasOperator:!1,status:"NW2",ref_link:`https://ref.global.com/getRef?tg_id=${L}`};return z._date_joined_msec=+new Date(z.date_joined),g.push(z),b[z.tg_id]=z,z},M=(O,L)=>{const z=y(L);return!z||!p(O)||z.hasOperator?!1:(J(O,L),z.hasOperator=!0,!0)},k=O=>{const L=h();let z=!1;return L.length&&(z=M(O,L[0].tg_id)),z?{status:"lead connected",__status:200}:{status:"error: there is no free leads",__status:400}},C=(O,L,z)=>{const W=y(L);return W?(z.status&&(W.status=z.status),W):null};let I=1;const A=[],U={},Y=O=>{var L;return(L=U[O])!=null?L:null},Z=(O,L=[])=>{O.tag||(O.tag=[],O._tagSearch=new Set);const z=o(L);O.tag.splice(0,1e9),O._tagSearch.clear(),z.map(W=>{O.tag.push(W),O._tagSearch.add(W.title)})},J=(O,L)=>{const z=y(L);if(!z||!p(O))return null;const $={id:I++,lead_id:L,lead:z,operator:O,unread_messages_count:0,last_message:null};return Z($),A.push($),U[$.id]=$,z.hasOperator=!0,$},le=(O,L,z)=>{const W=Y(L);return W?(z.tag&&Z(W,z.tag),W):null},re=(O,L,z)=>{const W=Y(L);return W?(oe(O,{dialog_id:+L}).map(ne=>ne.is_read=!1),W.unread_messages_count=0,!0):null},ie=(O,L={})=>{const z=H=>H.last_message?H.last_message._received_at_msec:H.lead?H.lead._date_joined_msec:0,W=(H,ae)=>ae-H,$=(H,ae)=>{let Me=W(z(H),z(ae));return Me===0&&(Me=W(H.id,ae.id)),Me},ne=A.filter(H=>H.operator===O).filter(L.tag?H=>H._tagSearch.has(L.tag):l).filter(H=>{var ae;return((ae=H==null?void 0:H.lead)==null?void 0:ae.status)!=="DL"});let ee=[],_e=[];return L.unread_first?(ee=ne.filter(H=>H.unread_messages_count!==0),_e=ne.filter(H=>H.unread_messages_count===0)):ee=ne,ee.sort($),_e.sort($),ee.concat(_e)};let x=1;const X=[],ce={},q=(O,L={})=>{var ee,_e,H;const z=+L.dialog,W=L.text,$=Y(z);if(!$)return null;const ne={id:x++,dialog:z,text:W,is_read:(ee=L.is_read)!=null?ee:!0,incoming:(_e=L.incoming)!=null?_e:!1,attachments:(H=L.attachments)!=null?H:[],received_at:i(L.timeDelta)};return ne._received_at_msec=+new Date(ne.received_at),X.push(ne),ce[ne.id]=ne,$.last_message=ne,ne.is_read||$.unread_messages_count++,ne},oe=(O,L={})=>X.filter(L.dialog_id?z=>z.dialog===L.dialog_id:l),B=5*60*1e3,D={},R=O=>{var L;return(L=D[O])!=null?L:null},V=(O,L={})=>{const W={online:!!L.online,offline_at:i(B),interval:Math.round(B/1e3)};return D[O]=W,W},Q=["1.jpg","2.jpg","3.jpg","4.jpg","5.jpg","6.jpg","7.jpg","8.webp","9.webp","10.png","11.png","13.png","12.webp"],Te=`\u0414\u0430, \u043C\u0451\u0440\u0442\u0432.
\u0411\u0435\u0434\u0441\u0442\u0432\u0438\u0435, \u0443\u0433\u0440\u043E\u0436\u0430\u044E\u0449\u0435\u0435 \u0436\u0438\u0437\u043D\u0438 \u0434\u0435\u0432\u0443\u0448\u043A\u0438, \u0438\u0441\u0447\u0435\u0437\u043B\u043E, \u0441\u043B\u043E\u0432\u043D\u043E \u044D\u0442\u043E \u0431\u044B\u043B\u0430 \u043A\u0430\u043A\u0430\u044F-\u0442\u043E \u0448\u0443\u0442\u043A\u0430. \u041D\u043E \u043E\u043D\u0430 \u043D\u0435 \u043C\u043E\u0433\u043B\u0430 \u0440\u0430\u0434\u043E\u0432\u0430\u0442\u044C\u0441\u044F, \u0432\u0435\u0434\u044C \u0421\u043C\u0435\u0440\u0442\u044C \u0441\u043C\u0435\u043D\u0438\u043B\u0430 \u0441\u0432\u043E\u044E \u0444\u043E\u0440\u043C\u0443 \u0438 \u043F\u0440\u043E\u044F\u0432\u0438\u043B\u0430\u0441\u044C \u0432 \u0431\u043E\u043B\u0435\u0435 \u044F\u0432\u043D\u043E\u043C \u0432\u0438\u0434\u0435.
\u041F\u043E\u0434 \u0432\u0437\u0433\u043B\u044F\u0434\u043E\u043C \u043D\u0430\u043F\u0443\u0433\u0430\u043D\u043D\u043E\u0439 \u0434\u0435\u0432\u0443\u0448\u043A\u0438 \u0421\u043C\u0435\u0440\u0442\u044C \u0434\u0432\u0438\u043D\u0443\u043B\u0430\u0441\u044C \u0432 \u0435\u0451 \u0441\u0442\u043E\u0440\u043E\u043D\u0443. \u0422\u044C\u043C\u0430 \u043F\u0435\u0440\u0435\u0434 \u043D\u0435\u0439 \u043D\u0430\u0447\u0430\u043B\u0430 \u0441\u0433\u0443\u0449\u0430\u0442\u044C\u0441\u044F.
\u0422\u044C\u043C\u0430... \u043E\u043D\u0430 \u0441\u0435\u0439\u0447\u0430\u0441 \u043C\u0435\u043D\u044F \u043F\u0440\u043E\u0433\u043B\u043E\u0442\u0438\u0442, \u2014 \u043F\u043E\u0434\u0443\u043C\u0430\u043B\u0430 \u0434\u0435\u0432\u0443\u0448\u043A\u0430 \u0438 \u0435\u0449\u0451 \u043A\u0440\u0435\u043F\u0447\u0435 \u043E\u0431\u043D\u044F\u043B\u0430 \u0441\u0435\u0441\u0442\u0440\u0451\u043D\u043A\u0443. \u041E\u043D\u0430 \u0443\u0436\u0435 \u0434\u0430\u0436\u0435 \u0438 \u043D\u0435 \u0434\u0443\u043C\u0430\u043B\u0430 \u0431\u0435\u0436\u0430\u0442\u044C. \u0411\u0443\u0434\u044C \u043F\u0440\u043E\u0442\u0438\u0432\u043D\u0438\u043A \u0447\u0435\u043B\u043E\u0432\u0435\u043A\u043E\u043C, \u043E\u043D\u0430 \u0431\u044B \u0435\u0449\u0435 \u043C\u043E\u0433\u043B\u0430 \u043D\u0430 \u0447\u0442\u043E-\u0442\u043E \u043D\u0430\u0434\u0435\u044F\u0442\u044C\u0441\u044F. \u041D\u043E \u043D\u0435\u0447\u0442\u043E, \u0432\u043E\u0437\u0432\u044B\u0448\u0430\u044E\u0449\u0435\u0435\u0441\u044F \u043F\u0435\u0440\u0435\u0434 \u043D\u0435\u0439, \u0441 \u043B\u0435\u0433\u043A\u043E\u0441\u0442\u044C\u044E \u0440\u0430\u0437\u0432\u0435\u044F\u043B\u043E \u0442\u0430\u043A\u0438\u0435 \u043C\u044B\u0441\u043B\u0438. \u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0445\u043E\u0442\u044F \u0431\u044B \u0434\u0430\u0440\u0443\u0439 \u043C\u043D\u0435 \u0431\u0435\u0437\u0431\u043E\u043B\u0435\u0437\u043D\u0435\u043D\u043D\u0443\u044E \u0441\u043C\u0435\u0440\u0442\u044C.
\u041E\u043D\u0430 \u043C\u043E\u0433\u043B\u0430 \u043B\u0438\u0448\u044C \u043C\u043E\u043B\u0438\u0442\u044C\u0441\u044F.
\u041C\u0430\u043B\u044B\u0448\u043A\u0430 \u0443\u0446\u0435\u043F\u0438\u043B\u0430\u0441\u044C \u0437\u0430 \u0435\u0451 \u0442\u0430\u043B\u0438\u044E, \u0434\u0440\u043E\u0436\u0430 \u043E\u0442 \u0443\u0436\u0430\u0441\u0430. \u0421\u043F\u0430\u0441\u0442\u0438 \u0441\u0435\u0441\u0442\u0440\u0451\u043D\u043A\u0443... \u043D\u043E \u044D\u0442\u043E \u043D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E. \u041E\u043D\u0430 \u043C\u043E\u0433\u043B\u0430 \u043B\u0438\u0448\u044C \u0438\u0437\u0432\u0438\u043D\u0438\u0442\u044C\u0441\u044F \u0437\u0430 \u0441\u0432\u043E\u0451 \u0431\u0435\u0441\u0441\u0438\u043B\u0438\u0435. \u0421\u0435\u0441\u0442\u0440\u0451\u043D\u043A\u0430, \u0442\u044B \u043D\u0435 \u0431\u0443\u0434\u0435\u0448\u044C \u043E\u0434\u0438\u043D\u043E\u043A\u0430, \u044F \u043F\u043E\u0439\u0434\u0443 \u0441 \u0442\u043E\u0431\u043E\u0439.
\u0418 \u0442\u043E\u0433\u0434\u0430...`;let je=1;const Oe=(O=null,L=null)=>(O=O!=null?O:Math.random()*Q.length|0,L=L!=null?L:L=["IM","DC"][Math.random()*2|0],{file:je++,file_type:L,url:`assets/img-test/${Q[O]}`});(async()=>{const O=($,ne)=>{const ee=ne/$;let _e=-(ne+ee);return()=>(_e+=ee,_e)};let L=1;const z=($=0)=>{let ne=Math.random()<.5,ee=Math.random()<.5,_e=Math.random()<.5;!ne&&!ee&&!_e&&(ne=!0),ne=ee=_e=!0;const H=(L++).toString(36);return T({username:ne?`test_lead_${H}`:null,first_name:ee?`F${H}`:null,last_name:_e?`L${H}`:null,timeDelta:$})},W=($,ne,ee=0)=>{q($,{dialog:ne,text:`\u041F\u0440\u0438\u0432\u0435\u0442 @${$}. \u042F \u043D\u043E\u0432\u044B\u0439 \u043B\u0438\u0434, \u0432\u043E\u0442.`,is_read:!1,incoming:!0,timeDelta:ee});for(let _e=0;_e<Math.round(Math.random()*Q.length);_e++){const H=Oe(_e);q($,{dialog:ne,text:`${H.file_type==="IM"?"\u041A\u0430\u0440\u0442\u0438\u043D\u043A\u0430":"\u0424\u0430\u0439\u043B"} ${_e+1}.`,is_read:!1,incoming:!0,attachments:[H],timeDelta:ee+_e*1e3})}};for(let $=0;$<10;$++){const ee=[10,100,1e3,5e3,7e3,1e4,1e4,1e5,2,3,5,7,8,10][$],_e=`op_test_${$}`;u({username:_e,first_name:"OpNumDlgs",last_name:ee+""});let H=0;const ae=O(ee,6e4*ee);for(let Me=0;Me<ee;Me++){const Ne=ae(),Ge=z(Ne),ze=J(_e,Ge.tg_id);Math.random()<.5&&H++<5&&W(_e,ze.id,Ne)}}for(;;)await t(1e3,1e4),z()})();const me=(O,L,z)=>{const W=ee=>{ee&&V(z)},$=async ee=>{await t(1e3,1e4);const _e=L.text.match(/without_text/i),H=L.text.match(/long_text/i),ae=L.text.match(/allimg|allfile/i),Me=_e?"":H?Te:`\u042D\u0445\u043E \u043E\u0442\u0432\u0435\u0442 \u0434\u043B\u044F @${z}.
"${L.text}"`;if(ae){const Ge=L.text.match(/allimg/i)?"IM":"DC";for(let ze=0;ze<Q.length;ze++)q(z,{dialog:L.dialog,text:Me,is_read:!1,incoming:!0,attachments:[Oe(ze,Ge)]});return}const Ne=[];L.text.match(/img/i)?Ne.push(Oe(null,"IM")):L.text.match(/file/i)&&Ne.push(Oe(null,"DC")),q(z,{dialog:L.dialog,text:Me,is_read:!1,incoming:!0,attachments:Ne})},ne=ee=>{var _e;return(_e=ee==null?void 0:ee.__status)!=null?_e:200};O("GET","operators",200,()=>s(_(),L)),O("GET","online",200,()=>R(z)),O("PUT","online",200,()=>V(z,L)),O("GET","leads/unassigned",200,()=>s(h(),L)),O("GET","leads/count_free",200,()=>S()),O("POST","leads/get_one",ne,()=>k(z)),O("POST",/^leads\/(\d+)\/assign$/,200,ee=>M(z,ee),[W]),O("PATCH",/^leads\/(\d+)$/,200,ee=>C(z,ee,L),[W]),O("GET","dialogs",200,()=>s(ie(z,L),L)),O("POST",/^dialogs\/(\d+)\/read$/,204,ee=>re(z,ee)),O("PATCH",/^dialogs\/(\d+)$/,200,ee=>le(z,ee,L),[W]),O("GET","messages",200,()=>s(oe(z,L),L)),O("POST","messages",201,()=>q(z,L),[W,$])},Ce=O=>{var Ne,Ge,ze,tt,lt;const L=((Ne=O==null?void 0:O.method)!=null?Ne:"").toUpperCase().trim(),z=((Ge=O==null?void 0:O.path)!=null?Ge:"").split("/").map(De=>De.trim()).filter(Boolean).join("/"),W=Object.fromEntries(Object.entries((ze=O==null?void 0:O.headers)!=null?ze:{}).map(De=>[De[0].toLowerCase(),De[1]])),$=(tt=O==null?void 0:O.options)!=null?tt:{},ne=(lt=W["x-username"])!=null?lt:null,ee=[];me((De,Ke,ct,ut,dt=[])=>ee.push({method:De,pathPattern:Ke,cb:ut,status:ct,mwList:dt}),$,ne);const H=ee.map(De=>{if(De.method===L){if(De.pathPattern instanceof RegExp){const Ke=z.match(De.pathPattern);return Ke?{...De,args:Ke.slice(1)}:!1}return De.pathPattern===z?{...De,args:[]}:!1}}).filter(Boolean)[0];if(!H)return null;const ae=H.cb(...H.args);return H.mwList&&H.mwList.map(De=>De(ae,ne,$)),{status:typeof H.status=="function"?H.status(ae):H.status,result:ae}};try{self.addEventListener("message",({data:{rpcID:O,data:L}})=>{let z,W;try{z=Ce(L)}catch($){W=$.message}self.postMessage({rpcID:O,result:z,error:W})})}catch{}return{request:Ce}},Mi=()=>{const l=`( ${Li.toString()} )()`,e=new Blob([l],{type:"text/javascript"}),t=new Worker(window.URL.createObjectURL(e));let n=1;const i={};return t.addEventListener("message",({data:{rpcID:o,result:a,error:f}})=>{const c=i[o];delete i[o],f&&c.reject(new Error(f)),c.resolve(a)}),{request:o=>{const a=n++,f=i[a]=Gt();return t.postMessage({rpcID:a,data:o}),f.promise},destroy:()=>t.terminate()}};function Ti(l){let e,t,n,i,s;return t=new ui({props:{operatorSelf:l[0],config:l[2],notifyEvents:l[1],createApi:l[3]}}),{c(){e=w("div"),ge(t.$$.fragment),v(e,"class","pos_rel flex")},m(r,o){P(r,e,o),ue(t,e,null),n=!0,i||(s=at(Dt.call(null,e)),i=!0)},p(r,o){const a={};o&1&&(a.operatorSelf=r[0]),t.$set(a)},i(r){n||(E(t.$$.fragment,r),n=!0)},o(r){G(t.$$.fragment,r),n=!1},d(r){r&&N(e),de(t),i=!1,s()}}}function Oi(l){let e,t,n,i,s;return e=new qn({props:{select:"operators"}}),i=new pi({props:{api:l[4]}}),{c(){ge(e.$$.fragment),t=j(),n=w("div"),ge(i.$$.fragment),v(n,"class","flex")},m(r,o){ue(e,r,o),P(r,t,o),P(r,n,o),ue(i,n,null),s=!0},p:fe,i(r){s||(E(e.$$.fragment,r),E(i.$$.fragment,r),s=!0)},o(r){G(e.$$.fragment,r),G(i.$$.fragment,r),s=!1},d(r){de(e,r),r&&N(t),r&&N(n),de(i)}}}function Di(l){let e,t,n,i,s,r;const o=[Oi,Ti],a=[];function f(c,p){return c[0]?1:0}return t=f(l),n=a[t]=o[t](l),s=new Zn({props:{events:l[1]}}),{c(){e=w("main"),n.c(),i=j(),ge(s.$$.fragment),v(e,"class","flex flex_clm flex_grow_1 pos_rel overhide svelte-l8w6xt")},m(c,p){P(c,e,p),a[t].m(e,null),m(e,i),ue(s,e,null),r=!0},p(c,[p]){let _=t;t=f(c),t===_?a[t].p(c,p):(we(),G(a[_],1,1,()=>{a[_]=null}),ye(),n=a[t],n?n.p(c,p):(n=a[t]=o[t](c),n.c()),E(n,1),n.m(e,i))},i(c){r||(E(n),E(s.$$.fragment,c),r=!0)},o(c){G(n),G(s.$$.fragment,c),r=!1},d(c){c&&N(e),a[t].d(),de(s)}}}function Ii(l,e,t){let n;Le(l,Tt,f=>t(0,n=f));const i=Ut(),s=g_Config,o=(f=>{var u;const c=((u=f.testMode)!=null?u:!0)&&!an().has("real-api");let p=()=>null,_=f.api;if(c){const d=Mi();Be(d.destroy),_={protocol:"https:",host:"test.mode.dev",path_base:"api/"},p=()=>async({method:g,path:b,options:y,request:h})=>{const S=Object.fromEntries([...h.headers]),{status:T,result:M}=await d.request({method:g,path:b,options:y,headers:S});return{status:T,json:()=>M}}}return(d=null)=>Si(_,{onerror:g=>i.emit("error",g),onnotify:g=>i.emit("debug",g),onNotAuthorizedError:()=>Ye(Tt,n=null,n),operator:d},p())})(s),a=o();return[n,i,s,o,a]}class Ci extends be{constructor(e){super(),ve(this,e,Ii,Di,pe,{})}}new Ci({target:document.getElementById("app")});
