(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function Z(){}const gt=l=>l;function jt(l,e){for(const t in e)l[t]=e[t];return l}function Dl(l){return l()}function Ct(){return Object.create(null)}function Se(l){l.forEach(Dl)}function je(l){return typeof l=="function"}function de(l,e){return l!=l?e==e:l!==e||l&&typeof l=="object"||typeof l=="function"}let Ze;function pt(l,e){return Ze||(Ze=document.createElement("a")),Ze.href=e,l===Ze.href}function Gl(l){return Object.keys(l).length===0}function mt(l,...e){if(l==null)return Z;const t=l.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function pe(l,e,t){l.$$.on_destroy.push(mt(e,t))}function We(l,e,t){return l.set(t),e}function Xe(l){return l&&je(l.destroy)?l.destroy:Z}const El=typeof window<"u";let jl=El?()=>window.performance.now():()=>Date.now(),ht=El?l=>requestAnimationFrame(l):Z;const Re=new Set;function Cl(l){Re.forEach(e=>{e.c(l)||(Re.delete(e),e.f())}),Re.size!==0&&ht(Cl)}function ql(l){let e;return Re.size===0&&ht(Cl),{promise:new Promise(t=>{Re.add(e={c:l,f:t})}),abort(){Re.delete(e)}}}function h(l,e){l.appendChild(e)}function Wl(l){if(!l)return document;const e=l.getRootNode?l.getRootNode():l.ownerDocument;return e&&e.host?e:l.ownerDocument}function zl(l,e){return h(l.head||l,e),e.sheet}function C(l,e,t){l.insertBefore(e,t||null)}function E(l){l.parentNode.removeChild(l)}function Hl(l,e){for(let t=0;t<l.length;t+=1)l[t]&&l[t].d(e)}function k(l){return document.createElement(l)}function U(l){return document.createTextNode(l)}function j(){return U(" ")}function Je(){return U("")}function ee(l,e,t,n){return l.addEventListener(e,t,n),()=>l.removeEventListener(e,t,n)}function Xl(l){return function(e){return e.preventDefault(),l.call(this,e)}}function Jl(l){return function(e){return e.stopPropagation(),l.call(this,e)}}function S(l,e,t){t==null?l.removeAttribute(e):l.getAttribute(e)!==t&&l.setAttribute(e,t)}function Vl(l){return Array.from(l.childNodes)}function te(l,e){e=""+e,l.wholeText!==e&&(l.data=e)}function qt(l,e){l.value=e==null?"":e}function R(l,e,t,n){t===null?l.style.removeProperty(e):l.style.setProperty(e,t,n?"important":"")}function Q(l,e,t){l.classList[t?"add":"remove"](e)}function Kl(l,e,{bubbles:t=!1,cancelable:n=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(l,t,n,e),i}const nt=new Map;let it=0;function Ql(l){let e=5381,t=l.length;for(;t--;)e=(e<<5)-e^l.charCodeAt(t);return e>>>0}function Zl(l){const e={style_element:k("style"),rules:{}};return nt.set(l,e),e}function Ht(l,e,t,n,i,s,r,o=0){const a=16.666/n;let f=`{
`;for(let w=0;w<=1;w+=a){const L=e+(t-e)*s(w);f+=w*100+`%{${r(L,1-L)}}
`}const u=f+`100% {${r(t,1-t)}}
}`,p=`__svelte_${Ql(u)}_${o}`,c=Wl(l),{style_element:d,rules:_}=nt.get(c)||Zl(c);if(!_[p]){const w=zl(c,d);_[p]=!0,w.insertRule(`@keyframes ${p} ${u}`,w.cssRules.length)}const m=l.style.animation||"";return l.style.animation=`${m?`${m}, `:""}${p} ${n}ms linear ${i}ms 1 both`,it+=1,p}function xl(l,e){const t=(l.style.animation||"").split(", "),n=t.filter(e?s=>s.indexOf(e)<0:s=>s.indexOf("__svelte")===-1),i=t.length-n.length;i&&(l.style.animation=n.join(", "),it-=i,it||$l())}function $l(){ht(()=>{it||(nt.forEach(l=>{const{style_element:e}=l;E(e)}),nt.clear())})}let ze;function Ge(l){ze=l}function en(){if(!ze)throw new Error("Function called outside component initialization");return ze}function Ve(l){en().$$.on_destroy.push(l)}const Ue=[],Ie=[],tt=[],ut=[],tn=Promise.resolve();let ct=!1;function ln(){ct||(ct=!0,tn.then(Pl))}function ye(l){tt.push(l)}function vt(l){ut.push(l)}const ot=new Set;let xe=0;function Pl(){const l=ze;do{for(;xe<Ue.length;){const e=Ue[xe];xe++,Ge(e),nn(e.$$)}for(Ge(null),Ue.length=0,xe=0;Ie.length;)Ie.pop()();for(let e=0;e<tt.length;e+=1){const t=tt[e];ot.has(t)||(ot.add(t),t())}tt.length=0}while(Ue.length);for(;ut.length;)ut.pop()();ct=!1,ot.clear(),Ge(l)}function nn(l){if(l.fragment!==null){l.update(),Se(l.before_update);const e=l.dirty;l.dirty=[-1],l.fragment&&l.fragment.p(l.ctx,e),l.after_update.forEach(ye)}}let Ye;function sn(){return Ye||(Ye=Promise.resolve(),Ye.then(()=>{Ye=null})),Ye}function at(l,e,t){l.dispatchEvent(Kl(`${e?"intro":"outro"}${t}`))}const lt=new Set;let Ae;function ae(){Ae={r:0,c:[],p:Ae}}function fe(){Ae.r||Se(Ae.c),Ae=Ae.p}function D(l,e){l&&l.i&&(lt.delete(l),l.i(e))}function q(l,e,t,n){if(l&&l.o){if(lt.has(l))return;lt.add(l),Ae.c.push(()=>{lt.delete(l),n&&(t&&l.d(1),n())}),l.o(e)}else n&&n()}const rn={duration:0};function me(l,e,t,n){let i=e(l,t),s=n?0:1,r=null,o=null,a=null;function f(){a&&xl(l,a)}function u(c,d){const _=c.b-s;return d*=Math.abs(_),{a:s,b:c.b,d:_,duration:d,start:c.start,end:c.start+d,group:c.group}}function p(c){const{delay:d=0,duration:_=300,easing:m=gt,tick:w=Z,css:L}=i||rn,g={start:jl()+d,b:c};c||(g.group=Ae,Ae.r+=1),r||o?o=g:(L&&(f(),a=Ht(l,s,c,_,d,m,L)),c&&w(0,1),r=u(g,_),ye(()=>at(l,c,"start")),ql(v=>{if(o&&v>o.start&&(r=u(o,_),o=null,at(l,r.b,"start"),L&&(f(),a=Ht(l,s,r.b,r.duration,0,m,i.css))),r){if(v>=r.end)w(s=r.b,1-s),at(l,r.b,"end"),o||(r.b?f():--r.group.r||Se(r.group.c)),r=null;else if(v>=r.start){const I=v-r.start;s=r.a+r.d*m(I/r.duration),w(s,1-s)}}return!!(r||o)}))}return{run(c){je(i)?sn().then(()=>{i=i(),p(c)}):p(c)},end(){f(),r=o=null}}}const Nl=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function bt(l,e){l.d(1),e.delete(l.key)}function Ke(l,e){q(l,1,1,()=>{e.delete(l.key)})}function He(l,e,t,n,i,s,r,o,a,f,u,p){let c=l.length,d=s.length,_=c;const m={};for(;_--;)m[l[_].key]=_;const w=[],L=new Map,g=new Map;for(_=d;_--;){const M=p(i,s,_),A=t(M);let y=r.get(A);y?n&&y.p(M,e):(y=f(A,M),y.c()),L.set(A,w[_]=y),A in m&&g.set(A,Math.abs(_-m[A]))}const v=new Set,I=new Set;function b(M){D(M,1),M.m(o,u),r.set(M.key,M),u=M.first,d--}for(;c&&d;){const M=w[d-1],A=l[c-1],y=M.key,T=A.key;M===A?(u=M.first,c--,d--):L.has(T)?!r.has(y)||v.has(y)?b(M):I.has(T)?c--:g.get(y)>g.get(T)?(I.add(y),b(M)):(v.add(T),c--):(a(A,r),c--)}for(;c--;){const M=l[c];L.has(M.key)||a(M,r)}for(;d;)b(w[d-1]);return w}function wt(l,e,t){const n=l.$$.props[e];n!==void 0&&(l.$$.bound[n]=t,t(l.$$.ctx[n]))}function re(l){l&&l.c()}function ie(l,e,t,n){const{fragment:i,on_mount:s,on_destroy:r,after_update:o}=l.$$;i&&i.m(e,t),n||ye(()=>{const a=s.map(Dl).filter(je);r?r.push(...a):Se(a),l.$$.on_mount=[]}),o.forEach(ye)}function se(l,e){const t=l.$$;t.fragment!==null&&(Se(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function on(l,e){l.$$.dirty[0]===-1&&(Ue.push(l),ln(),l.$$.dirty.fill(0)),l.$$.dirty[e/31|0]|=1<<e%31}function _e(l,e,t,n,i,s,r,o=[-1]){const a=ze;Ge(l);const f=l.$$={fragment:null,ctx:null,props:s,update:Z,not_equal:i,bound:Ct(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:Ct(),dirty:o,skip_bound:!1,root:e.target||a.$$.root};r&&r(f.root);let u=!1;if(f.ctx=t?t(l,e.props||{},(p,c,...d)=>{const _=d.length?d[0]:c;return f.ctx&&i(f.ctx[p],f.ctx[p]=_)&&(!f.skip_bound&&f.bound[p]&&f.bound[p](_),u&&on(l,p)),c}):[],f.update(),u=!0,Se(f.before_update),f.fragment=n?n(f.ctx):!1,e.target){if(e.hydrate){const p=Vl(e.target);f.fragment&&f.fragment.l(p),p.forEach(E)}else f.fragment&&f.fragment.c();e.intro&&D(l.$$.fragment),ie(l,e.target,e.anchor,e.customElement),Pl()}Ge(a)}class ge{$destroy(){se(this,1),this.$destroy=Z}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!Gl(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function an(l){const e=l-1;return e*e*e+1}function we(l,{delay:e=0,duration:t=400,easing:n=gt}={}){const i=+getComputedStyle(l).opacity;return{delay:e,duration:t,easing:n,css:s=>`opacity: ${s*i}`}}function st(l,{delay:e=0,duration:t=400,easing:n=an}={}){const i=getComputedStyle(l),s=+i.opacity,r=parseFloat(i.height),o=parseFloat(i.paddingTop),a=parseFloat(i.paddingBottom),f=parseFloat(i.marginTop),u=parseFloat(i.marginBottom),p=parseFloat(i.borderTopWidth),c=parseFloat(i.borderBottomWidth);return{delay:e,duration:t,easing:n,css:d=>`overflow: hidden;opacity: ${Math.min(d*20,1)*s};height: ${d*r}px;padding-top: ${d*o}px;padding-bottom: ${d*a}px;margin-top: ${d*f}px;margin-bottom: ${d*u}px;border-top-width: ${d*p}px;border-bottom-width: ${d*c}px;`}}const Ne=[];function Ee(l,e=Z){let t;const n=new Set;function i(o){if(de(l,o)&&(l=o,t)){const a=!Ne.length;for(const f of n)f[1](),Ne.push(f,l);if(a){for(let f=0;f<Ne.length;f+=2)Ne[f][0](Ne[f+1]);Ne.length=0}}}function s(o){i(o(l))}function r(o,a=Z){const f=[o,a];return n.add(f),n.size===1&&(t=e(i)||Z),o(l),()=>{n.delete(f),n.size===0&&(t(),t=null)}}return{set:i,update:s,subscribe:r}}const Pt=()=>{},Rl=l=>new Promise(e=>setTimeout(e,l)),De=(l,e,t)=>Math.min(t,Math.max(l,e)),Fl=(l={})=>(Object.assign(l,{promise:new Promise((e,t)=>Object.assign(l,{resolve:e,reject:t}))}),l),dt=(l,e)=>{try{if(l===e)return!0;const t=typeof l;if(t!==typeof e)return!1;switch(t){case"undefined":case"boolean":case"bigint":case"symbol":case"string":return l===e;case"number":return isNaN(l)&&isNaN(e)?!0:l===e}if(l===null||e===null)return l===e;if(t!=="object")return!1;if(Array.isArray(l)&&Array.isArray(e))return l.length!==e.length?!1:l.every((o,a)=>dt(o,e[a]));const i=Object.entries(l),s=Object.entries(e);if(i.length!==s.length)return!1;const r=new Map(s);return i.every(([o,a])=>!(!r.has(o)||!dt(a,r.get(o))))}catch{}return!1},fn=l=>{let e=!1,t=[];const n=async i=>{e=!0;let s,r,o;try{s=await l()}catch(a){o=!0,r=a}if(i.map(a=>{o&&a.reject(r),a.resolve(s)}),t.length){const a=t;return t=[],n(a)}e=!1};return()=>{const i=Fl();return e?t.push(i):(e=!0,n([i])),i.promise}},un=l=>{const e=Fl();return setTimeout(e.resolve,l),e},cn=Symbol("RangeLoadList_ItemLastUpdateTime"),dn=l=>{var H,z,K,Y;const e=De(1,((H=l.updateInterval)!=null?H:1e3)|0,36e5),t=De(1,((z=l.maxLimit)!=null?z:50)|0,1e3);let n=l.fLoad;const i=(K=l.onUpdateItem)!=null?K:Pt,s=(Y=l.onUpdateItemList)!=null?Y:Pt,r=!!l.isLoadEnd,o=cn,a={},f=Ee(null),u={subscribe:f.subscribe};let p=0,c=t,d=null;const _=B=>n=B,m=async(B,X)=>{try{const le=await n({offset:B,limit:X});if(typeof le.count=="number"&&Array.isArray(le.results))return le}catch{}return null},w=async(B,X)=>{const le=await m(B,X);if(le){const N=le.results,x=Math.max(0,le.count|0),P=d!==x,W=Date.now();d=x;const J=[];for(let $=0,he=B;$<N.length&&he<d;$++,he++){const ve=N[$];a[he]!==void 0&&dt(a[he],ve)||(ve[o]=W,a[he]=ve,i(ve),J.push(ve))}J.length&&s(J),(P||J.length)&&f.set({total:d,list:a})}},L=async B=>{const X=[];X.push(w(p,c)),d!==null&&p+c<d&&r&&X.push(w(d,t)),await Promise.all(X),d!==null&&p+c<d&&r&&B&&await w(d,t)};let g=!1,v=!0,I,b=1;return(async()=>{let B=0;for(;v;){for(;v&&!g;){const X=b;if(await L(B++===0),X===b)break}I=un(e),await I.promise}})(),{setFLoad:_,update:()=>{b++,I&&I.resolve()},setRange:(B,X)=>{p=Math.max(0,B|0),c=De(0,X|0,t)},destroy:()=>v=!1,getData_r:()=>u,symbolUpdateTime:o,pause:()=>g=!0,resume:()=>g=!1}},_n=async l=>{const e=t=>{const n=document.createElement("textarea");n.value=t,n.style.top="0",n.style.left="0",n.style.position="fixed",document.body.appendChild(n),n.focus(),n.select();let i=!1;try{i=!!document.execCommand("copy")}catch(s){console.error("Fallback: Oops, unable to copy",s)}return document.body.removeChild(n),i};try{return navigator.clipboard?(await navigator.clipboard.writeText(l),!0):e(l)}catch(t){console.error(t)}return!1},gn=(l,e)=>{const t=setInterval(e,l);return()=>clearInterval(t)},pn=(l,e)=>{let t=!0;return(async()=>{for(;t;){try{await e()}catch(n){console.error("setIntervalLoop error",n)}await Rl(l)}})(),()=>t=!1},yt=Ee(null),Bl=l=>{var e;yt.set(l),g_Api.setHeader("x-username",(e=l==null?void 0:l.username)!=null?e:void 0)},$e=(l,e)=>{const{subscribe:t,set:n,update:i}=Ee(l);return[{subscribe:t},s=>{n(s),e&&e(s)}]},mn=(l,e)=>{const{subscribe:t,set:n,update:i}=Ee(l);return[{subscribe:t},i]},hn=l=>parseInt(l.id);function vn(l,e){const t={},n=[],i=y=>n.push(y);Object.assign(t,{destroy:()=>n.map(y=>y())});const r=l,[o]=$e(r),[a,f]=$e(null);let u=0;const[p,c]=$e(u),d=fn(g_Api.operatorSelf_GetOnlineInfo),_=async()=>{c(++u);const y=await d();return y&&f(y),c(--u),y};Object.assign(t,{operatorSelf_r:o,operatorSelfLastOnlineInfo_r:a,operatorSelfLastOnlineInfo_Set:f,operatorSelfLastOnlineInfo_Update:_,operatorSelfLastOnlineInfoLoading_r:p});const m=Object.create(null),[w,L]=mn(m),g=y=>{!y.length||L(T=>{for(const O of y)T[hn(O)]=O;return T})},v=y=>g([y]),[I,b]=$e(null);return Object.assign(t,{dialogMap_r:w,dialogMap_SetDialogList:g,dialogMap_SetDialog:v,dialogActiveID_r:I,dialogActiveID_Set:b}),Object.assign(t,{lead_GetStatusTitle:y=>{var T,O,F;return(F=(O=((T=e==null?void 0:e.lead_StatusList)!=null?T:[]).find(V=>V.id===y))==null?void 0:O.title)!=null?F:y},lead_GetStatusList:y=>{var T;return((T=e==null?void 0:e.lead_StatusList)!=null?T:[]).filter(O=>O.access==="user").filter(O=>O.id!==y).filter(O=>O.id!=="DL")}}),i(pn(e.updateIntervals.sync_online_info,_)),Object.freeze(t),t}function Nt(l){let e,t,n;return{c(){e=k("div"),e.textContent="Operators",S(e,"class","item cursor_ptr svelte-vbcb9r"),Q(e,"active",l[0]==="operators"),Q(e,"disabled",l[1].has("operators"))},m(i,s){C(i,e,s),t||(n=ee(e,"click",l[3]("operators")),t=!0)},p(i,s){s&1&&Q(e,"active",i[0]==="operators"),s&2&&Q(e,"disabled",i[1].has("operators"))},d(i){i&&E(e),t=!1,n()}}}function Rt(l){let e,t=l[2].username+"",n,i,s;return{c(){e=k("div"),n=U(t),S(e,"class","item cursor_ptr notHover nowrap textOverEllipsis svelte-vbcb9r"),R(e,"max-width","200px")},m(r,o){C(r,e,o),h(e,n),s=!0},p(r,o){(!s||o&4)&&t!==(t=r[2].username+"")&&te(n,t)},i(r){s||(ye(()=>{i||(i=me(e,we,{},!0)),i.run(1)}),s=!0)},o(r){i||(i=me(e,we,{},!1)),i.run(0),s=!1},d(r){r&&E(e),r&&i&&i.end()}}}function bn(l){let e,t,n,i,s,r,o=!l[2]&&Nt(l),a=l[2]&&0,f=l[2]&&Rt(l);return{c(){e=k("div"),o&&o.c(),t=j(),a&&a.c(),n=j(),i=k("div"),s=j(),f&&f.c(),S(i,"class","flex flex_grow_1"),S(e,"class","flex flex_cy w100 list unselect svelte-vbcb9r")},m(u,p){C(u,e,p),o&&o.m(e,null),h(e,t),a&&a.m(e,null),h(e,n),h(e,i),h(e,s),f&&f.m(e,null),r=!0},p(u,[p]){u[2]?o&&(o.d(1),o=null):o?o.p(u,p):(o=Nt(u),o.c(),o.m(e,t)),u[2],a&&(a.d(1),a=null),u[2]?f?(f.p(u,p),p&4&&D(f,1)):(f=Rt(u),f.c(),D(f,1),f.m(e,null)):f&&(ae(),q(f,1,1,()=>{f=null}),fe())},i(u){r||(D(f),r=!0)},o(u){q(f),r=!1},d(u){u&&E(e),o&&o.d(),a&&a.d(),f&&f.d()}}}function wn(l,e,t){let n;pe(l,yt,o=>t(2,n=o));let{select:i=""}=e,{disabled:s=new Set}=e;s.add("newLeads"),s.add("myLeads");const r=o=>a=>{s.has(o)||t(0,i=o)};return l.$$set=o=>{"select"in o&&t(0,i=o.select),"disabled"in o&&t(1,s=o.disabled)},[i,s,n,r]}class yn extends ge{constructor(e){super(),_e(this,e,wn,bn,de,{select:0,disabled:1})}}function kn(l){let e;return{c(){e=k("div"),S(e,"class","pos_abs notify_list svelte-bjfmev")},m(t,n){C(t,e,n)},p:Z,i:Z,o:Z,d(t){t&&E(e)}}}class Ln extends ge{constructor(e){super(),_e(this,e,null,kn,de,{})}}function Ft(l){return Object.prototype.toString.call(l)==="[object Date]"}function _t(l,e){if(l===e||l!==l)return()=>l;const t=typeof l;if(t!==typeof e||Array.isArray(l)!==Array.isArray(e))throw new Error("Cannot interpolate values of different type");if(Array.isArray(l)){const n=e.map((i,s)=>_t(l[s],i));return i=>n.map(s=>s(i))}if(t==="object"){if(!l||!e)throw new Error("Object cannot be null");if(Ft(l)&&Ft(e)){l=l.getTime(),e=e.getTime();const s=e-l;return r=>new Date(l+r*s)}const n=Object.keys(e),i={};return n.forEach(s=>{i[s]=_t(l[s],e[s])}),s=>{const r={};return n.forEach(o=>{r[o]=i[o](s)}),r}}if(t==="number"){const n=e-l;return i=>l+i*n}throw new Error(`Cannot interpolate ${t} values`)}function Fe(l,e={}){const t=Ee(l);let n,i=l;function s(r,o){if(l==null)return t.set(l=r),Promise.resolve();i=r;let a=n,f=!1,{delay:u=0,duration:p=400,easing:c=gt,interpolate:d=_t}=jt(jt({},e),o);if(p===0)return a&&(a.abort(),a=null),t.set(l=i),Promise.resolve();const _=jl()+u;let m;return n=ql(w=>{if(w<_)return!0;f||(m=d(l,r),typeof p=="function"&&(p=p(l,r)),f=!0),a&&(a.abort(),a=null);const L=w-_;return L>p?(t.set(l=r),!1):(t.set(l=m(c(L/p))),!0)}),n.promise}return{set:s,update:(r,o)=>s(r(i,l),o),subscribe:t.subscribe}}function Sn(l){let e,t,n,i,s,r,o,a,f;return{c(){e=k("div"),t=k("div"),n=k("div"),i=j(),s=k("div"),r=j(),o=k("div"),a=j(),f=k("div"),S(n,"class","pos_abs s1 svelte-fxby3d"),S(s,"class","pos_abs s2 svelte-fxby3d"),S(o,"class","pos_abs s3 svelte-fxby3d"),S(f,"class","pos_abs s4 svelte-fxby3d"),S(t,"class","flex pos_rel ellipsis svelte-fxby3d"),R(t,"transform","scale("+l[1]+")"),S(e,"class","flex cnt"),R(e,"height",l[0]+"px"),R(e,"width",l[2]+"px")},m(u,p){C(u,e,p),h(e,t),h(t,n),h(t,i),h(t,s),h(t,r),h(t,o),h(t,a),h(t,f)},p(u,[p]){p&2&&R(t,"transform","scale("+u[1]+")"),p&1&&R(e,"height",u[0]+"px"),p&4&&R(e,"width",u[2]+"px")},i:Z,o:Z,d(u){u&&E(e)}}}function Tn(l,e,t){let n,i,{height:s=5}=e;return l.$$set=r=>{"height"in r&&t(0,s=r.height)},l.$$.update=()=>{l.$$.dirty&1&&t(2,n=s/.1625),l.$$.dirty&1&&t(1,i=s/13)},[s,i,n]}class Mn extends ge{constructor(e){super(),_e(this,e,Tn,Sn,de,{height:0})}}function Bt(l){let e,t,n,i;return t=new Mn({props:{height:6}}),{c(){e=k("div"),re(t.$$.fragment),S(e,"class","flex pos_abs loading svelte-15wz55f")},m(s,r){C(s,e,r),ie(t,e,null),i=!0},i(s){i||(D(t.$$.fragment,s),s&&ye(()=>{n||(n=me(e,we,{},!0)),n.run(1)}),i=!0)},o(s){q(t.$$.fragment,s),s&&(n||(n=me(e,we,{},!1)),n.run(0)),i=!1},d(s){s&&E(e),se(t),s&&n&&n.end()}}}function In(l){let e,t,n,i,s,r,o,a,f,u,p,c,d,_=l[0]&&Bt();return{c(){e=k("div"),t=k("div"),n=j(),i=k("div"),i.textContent="offline",s=j(),r=k("div"),o=U(`online\r
		`),a=k("div"),f=U(l[2]),u=j(),_&&_.c(),S(t,"class","pos_abs h100 onlineProgressTrumb svelte-15wz55f"),R(t,"width",l[1]+"%"),S(i,"class","flex flex_cx flex_cy pos_abs w100 h100 onlineProgressTrackLabel label2 svelte-15wz55f"),Q(i,"hideR",l[1]>=1),S(a,"class","pos_abs onlineProgressTrumbLastTime svelte-15wz55f"),S(r,"class","flex flex_cx flex_cy pos_abs w100 h100 onlineProgressTrackLabel  svelte-15wz55f"),Q(r,"hideL",l[1]<1),S(e,"class","flex flex_cx flex_cy flex_grow_1 onlineProgressTrack pos_rel overhide unselect cursor_ptr svelte-15wz55f")},m(m,w){C(m,e,w),h(e,t),h(e,n),h(e,i),h(e,s),h(e,r),h(r,o),h(r,a),h(a,f),h(e,u),_&&_.m(e,null),p=!0,c||(d=ee(e,"click",l[4]),c=!0)},p(m,[w]){(!p||w&2)&&R(t,"width",m[1]+"%"),(!p||w&2)&&Q(i,"hideR",m[1]>=1),(!p||w&4)&&te(f,m[2]),(!p||w&2)&&Q(r,"hideL",m[1]<1),m[0]?_?w&1&&D(_,1):(_=Bt(),_.c(),D(_,1),_.m(e,null)):_&&(ae(),q(_,1,1,()=>{_=null}),fe())},i(m){p||(D(_),p=!0)},o(m){q(_),p=!1},d(m){m&&E(e),_&&_.d(),c=!1,d()}}}const On=25e3;function An(l,e,t){let n,i,s,{endTime:r=0}=e,{loading:o=!1}=e,a=0;const f=Fe(0);pe(l,f,_=>t(7,s=_));let u=0;function p(){u=Math.max(0,r-Date.now()),t(1,a=Math.floor(De(0,u/On,1)*100)),We(f,s=Math.ceil(u/1e3),s)}const c=()=>{p()};Ve(gn(1e3,p));const d=_=>{const m=Math.floor(_%60);_/=60;const w=Math.floor(_%60);_/=60;const L=Math.floor(_),g=[];return(g.length||L)&&g.push(`${String(L).padStart(g.length?2:1,"0")}h`),(g.length||w)&&g.push(`${String(w).padStart(g.length?2:1,"0")}m`),(g.length||m)&&g.push(`${String(m).padStart(g.length?2:1,"0")}s`),g.join(" ")};return l.$$set=_=>{"endTime"in _&&t(5,r=_.endTime),"loading"in _&&t(0,o=_.loading)},l.$$.update=()=>{l.$$.dirty&128&&t(6,n=Math.ceil(s)),l.$$.dirty&64&&t(2,i=d(n))},[o,a,i,f,c,r,n,s]}class Dn extends ge{constructor(e){super(),_e(this,e,An,In,de,{endTime:5,loading:0})}}function En(l){let e;return{c(){e=U("\xA0")},m(t,n){C(t,e,n)},p:Z,d(t){t&&E(e)}}}function jn(l){let e,t=l[1].username+"",n;return{c(){e=U("@"),n=U(t)},m(i,s){C(i,e,s),C(i,n,s)},p(i,s){s&2&&t!==(t=i[1].username+"")&&te(n,t)},d(i){i&&E(e),i&&E(n)}}}function Cn(l){var z,K;let e,t,n,i,s=((z=l[1].first_name)!=null?z:"")+"",r,o,a,f,u,p=((K=l[1].last_name)!=null?K:"")+"",c,d,_,m,w,L,g,v,I,b,M,A,y,T,O;function F(Y,B){return Y[1].username?jn:En}let V=F(l),H=V(l);return b=new Dn({props:{endTime:l[0],loading:l[2]}}),{c(){e=k("div"),t=k("div"),n=k("div"),i=k("div"),r=U(s),o=j(),a=k("div"),f=j(),u=k("div"),c=U(p),d=U("\xA0"),_=j(),m=k("div"),H.c(),w=j(),L=k("div"),L.innerHTML='<img src="assets/icons/logout.png" draggable="false" class="pos_abs w100 h100 svelte-1qt21qp"/>',g=j(),v=k("div"),I=j(),re(b.$$.fragment),M=j(),A=k("div"),R(a,"width","8px"),S(n,"class","flex nowrap textOverEllipsis name svelte-1qt21qp"),S(m,"class","nowrap textOverEllipsis username svelte-1qt21qp"),S(L,"class","pos_abs btnLogout svelte-1qt21qp"),S(t,"class","flex flex_clm cursor_ptr pos_rel unselect operator svelte-1qt21qp"),R(v,"height","8px"),R(A,"height","8px"),S(e,"class","flex flex_clm cnt svelte-1qt21qp")},m(Y,B){C(Y,e,B),h(e,t),h(t,n),h(n,i),h(i,r),h(n,o),h(n,a),h(n,f),h(n,u),h(u,c),h(u,d),h(t,_),h(t,m),H.m(m,null),h(t,w),h(t,L),h(e,g),h(e,v),h(e,I),ie(b,e,null),h(e,M),h(e,A),y=!0,T||(O=ee(L,"click",l[6]),T=!0)},p(Y,[B]){var le,N;(!y||B&2)&&s!==(s=((le=Y[1].first_name)!=null?le:"")+"")&&te(r,s),(!y||B&2)&&p!==(p=((N=Y[1].last_name)!=null?N:"")+"")&&te(c,p),V===(V=F(Y))&&H?H.p(Y,B):(H.d(1),H=V(Y),H&&(H.c(),H.m(m,null)));const X={};B&1&&(X.endTime=Y[0]),B&4&&(X.loading=Y[2]),b.$set(X)},i(Y){y||(D(b.$$.fragment,Y),y=!0)},o(Y){q(b.$$.fragment,Y),y=!1},d(Y){Y&&E(e),H.d(),se(b),T=!1,O()}}}function qn(l,e,t){let n,i,s,{app:r}=e;const{operatorSelf_r:o,operatorSelfLastOnlineInfo_r:a,operatorSelfLastOnlineInfoLoading_r:f}=r;pe(l,o,d=>t(1,i=d)),pe(l,a,d=>t(8,n=d)),pe(l,f,d=>t(2,s=d));const u=()=>Bl(null);let p=0;const c=d=>{!d||t(0,p=+new Date(d.offline_at))};return l.$$set=d=>{"app"in d&&t(7,r=d.app)},l.$$.update=()=>{l.$$.dirty&256&&c(n)},[p,i,s,o,a,f,u,r,n]}class Hn extends ge{constructor(e){super(),_e(this,e,qn,Cn,de,{app:7})}}const rt=(l,e)=>{let t=null,n=null,i=!0;const s=()=>{i&&setTimeout(s,10);const o=l.parentNode;if(o){const a=o.getBoundingClientRect();(t!==a.width||n!==a.height)&&(t=a.width,n=a.height,l.style.width=`${t}px`,l.style.height=`${n}px`,e&&e.set(a))}};return s(),{destroy:()=>i=!1}},Pn=(l,e)=>{let t=null,n=null,i=null,s=null,r=!0;const o=()=>{r&&setTimeout(o,10);const f=l.getBoundingClientRect();(t!==f.width||n!==f.height||i!==f.x||s!==f.y)&&(t=f.width,n=f.height,i=f.x,s=f.y,e&&e.set(f))};return o(),{destroy:()=>r=!1}};function Nn(l){let e;return{c(){e=k("div"),e.innerHTML=`<div class="svelte-j15bjw"></div> 
	<div class="svelte-j15bjw"></div> 
	<div class="svelte-j15bjw"></div>`,S(e,"class","lds-roller svelte-j15bjw")},m(t,n){C(t,e,n)},p:Z,i:Z,o:Z,d(t){t&&E(e)}}}class Pe extends ge{constructor(e){super(),_e(this,e,null,Nn,de,{})}}const{Map:Rn}=Nl;function Yt(l,e,t){const n=l.slice();return n[15]=e[t],n}function Ut(l){let e,t,n;return{c(){e=U("("),t=U(l[4]),n=U(")")},m(i,s){C(i,e,s),C(i,t,s),C(i,n,s)},p(i,s){s&16&&te(t,i[4])},d(i){i&&E(e),i&&E(t),i&&E(n)}}}function Gt(l){let e,t,n,i;return t=new Pe({}),{c(){e=k("div"),re(t.$$.fragment),S(e,"class","pos_abs loading svelte-nqr5he")},m(s,r){C(s,e,r),ie(t,e,null),i=!0},i(s){i||(D(t.$$.fragment,s),s&&ye(()=>{n||(n=me(e,we,{},!0)),n.run(1)}),i=!0)},o(s){q(t.$$.fragment,s),s&&(n||(n=me(e,we,{},!1)),n.run(0)),i=!1},d(s){s&&E(e),se(t),s&&n&&n.end()}}}function Wt(l){let e,t,n=l[15].username+"",i;return{c(){e=k("div"),t=U("@"),i=U(n),S(e,"class","nowrap textOverEllipsis username svelte-nqr5he")},m(s,r){C(s,e,r),h(e,t),h(e,i)},p(s,r){r&8&&n!==(n=s[15].username+"")&&te(i,n)},d(s){s&&E(e)}}}function zt(l){let e,t,n;return t=new Pe({}),{c(){e=k("div"),re(t.$$.fragment),S(e,"class","pos_abs loadingLead svelte-nqr5he")},m(i,s){C(i,e,s),ie(t,e,null),n=!0},i(i){n||(D(t.$$.fragment,i),n=!0)},o(i){q(t.$$.fragment,i),n=!1},d(i){i&&E(e),se(t)}}}function Xt(l,e){var M,A;let t,n,i,s=((M=e[15].first_name)!=null?M:"")+"",r,o,a,f,u,p=((A=e[15].last_name)!=null?A:"")+"",c,d,_,m=e[2].has(e[15].tg_id)||e[1].has(e[15].tg_id),w,L,g,v,I=e[15].username&&Wt(e),b=m&&zt();return{key:l,first:null,c(){t=k("div"),n=k("div"),i=k("div"),r=U(s),o=j(),a=k("div"),f=j(),u=k("div"),c=U(p),d=j(),I&&I.c(),_=j(),b&&b.c(),w=j(),R(a,"width","8px"),S(n,"class","flex nowrap textOverEllipsis userAttr svelte-nqr5he"),S(t,"class","flex flex_clm cursor_ptr w100 item unselect pos_abs svelte-nqr5he"),R(t,"top",e[15].y+"px"),R(t,"height",Yl+"px"),Q(t,"disabled",e[1].has(e[15].tg_id)),this.first=t},m(y,T){C(y,t,T),h(t,n),h(n,i),h(i,r),h(n,o),h(n,a),h(n,f),h(n,u),h(u,c),h(t,d),I&&I.m(t,null),h(t,_),b&&b.m(t,null),h(t,w),L=!0,g||(v=ee(t,"click",function(){je(e[6](e[15].tg_id))&&e[6](e[15].tg_id).apply(this,arguments)}),g=!0)},p(y,T){var O,F;e=y,(!L||T&8)&&s!==(s=((O=e[15].first_name)!=null?O:"")+"")&&te(r,s),(!L||T&8)&&p!==(p=((F=e[15].last_name)!=null?F:"")+"")&&te(c,p),e[15].username?I?I.p(e,T):(I=Wt(e),I.c(),I.m(t,_)):I&&(I.d(1),I=null),T&14&&(m=e[2].has(e[15].tg_id)||e[1].has(e[15].tg_id)),m?b?T&14&&D(b,1):(b=zt(),b.c(),D(b,1),b.m(t,w)):b&&(ae(),q(b,1,1,()=>{b=null}),fe()),(!L||T&8)&&R(t,"top",e[15].y+"px"),(!L||T&10)&&Q(t,"disabled",e[1].has(e[15].tg_id))},i(y){L||(D(b),L=!0)},o(y){q(b),L=!1},d(y){y&&E(t),I&&I.d(),b&&b.d(),g=!1,v()}}}function Fn(l){let e,t,n,i,s,r,o,a,f=[],u=new Rn,p,c,d,_=l[4]!==null&&Ut(l),m=l[5]&&Gt(),w=l[3];const L=g=>g[15].tg_id;for(let g=0;g<w.length;g+=1){let v=Yt(l,w,g),I=L(v);u.set(I,f[g]=Xt(I,v))}return{c(){e=k("div"),t=k("div"),n=U(`New leads\r
		\r
		`),_&&_.c(),i=j(),m&&m.c(),s=j(),r=k("div"),o=k("div"),a=k("div");for(let g=0;g<f.length;g+=1)f[g].c();S(t,"class","flex flex_cx flex_cy header pos_rel w100 svelte-nqr5he"),S(a,"class","flex list h100 svelte-nqr5he"),S(o,"class","pos_abs w100"),R(o,"overflow","hidden"),S(r,"class","flex cnt h100 pos_rel w100 svelte-nqr5he"),S(e,"class","flex flex_clm wrapMain flex_grow_1 w100 svelte-nqr5he")},m(g,v){C(g,e,v),h(e,t),h(t,n),_&&_.m(t,null),h(t,i),m&&m.m(t,null),h(e,s),h(e,r),h(r,o),h(o,a);for(let I=0;I<f.length;I+=1)f[I].m(a,null);l[9](o),p=!0,c||(d=Xe(rt.call(null,o)),c=!0)},p(g,[v]){g[4]!==null?_?_.p(g,v):(_=Ut(g),_.c(),_.m(t,i)):_&&(_.d(1),_=null),g[5]?m?v&32&&D(m,1):(m=Gt(),m.c(),D(m,1),m.m(t,null)):m&&(ae(),q(m,1,1,()=>{m=null}),fe()),v&78&&(w=g[3],ae(),f=He(f,v,L,1,g,w,u,a,Ke,Xt,null,Yt),fe())},i(g){if(!p){D(m);for(let v=0;v<w.length;v+=1)D(f[v]);p=!0}},o(g){q(m);for(let v=0;v<f.length;v+=1)q(f[v]);p=!1},d(g){g&&E(e),_&&_.d(),m&&m.d();for(let v=0;v<f.length;v+=1)f[v].d();l[9](null),c=!1,d()}}}const Bn=160,Yl=42,ft=0;function Yn(l,e,t){let{app:n}=e,i=[],s=new Map,r=new Set,o=[],a=null;function f(){if(!a)return;const g=a.getBoundingClientRect(),v=Bn+ft*2,I=Yl+ft*2,b=Math.max(1,Math.floor(g.width/v)),M=(g.width-b*v)/2,A=ft;t(3,o=i.map((y,T)=>{const O={...y};return O.x=T%b*v+M,O.y=A+Math.floor(T/b)*I,O}))}let u=null,p=!1;async function c(){var v;const g=await g_Api.lead_GetUnassignedList({offset:0,limit:20});return g?(t(4,u=g.count),(v=g.results)!=null?v:g):null}let d=!0;async function _(){for(;d;){await Rl(g_Config.updateIntervals.new_leads);const g=await c();if(!g)continue;const v=new Set(i.map(T=>T.tg_id)),I=new Set(g.map(T=>T.tg_id)),b=g.filter(T=>!v.has(T.tg_id)),M=i.filter(T=>!I.has(T.tg_id)),A=Date.now();M.map(T=>s.has(T.tg_id)||s.set(T.tg_id,A)),b.length===0&&M.length===0||t(8,i=[...i,...b]);const y=new Set;[...s].map(T=>{T[1]+2e3<=A&&y.add(T[0]),T[1]+1e4<=A&&s.delete(T[0])}),y.size&&t(8,i=i.filter(T=>!y.has(T.tg_id)))}}async function m(){for(t(5,p=!0);d;){const g=await c();if(g){t(8,i=g);break}}t(5,p=!1),_()}Ve(()=>d=!1);const w=g=>async v=>{if(r.has(g)||s.has(g))return;r.add(g),t(2,r);const I=await g_Api.lead_AssignOperatorSelft(g);r.delete(g),t(2,r),I!==null&&(s.set(g,Date.now()),t(1,s)),t(8,i),t(3,o)};m();function L(g){Ie[g?"unshift":"push"](()=>{a=g,t(0,a)})}return l.$$set=g=>{"app"in g&&t(7,n=g.app)},l.$$.update=()=>{l.$$.dirty&257&&f()},[a,s,r,o,u,p,w,n,i,L]}class Un extends ge{constructor(e){super(),_e(this,e,Yn,Fn,de,{app:7})}}function Jt(l,e,t){const n=l.slice();return n[15]=e[t],n}function Gn(l){let e;return{c(){e=U("\xA0")},m(t,n){C(t,e,n)},p:Z,d(t){t&&E(e)}}}function Wn(l){var n,i;let e=((i=(n=l[4])==null?void 0:n.last_message)==null?void 0:i.text)+"",t;return{c(){t=U(e)},m(s,r){C(s,t,r)},p(s,r){var o,a;r&16&&e!==(e=((a=(o=s[4])==null?void 0:o.last_message)==null?void 0:a.text)+"")&&te(t,e)},d(s){s&&E(t)}}}function Vt(l,e){let t,n=e[15].title.toLowerCase()+"",i;return{key:l,first:null,c(){t=k("div"),i=U(n),S(t,"class","flex tag svelte-12fqkv3"),R(t,"background",e[15].background_color),R(t,"color",e[15].color),this.first=t},m(s,r){C(s,t,r),h(t,i)},p(s,r){e=s,r&16&&n!==(n=e[15].title.toLowerCase()+"")&&te(i,n),r&16&&R(t,"background",e[15].background_color),r&16&&R(t,"color",e[15].color)},d(s){s&&E(t)}}}function Kt(l){var i;let e,t=l[11]((i=l[4])==null?void 0:i._lastTime)+"",n;return{c(){e=k("div"),n=U(t),S(e,"class","pos_abs flex flex_cx flex_cy lastTime svelte-12fqkv3")},m(s,r){C(s,e,r),h(e,n)},p(s,r){var o;r&16&&t!==(t=s[11]((o=s[4])==null?void 0:o._lastTime)+"")&&te(n,t)},d(s){s&&E(e)}}}function Qt(l){var i;let e,t=((i=l[4])==null?void 0:i.unread_messages_count)+"",n;return{c(){e=k("div"),n=U(t),S(e,"class","pos_abs flex flex_cx flex_cy unreadMsgs svelte-12fqkv3")},m(s,r){C(s,e,r),h(e,n)},p(s,r){var o;r&16&&t!==(t=((o=s[4])==null?void 0:o.unread_messages_count)+"")&&te(n,t)},d(s){s&&E(e)}}}function zn(l){var he,ve,Oe,Te,ue,oe,Me,Ce,ne,be,ke,Qe;let e,t,n,i,s,r,o=((Oe=(ve=(he=l[4])==null?void 0:he.lead)==null?void 0:ve.first_name)!=null?Oe:"")+"",a,f,u,p,c,d=((oe=(ue=(Te=l[4])==null?void 0:Te.lead)==null?void 0:ue.last_name)!=null?oe:"")+"",_,m,w,L,g,v,I,b,M,A=l[0].lead_GetStatusTitle((Ce=(Me=l[4])==null?void 0:Me.lead)==null?void 0:Ce.status)+"",y,T,O,F,V,H=[],z=new Map,K,Y,B,X;function le(G,ce){var Le,Be;return(Be=(Le=G[4])==null?void 0:Le.last_message)!=null&&Be.text?Wn:Gn}let N=le(l),x=N(l),P=(be=(ne=l[4])==null?void 0:ne.tag)!=null?be:[];const W=G=>G[15].id;for(let G=0;G<P.length;G+=1){let ce=Jt(l,P,G),Le=W(ce);z.set(Le,H[G]=Vt(Le,ce))}let J=((ke=l[4])==null?void 0:ke._lastTime)&&Kt(l),$=((Qe=l[4])==null?void 0:Qe.unread_messages_count)&&Qt(l);return{c(){e=k("div"),t=k("div"),n=k("div"),i=k("div"),s=j(),r=k("div"),a=U(o),f=j(),u=k("div"),p=j(),c=k("div"),_=U(d),m=j(),w=k("div"),x.c(),L=j(),g=k("div"),v=k("div"),I=k("img"),M=j(),y=U(A),T=j(),O=k("div"),F=j(),V=k("div");for(let G=0;G<H.length;G+=1)H[G].c();K=j(),J&&J.c(),Y=j(),$&&$.c(),R(i,"width","8px"),R(u,"width","8px"),S(n,"class","flex nowrap textOverEllipsis userFirstLastName pos_rel svelte-12fqkv3"),S(w,"class","nowrap textOverEllipsis lastMessage pos_rel svelte-12fqkv3"),pt(I.src,b="assets/icons/status1.png")||S(I,"src",b),S(I,"draggable","false"),S(I,"class","pos_abs statusIcon svelte-12fqkv3"),S(v,"class","flex flex_cy leadStatus pos_rel svelte-12fqkv3"),R(O,"width","4px"),S(V,"class","flex tag_list svelte-12fqkv3"),S(g,"class","flex"),S(t,"class","flex flex_clm cursor_ptr item flex_cx unselect pos_rel svelte-12fqkv3"),R(t,"height",l[1]+"px"),Q(t,"active",l[2]===l[6]),S(e,"class","pos_abs w100"),R(e,"top",l[5]+l[3]+"px")},m(G,ce){C(G,e,ce),h(e,t),h(t,n),h(n,i),h(n,s),h(n,r),h(r,a),h(n,f),h(n,u),h(n,p),h(n,c),h(c,_),h(t,m),h(t,w),x.m(w,null),h(t,L),h(t,g),h(g,v),h(v,I),h(v,M),h(v,y),h(g,T),h(g,O),h(g,F),h(g,V);for(let Le=0;Le<H.length;Le+=1)H[Le].m(V,null);h(t,K),J&&J.m(t,null),h(t,Y),$&&$.m(t,null),B||(X=ee(t,"click",l[10]),B=!0)},p(G,[ce]){var Le,Be,kt,Lt,St,Tt,Mt,It,Ot,At,Dt,Et;ce&16&&o!==(o=((kt=(Be=(Le=G[4])==null?void 0:Le.lead)==null?void 0:Be.first_name)!=null?kt:"")+"")&&te(a,o),ce&16&&d!==(d=((Tt=(St=(Lt=G[4])==null?void 0:Lt.lead)==null?void 0:St.last_name)!=null?Tt:"")+"")&&te(_,d),N===(N=le(G))&&x?x.p(G,ce):(x.d(1),x=N(G),x&&(x.c(),x.m(w,null))),ce&17&&A!==(A=G[0].lead_GetStatusTitle((It=(Mt=G[4])==null?void 0:Mt.lead)==null?void 0:It.status)+"")&&te(y,A),ce&16&&(P=(At=(Ot=G[4])==null?void 0:Ot.tag)!=null?At:[],H=He(H,ce,W,1,G,P,z,V,bt,Vt,null,Jt)),(Dt=G[4])!=null&&Dt._lastTime?J?J.p(G,ce):(J=Kt(G),J.c(),J.m(t,Y)):J&&(J.d(1),J=null),(Et=G[4])!=null&&Et.unread_messages_count?$?$.p(G,ce):($=Qt(G),$.c(),$.m(t,null)):$&&($.d(1),$=null),ce&2&&R(t,"height",G[1]+"px"),ce&68&&Q(t,"active",G[2]===G[6]),ce&40&&R(e,"top",G[5]+G[3]+"px")},i:Z,o:Z,d(G){G&&E(e),x.d();for(let ce=0;ce<H.length;ce+=1)H[ce].d();J&&J.d(),$&&$.d(),B=!1,X()}}}function Xn(l,e,t){let n,i,s,r,{app:o}=e;const{dialogMap_r:a,dialogActiveID_r:f,dialogActiveID_Set:u}=o;pe(l,a,g=>t(13,i=g)),pe(l,f,g=>t(6,r=g));let{height:p=54}=e,{dialog_id:c}=e,{y:d=0}=e,{scrollY:_=0}=e;const m=Fe(d);pe(l,m,g=>t(5,s=g));const w=g=>{n&&u(n.id)},L=g=>{if(!g)return"";const v=b=>String(b).padStart(2,"0"),I=new Date;return g=new Date(g),g.getYear()===I.getYear()&&g.getMonth()===I.getMonth()?g.getDate()===I.getDate()?`${v(g.getHours())}:${v(g.getMinutes())}`:`${v(g.getDate())}d ${v(g.getHours())}:${v(g.getMinutes())}`:`${v(g.getDate())}.${v(g.getMonth())}.${g.getFullYear()}`};return l.$$set=g=>{"app"in g&&t(0,o=g.app),"height"in g&&t(1,p=g.height),"dialog_id"in g&&t(2,c=g.dialog_id),"y"in g&&t(12,d=g.y),"scrollY"in g&&t(3,_=g.scrollY)},l.$$.update=()=>{l.$$.dirty&4096&&We(m,s=d,s),l.$$.dirty&8196&&t(4,n=i[c])},[o,p,c,_,n,s,r,a,f,m,w,L,d,i]}class Jn extends ge{constructor(e){super(),_e(this,e,Xn,zn,de,{app:0,height:1,dialog_id:2,y:12,scrollY:3})}}function Vn(l){let e,t,n,i;return{c(){e=k("div"),t=k("div"),S(t,"class","pos_abs thumb w100 svelte-5ca5ia"),R(t,"height",l[1]+"px"),R(t,"top",l[5](l[0],l[2],l[1])+"px"),Q(t,"active",l[3]),S(e,"class","pos_rel h100 unselect line svelte-5ca5ia"),Q(e,"active",l[3])},m(s,r){C(s,e,r),h(e,t),n||(i=[ee(window,"mousemove",l[7]),ee(window,"mouseup",l[8]),ee(window,"blur",l[8]),ee(t,"mousedown",l[6]),Xe(Pn.call(null,e,l[4])),ee(e,"mousedown",l[9])],n=!0)},p(s,[r]){r&2&&R(t,"height",s[1]+"px"),r&7&&R(t,"top",s[5](s[0],s[2],s[1])+"px"),r&8&&Q(t,"active",s[3]),r&8&&Q(e,"active",s[3])},i:Z,o:Z,d(s){s&&E(e),n=!1,Se(i)}}}function Kn(l,e,t){let n;const i=v=>De(0,Array.isArray(v)?v[0]:v,1);let{value_in:s=0}=e,{value_out:r=i(s)}=e,{thumb_Height:o=20}=e,{thumb_HeightRate:a=null}=e;const f=Ee(null);pe(l,f,v=>t(2,n=v));const u=()=>n?n.height-o:1,p=v=>n?v*u():0,c=()=>{if(!n)return 1;if(a===null)return o;t(1,o=De(.1,a,1)*n.height)};let d=null;const _=v=>{!n||t(3,d={y:v.clientY,value_out:r})},m=v=>{if(!n||!d)return;const I=v.clientY-d.y;if(n.height){const b=I/u();t(0,r=De(0,d.value_out+b,1))}},w=v=>{t(3,d=null)},L=v=>{!n||d||(t(0,r=De(0,(v.clientY-n.y-o/2)/u(),1)),t(3,d={y:v.clientY,value_out:r}))},g=()=>{if(!n)return 0;d||t(0,r=i(s))};return l.$$set=v=>{"value_in"in v&&t(10,s=v.value_in),"value_out"in v&&t(0,r=v.value_out),"thumb_Height"in v&&t(1,o=v.thumb_Height),"thumb_HeightRate"in v&&t(11,a=v.thumb_HeightRate)},l.$$.update=()=>{l.$$.dirty&2052&&c(),l.$$.dirty&1024&&g()},[r,o,n,d,f,p,_,m,w,L,s,a]}class Ul extends ge{constructor(e){super(),_e(this,e,Kn,Vn,de,{value_in:10,value_out:0,thumb_Height:1,thumb_HeightRate:11})}}const{Map:Qn}=Nl;function Zt(l,e,t){const n=l.slice();return n[24]=e[t],n}function xt(l,e){let t,n,i;return n=new Jn({props:{app:e[0],height:qe,dialog_id:e[24].dialog_id,scrollY:-e[2],y:e[24].y}}),{key:l,first:null,c(){t=Je(),re(n.$$.fragment),this.first=t},m(s,r){C(s,t,r),ie(n,s,r),i=!0},p(s,r){e=s;const o={};r&1&&(o.app=e[0]),r&16&&(o.dialog_id=e[24].dialog_id),r&4&&(o.scrollY=-e[2]),r&16&&(o.y=e[24].y),n.$set(o)},i(s){i||(D(n.$$.fragment,s),i=!0)},o(s){q(n.$$.fragment,s),i=!1},d(s){s&&E(t),se(n,s)}}}function $t(l){let e,t,n,i;function s(o){l[14](o)}let r={value_in:l[5],thumb_HeightRate:l[6]};return l[1]!==void 0&&(r.value_out=l[1]),t=new Ul({props:r}),Ie.push(()=>wt(t,"value_out",s)),{c(){e=k("div"),re(t.$$.fragment),S(e,"class","pos_abs h100 dialogScroll svelte-1l0pdn")},m(o,a){C(o,e,a),ie(t,e,null),i=!0},p(o,a){const f={};a&32&&(f.value_in=o[5]),a&64&&(f.thumb_HeightRate=o[6]),!n&&a&2&&(n=!0,f.value_out=o[1],vt(()=>n=!1)),t.$set(f)},i(o){i||(D(t.$$.fragment,o),i=!0)},o(o){q(t.$$.fragment,o),i=!1},d(o){o&&E(e),se(t)}}}function el(l){let e,t,n,i,s;return{c(){e=k("div"),e.innerHTML='<img class="flex" draggable="false" style="filter: invert(1);" src="assets/icons/arrow-up.png"/>',S(e,"class","flex pos_abs cursor_ptr btnScrollUp svelte-1l0pdn")},m(r,o){C(r,e,o),n=!0,i||(s=ee(e,"click",l[15]),i=!0)},p:Z,i(r){n||(r&&ye(()=>{t||(t=me(e,we,{},!0)),t.run(1)}),n=!0)},o(r){r&&(t||(t=me(e,we,{},!1)),t.run(0)),n=!1},d(r){r&&E(e),r&&t&&t.end(),i=!1,s()}}}function Zn(l){let e,t,n=[],i=new Qn,s,r,o,a,f,u=l[4];const p=_=>_[24].dialog_id;for(let _=0;_<u.length;_+=1){let m=Zt(l,u,_),w=p(m);i.set(w,n[_]=xt(w,m))}let c=l[6]<1&&$t(l),d=l[6]<1&&l[7]&&el(l);return{c(){e=k("div"),t=k("div");for(let _=0;_<n.length;_+=1)n[_].c();s=j(),c&&c.c(),r=j(),d&&d.c(),S(t,"class","flex flex_clm flex_grow_1 overhide pos_abs"),S(e,"class","flex flex_grow_1 pos_rel")},m(_,m){C(_,e,m),h(e,t);for(let w=0;w<n.length;w+=1)n[w].m(t,null);h(e,s),c&&c.m(e,null),h(e,r),d&&d.m(e,null),o=!0,a||(f=[Xe(rt.call(null,t,l[8])),ee(e,"wheel",l[10])],a=!0)},p(_,[m]){m&21&&(u=_[4],ae(),n=He(n,m,p,1,_,u,i,t,Ke,xt,null,Zt),fe()),_[6]<1?c?(c.p(_,m),m&64&&D(c,1)):(c=$t(_),c.c(),D(c,1),c.m(e,r)):c&&(ae(),q(c,1,1,()=>{c=null}),fe()),_[6]<1&&_[7]?d?(d.p(_,m),m&192&&D(d,1)):(d=el(_),d.c(),D(d,1),d.m(e,null)):d&&(ae(),q(d,1,1,()=>{d=null}),fe())},i(_){if(!o){for(let m=0;m<u.length;m+=1)D(n[m]);D(c),D(d),o=!0}},o(_){for(let m=0;m<n.length;m+=1)q(n[m]);q(c),q(d),o=!1},d(_){_&&E(e);for(let m=0;m<n.length;m+=1)n[m].d();c&&c.d(),d&&d.d(),a=!1,Se(f)}}}const qe=54;function xn(l,e,t){let n,i,s=Z,r=()=>(s(),s=mt(_,H=>t(13,i=H)),_),o;l.$$.on_destroy.push(()=>s());let{app:a}=e;const{dialogMap_SetDialogList:f}=a;let{filter:u={}}=e;const p=H=>{var z;return[u.filterUnreadFirst?1:0,(z=u.filterTag)!=null?z:""].join("/")};let c={},d=null,_=Ee(null);r();function m(){const H={...u},z=p();c[z]||(c[z]=dn({fLoad:K=>(K={unread_first:H.filterUnreadFirst?1:0,...K},H.filterTag&&(K.tag=H.filterTag),g_Api.dialog_GetList(K)),updateInterval:500,isLoadEnd:!1,onUpdateItemList:f})),d!==c[z]&&([...Object.values(c)].map(K=>K.pause()),d=c[z],d.resume(),console.log({filterHash:z}),r(t(3,_=d.getData_r())))}Ve(()=>[...Object.values(c)].map(H=>H.destroy()));let w=[];const L=Ee(null);pe(l,L,H=>t(12,n=H));let g=0,v=0,I=1,b=0,M=Fe(b,{duration:200});pe(l,M,H=>t(2,o=H));function A(){if(!n||!i)return;const H=Math.max(1,Math.floor(n.height)),z=i.total*qe,K=z-H;t(6,I=z?De(0,H/z,1):1),K<0?b=0:b=v*K,We(M,o=b,o)}let y=!1;function T(){if(!n||!i)return;const H=i,z=Math.max(1,Math.floor(n.height)),K=Math.ceil(z/qe);i.total*qe;let B=Math.max(0,Math.floor(o/qe)-1);const X=K+2;B>H.total&&(B=Math.max(0,H.total-X)),d&&d.setRange(B,X);const le=[];for(let N=B,x=0;x<X&&N<H.total;x++,N++){const P=H.list[N];le.push({index:N,item:P,y:N*qe})}t(4,w=[...new Map(le.filter(N=>N.item).map(N=>[N.item.id,N]))].map(([N,x])=>({dialog_id:x.item.id,y:x.y}))),t(7,y=B>1)}const O=H=>{if(!n||!i)return;const z=i,K=Math.max(1,Math.floor(n.height)),B=z.total*qe-K;if(B<0)return;const X=H.deltaY>0?1:-1;t(5,g=[v+qe/B*X])};function F(H){v=H,t(1,v)}const V=()=>t(5,g=[0]);return l.$$set=H=>{"app"in H&&t(0,a=H.app),"filter"in H&&t(11,u=H.filter)},l.$$.update=()=>{l.$$.dirty&2048&&m(),l.$$.dirty&12290&&A(),l.$$.dirty&12294&&T()},[a,v,o,_,w,g,I,y,L,M,O,u,n,i,F,V]}class $n extends ge{constructor(e){super(),_e(this,e,xn,Zn,de,{app:0,filter:11})}}function tl(l,e,t){const n=l.slice();return n[5]=e[t],n}function ll(l,e){let t,n=e[5].title+"",i,s,r;function o(){return e[4](e[5])}return{key:l,first:null,c(){t=k("div"),i=U(n),S(t,"class","cursor_ptr filter_tag inactive svelte-12nwhpm"),R(t,"background",e[5].background_color),R(t,"color",e[5].color),Q(t,"active",e[0]===e[5].title),this.first=t},m(a,f){C(a,t,f),h(t,i),s||(r=ee(t,"click",o),s=!0)},p(a,f){e=a,f&3&&Q(t,"active",e[0]===e[5].title)},d(a){a&&E(t),s=!1,r()}}}function ei(l){let e,t,n,i,s,r,o=[],a=new Map,f,u,p=l[1];const c=d=>d[5].title;for(let d=0;d<p.length;d+=1){let _=tl(l,p,d),m=c(_);a.set(m,o[d]=ll(m,_))}return{c(){e=k("div"),t=k("div"),t.textContent="Filter tag",n=j(),i=k("div"),s=k("div"),s.textContent="all",r=j();for(let d=0;d<o.length;d+=1)o[d].c();S(t,"class","flex label svelte-12nwhpm"),S(s,"class","cursor_ptr filter_tag inactive svelte-12nwhpm"),R(s,"background","#fff"),R(s,"color","#000"),Q(s,"active",l[0]===null),S(i,"class","flex filter_tag_list svelte-12nwhpm"),S(e,"class","flex flex_clm cnt unselect svelte-12nwhpm")},m(d,_){C(d,e,_),h(e,t),h(e,n),h(e,i),h(i,s),h(i,r);for(let m=0;m<o.length;m+=1)o[m].m(i,null);f||(u=ee(s,"click",l[3]),f=!0)},p(d,[_]){_&1&&Q(s,"active",d[0]===null),_&3&&(p=d[1],o=He(o,_,c,1,d,p,a,i,bt,ll,null,tl))},i:Z,o:Z,d(d){d&&E(e);for(let _=0;_<o.length;_+=1)o[_].d();f=!1,u()}}}function ti(l,e,t){let{app:n}=e,{filterTag:i=null}=e,s=[...g_Config.pinnedTags];const r=()=>t(0,i=null),o=a=>t(0,i=a.title);return l.$$set=a=>{"app"in a&&t(2,n=a.app),"filterTag"in a&&t(0,i=a.filterTag)},[i,s,n,r,o]}class li extends ge{constructor(e){super(),_e(this,e,ti,ei,de,{app:2,filterTag:0})}}function nl(l,e,t){const n=l.slice();return n[9]=e[t],n}function il(l){let e,t;return{c(){e=k("div"),t=U(l[1]),S(e,"class","username svelte-1vzm2ij")},m(n,i){C(n,e,i),h(e,t)},p(n,i){i&2&&te(t,n[1])},d(n){n&&E(e)}}}function sl(l){let e,t;return{c(){e=k("img"),S(e,"class","a_img svelte-1vzm2ij"),pt(e.src,t=l[9].url)||S(e,"src",t)},m(n,i){C(n,e,i)},p:Z,d(n){n&&E(e)}}}function ni(l){let e,t,n,i,s,r,o=l[0]&&l[1]&&il(l),a=l[4],f=[];for(let u=0;u<a.length;u+=1)f[u]=sl(nl(l,a,u));return{c(){e=k("div"),o&&o.c(),t=j();for(let u=0;u<f.length;u+=1)f[u].c();n=j(),i=k("div"),s=k("pre"),r=U(l[2]),S(s,"class","text svelte-1vzm2ij"),S(i,"class","flex"),S(e,"class","flex flex_clm chat_item pos_abs svelte-1vzm2ij"),Q(e,"chat_item_other",l[0]),Q(e,"chat_item_self",!l[0])},m(u,p){C(u,e,p),o&&o.m(e,null),h(e,t);for(let c=0;c<f.length;c+=1)f[c].m(e,null);h(e,n),h(e,i),h(i,s),h(s,r),l[8](e)},p(u,[p]){if(u[0]&&u[1]?o?o.p(u,p):(o=il(u),o.c(),o.m(e,t)):o&&(o.d(1),o=null),p&16){a=u[4];let c;for(c=0;c<a.length;c+=1){const d=nl(u,a,c);f[c]?f[c].p(d,p):(f[c]=sl(d),f[c].c(),f[c].m(e,n))}for(;c<f.length;c+=1)f[c].d(1);f.length=a.length}p&4&&te(r,u[2]),p&1&&Q(e,"chat_item_other",u[0]),p&1&&Q(e,"chat_item_self",!u[0])},i:Z,o:Z,d(u){u&&E(e),o&&o.d(),Hl(f,u),l[8](null)}}}function ii(l,e,t){let{incoming:n=!1}=e,{username:i=null}=e,{text:s=null}=e,{attachments:r=[]}=e,{render_Width:o=1}=e,{render_X:a=-o*2}=e,f=null;Array.isArray(r)||console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>",[i,s,r]);const u=(r!=null?r:[]).filter(c=>c.file_type==="IM");function p(c){Ie[c?"unshift":"push"](()=>{f=c,t(3,f)})}return l.$$set=c=>{"incoming"in c&&t(0,n=c.incoming),"username"in c&&t(1,i=c.username),"text"in c&&t(2,s=c.text),"attachments"in c&&t(5,r=c.attachments),"render_Width"in c&&t(6,o=c.render_Width),"render_X"in c&&t(7,a=c.render_X)},[n,i,s,f,u,r,o,a,p]}class si extends ge{constructor(e){super(),_e(this,e,ii,ni,de,{incoming:0,username:1,text:2,attachments:5,render_Width:6,render_X:7})}}function rl(l,e,t){const n=l.slice();return n[21]=e[t],n}function ol(l){var I,b,M,A;let e,t,n,i,s,r,o,a,f=l[0].lead_GetStatusTitle((b=(I=l[6])==null?void 0:I.lead)==null?void 0:b.status)+"",u,p,c,d,_,m,w,L=l[2]&&al(l),g=((A=(M=l[6])==null?void 0:M.lead)==null?void 0:A.status)!=="DL"&&ul(l),v=l[3]&&cl();return{c(){var y,T,O,F;e=k("div"),t=k("div"),n=k("div"),i=j(),s=k("img"),o=j(),a=k("div"),u=U(f),p=j(),L&&L.c(),c=j(),g&&g.c(),d=j(),v&&v.c(),S(n,"class","pos_abs w100 h100 deleteProgress svelte-10eax3m"),R(n,"width",l[1]+"%"),S(t,"class","pos_abs w100 h100 overhide bg svelte-10eax3m"),pt(s.src,r="assets/icons/status1.png")||S(s,"src",r),S(s,"draggable","false"),S(s,"class","pos_abs statusIcon svelte-10eax3m"),S(a,"class","flex flex_cy nowrap pos_rel label svelte-10eax3m"),Q(a,"leftBlock",((T=(y=l[6])==null?void 0:y.lead)==null?void 0:T.status)!=="DL"),S(e,"class","flex flex_cx flex_cy cursor_ptr unselect statusCnt pos_rel svelte-10eax3m"),Q(e,"loading",l[3]||((F=(O=l[6])==null?void 0:O.lead)==null?void 0:F.status)==="DL")},m(y,T){C(y,e,T),h(e,t),h(t,n),h(e,i),h(e,s),h(e,o),h(e,a),h(a,u),h(a,p),L&&L.m(a,null),h(e,c),g&&g.m(e,null),h(e,d),v&&v.m(e,null),l[15](e),_=!0,m||(w=ee(a,"click",l[8]),m=!0)},p(y,T){var O,F,V,H,z,K,Y,B;(!_||T&2)&&R(n,"width",y[1]+"%"),(!_||T&65)&&f!==(f=y[0].lead_GetStatusTitle((F=(O=y[6])==null?void 0:O.lead)==null?void 0:F.status)+"")&&te(u,f),y[2]?L?(L.p(y,T),T&4&&D(L,1)):(L=al(y),L.c(),D(L,1),L.m(a,null)):L&&(ae(),q(L,1,1,()=>{L=null}),fe()),(!_||T&64)&&Q(a,"leftBlock",((H=(V=y[6])==null?void 0:V.lead)==null?void 0:H.status)!=="DL"),((K=(z=y[6])==null?void 0:z.lead)==null?void 0:K.status)!=="DL"?g?g.p(y,T):(g=ul(y),g.c(),g.m(e,d)):g&&(g.d(1),g=null),y[3]?v?T&8&&D(v,1):(v=cl(),v.c(),D(v,1),v.m(e,null)):v&&(ae(),q(v,1,1,()=>{v=null}),fe()),(!_||T&72)&&Q(e,"loading",y[3]||((B=(Y=y[6])==null?void 0:Y.lead)==null?void 0:B.status)==="DL")},i(y){_||(D(L),D(v),_=!0)},o(y){q(L),q(v),_=!1},d(y){y&&E(e),L&&L.d(),g&&g.d(),v&&v.d(),l[15](null),m=!1,w()}}}function al(l){var a,f;let e,t=[],n=new Map,i,s,r=l[0].lead_GetStatusList((f=(a=l[6])==null?void 0:a.lead)==null?void 0:f.status);const o=u=>u[21].id;for(let u=0;u<r.length;u+=1){let p=rl(l,r,u),c=o(p);n.set(c,t[u]=fl(c,p))}return{c(){e=k("div");for(let u=0;u<t.length;u+=1)t[u].c();S(e,"class","flex flex_clm pos_abs overhide selectList svelte-10eax3m")},m(u,p){C(u,e,p);for(let c=0;c<t.length;c+=1)t[c].m(e,null);s=!0},p(u,p){var c,d;p&1089&&(r=u[0].lead_GetStatusList((d=(c=u[6])==null?void 0:c.lead)==null?void 0:d.status),t=He(t,p,o,1,u,r,n,e,bt,fl,null,rl))},i(u){s||(u&&ye(()=>{i||(i=me(e,st,{},!0)),i.run(1)}),s=!0)},o(u){u&&(i||(i=me(e,st,{},!1)),i.run(0)),s=!1},d(u){u&&E(e);for(let p=0;p<t.length;p+=1)t[p].d();u&&i&&i.end()}}}function fl(l,e){let t,n=e[21].title+"",i,s,r;return{key:l,first:null,c(){t=k("div"),i=U(n),S(t,"class","flex nowrap cursor_ptr w100 label selectItem svelte-10eax3m"),this.first=t},m(o,a){C(o,t,a),h(t,i),s||(r=ee(t,"click",Jl(Xl(function(){je(e[10](e[21].id))&&e[10](e[21].id).apply(this,arguments)}))),s=!0)},p(o,a){e=o,a&65&&n!==(n=e[21].title+"")&&te(i,n)},d(o){o&&E(t),s=!1,r()}}}function ul(l){let e,t,n;return{c(){e=k("div"),e.textContent="Delete",S(e,"class","flex flex_cy nowrap pos_rel pad svelte-10eax3m")},m(i,s){C(i,e,s),t||(n=[ee(e,"mousedown",function(){je(l[11](l[6]))&&l[11](l[6]).apply(this,arguments)}),ee(e,"mouseleave",l[12])],t=!0)},p(i,s){l=i},d(i){i&&E(e),t=!1,Se(n)}}}function cl(l){let e,t,n,i;return t=new Pe({}),{c(){e=k("div"),re(t.$$.fragment),S(e,"class","pos_abs loadingInd svelte-10eax3m"),R(e,"transform","scale(0.23)"),R(e,"transform-origin","top"),R(e,"filter","invert(1)")},m(s,r){C(s,e,r),ie(t,e,null),i=!0},i(s){i||(D(t.$$.fragment,s),s&&ye(()=>{n||(n=me(e,we,{},!0)),n.run(1)}),i=!0)},o(s){q(t.$$.fragment,s),s&&(n||(n=me(e,we,{},!1)),n.run(0)),i=!1},d(s){s&&E(e),se(t),s&&n&&n.end()}}}function ri(l){let e,t,n,i,s=l[6]&&l[6].lead&&ol(l);return{c(){s&&s.c(),e=Je()},m(r,o){s&&s.m(r,o),C(r,e,o),t=!0,n||(i=[ee(window,"mouseup",l[12]),ee(window,"mousedown",l[9]),ee(window,"blur",l[9])],n=!0)},p(r,[o]){r[6]&&r[6].lead?s?(s.p(r,o),o&64&&D(s,1)):(s=ol(r),s.c(),D(s,1),s.m(e.parentNode,e)):s&&(ae(),q(s,1,1,()=>{s=null}),fe())},i(r){t||(D(s),t=!0)},o(r){q(s),t=!1},d(r){s&&s.d(r),r&&E(e),n=!1,Se(i)}}}function oi(l,e,t){let n,i,s,r=Z,o=()=>(r(),r=mt(b,O=>t(1,s=O)),b);l.$$.on_destroy.push(()=>r());let{app:a}=e;const{dialogMap_r:f,dialogMap_SetDialog:u}=a;pe(l,f,O=>t(14,i=O));let{dialog_id:p}=e,c=!1,d=!1;const _=()=>{var O;return!(!n||!n.lead||((O=n==null?void 0:n.lead)==null?void 0:O.status)==="DL"||d)};let m;const w=O=>{!_()||t(2,c=!c)},L=O=>{let F=O.target;for(;F;){if(F===m)return;F=F.parentNode}t(2,c=!1)},g=O=>async F=>{if(!!_()){if(t(2,c=!1),t(3,d=!0),n){const V=await g_Api.lead_SetStatus(n.lead.tg_id,O);V&&n&&n.lead&&n.lead.tg_id===V.tg_id&&(t(6,n.lead=V,n),u(n))}t(3,d=!1)}};let v=null,I=Number.POSITIVE_INFINITY,b=Fe(0,{duration:2e3});o();const M=O=>F=>{var V;t(2,c=!1),v=(V=O==null?void 0:O.lead)==null?void 0:V.tg_id,I=Date.now(),o(t(5,b=Fe(s,{duration:2e3}))),We(b,s=100,s)},A=O=>{t(2,c=!1),v=null,I=Number.POSITIVE_INFINITY,o(t(5,b=Fe(s,{duration:200}))),We(b,s=0,s)},y=async()=>{var O;!_()||(I+1200<Date.now()&&v===((O=n==null?void 0:n.lead)==null?void 0:O.tg_id)&&await g("DL")(),A())};function T(O){Ie[O?"unshift":"push"](()=>{m=O,t(4,m)})}return l.$$set=O=>{"app"in O&&t(0,a=O.app),"dialog_id"in O&&t(13,p=O.dialog_id)},l.$$.update=()=>{l.$$.dirty&2&&s>=100&&y(),l.$$.dirty&24576&&t(6,n=i[p])},[a,s,c,d,m,b,n,f,w,L,g,M,A,p,i,T]}class ai extends ge{constructor(e){super(),_e(this,e,oi,ri,de,{app:0,dialog_id:13})}}function dl(l,e,t){const n=l.slice();return n[20]=e[t],n}function _l(l,e,t){const n=l.slice();return n[20]=e[t],n}function gl(l){var d,_;let e,t,n,i=[],s=new Map,r,o,a,f,u=(_=(d=l[0])==null?void 0:d.tag)!=null?_:[];const p=m=>m[20].id;for(let m=0;m<u.length;m+=1){let w=_l(l,u,m),L=p(w);s.set(L,i[m]=ml(L,w))}let c=l[1]!==null&&l[0]&&l[1]===l[0].id&&l[3].length&&hl(l);return{c(){e=k("div"),t=k("div"),t.innerHTML=`Add tag
			<div class="flex flex_cx flex_cy h100 pos_abs tag_delete_btn svelte-elfos6">+</div>`,n=j();for(let m=0;m<i.length;m+=1)i[m].c();r=j(),c&&c.c(),S(t,"class","flex flex_cx flex_cy overhide cursor_ptr pos_rel tag_add tag svelte-elfos6"),Q(t,"disabled",l[3].length===0),S(e,"class","flex tag_list unselect pos_rel svelte-elfos6")},m(m,w){C(m,e,w),h(e,t),h(e,n);for(let L=0;L<i.length;L+=1)i[L].m(e,null);h(e,r),c&&c.m(e,null),l[14](e),o=!0,a||(f=ee(t,"click",l[13]),a=!0)},p(m,w){var L,g;(!o||w&8)&&Q(t,"disabled",m[3].length===0),w&325&&(u=(g=(L=m[0])==null?void 0:L.tag)!=null?g:[],ae(),i=He(i,w,p,1,m,u,s,e,Ke,ml,r,_l),fe()),m[1]!==null&&m[0]&&m[1]===m[0].id&&m[3].length?c?(c.p(m,w),w&11&&D(c,1)):(c=hl(m),c.c(),D(c,1),c.m(e,null)):c&&(ae(),q(c,1,1,()=>{c=null}),fe())},i(m){if(!o){for(let w=0;w<u.length;w+=1)D(i[w]);D(c),o=!0}},o(m){for(let w=0;w<i.length;w+=1)q(i[w]);q(c),o=!1},d(m){m&&E(e);for(let w=0;w<i.length;w+=1)i[w].d();c&&c.d(),l[14](null),a=!1,f()}}}function pl(l){let e,t,n;return t=new Pe({}),{c(){e=k("div"),re(t.$$.fragment),S(e,"class","pos_abs tag_loading svelte-elfos6")},m(i,s){C(i,e,s),ie(t,e,null),n=!0},i(i){n||(D(t.$$.fragment,i),n=!0)},o(i){q(t.$$.fragment,i),n=!1},d(i){i&&E(e),se(t)}}}function ml(l,e){let t,n=e[20].title.toLowerCase()+"",i,s,r,o,a=e[2]===e[6](e[0].id,e[20]),f,u,p,c=a&&pl();return{key:l,first:null,c(){t=k("div"),i=U(n),s=j(),r=k("div"),r.textContent="X",o=j(),c&&c.c(),S(r,"class","flex flex_cx flex_cy h100 pos_abs tag_delete_btn svelte-elfos6"),S(t,"class","flex flex_cx flex_cy overhide cursor_ptr pos_rel tag svelte-elfos6"),R(t,"background",e[20].background_color),R(t,"color",e[20].color),Q(t,"disabled",e[2]),this.first=t},m(d,_){C(d,t,_),h(t,i),h(t,s),h(t,r),h(t,o),c&&c.m(t,null),f=!0,u||(p=ee(t,"click",function(){je(e[8](e[20]))&&e[8](e[20]).apply(this,arguments)}),u=!0)},p(d,_){e=d,(!f||_&1)&&n!==(n=e[20].title.toLowerCase()+"")&&te(i,n),_&5&&(a=e[2]===e[6](e[0].id,e[20])),a?c?_&5&&D(c,1):(c=pl(),c.c(),D(c,1),c.m(t,null)):c&&(ae(),q(c,1,1,()=>{c=null}),fe()),(!f||_&1)&&R(t,"background",e[20].background_color),(!f||_&1)&&R(t,"color",e[20].color),(!f||_&4)&&Q(t,"disabled",e[2])},i(d){f||(D(c),f=!0)},o(d){q(c),f=!1},d(d){d&&E(t),c&&c.d(),u=!1,p()}}}function hl(l){let e,t,n=[],i=new Map,s,r,o=l[3];const a=f=>f[20].title;for(let f=0;f<o.length;f+=1){let u=dl(l,o,f),p=a(u);i.set(p,n[f]=bl(p,u))}return{c(){e=k("div"),t=k("div");for(let f=0;f<n.length;f+=1)n[f].c();S(t,"class","flex tagAddList1 svelte-elfos6"),R(t,"flex-wrap","wrap"),S(e,"class","pos_abs tag_settings flex flex_clm svelte-elfos6")},m(f,u){C(f,e,u),h(e,t);for(let p=0;p<n.length;p+=1)n[p].m(t,null);r=!0},p(f,u){u&205&&(o=f[3],ae(),n=He(n,u,a,1,f,o,i,t,Ke,bl,null,dl),fe())},i(f){if(!r){for(let u=0;u<o.length;u+=1)D(n[u]);f&&ye(()=>{s||(s=me(e,st,{},!0)),s.run(1)}),r=!0}},o(f){for(let u=0;u<n.length;u+=1)q(n[u]);f&&(s||(s=me(e,st,{},!1)),s.run(0)),r=!1},d(f){f&&E(e);for(let u=0;u<n.length;u+=1)n[u].d();f&&s&&s.end()}}}function vl(l){let e,t,n;return t=new Pe({}),{c(){e=k("div"),re(t.$$.fragment),S(e,"class","pos_abs tag_loading svelte-elfos6")},m(i,s){C(i,e,s),ie(t,e,null),n=!0},i(i){n||(D(t.$$.fragment,i),n=!0)},o(i){q(t.$$.fragment,i),n=!1},d(i){i&&E(e),se(t)}}}function bl(l,e){let t,n=e[20].title+"",i,s,r,o=e[2]===e[6](e[0].id,e[20]),a,f,u,p,c=o&&vl();return{key:l,first:null,c(){t=k("div"),i=U(n),s=k("div"),s.textContent="+",r=j(),c&&c.c(),a=j(),S(s,"class","flex flex_cx flex_cy h100 pos_abs tag_delete_btn svelte-elfos6"),S(t,"class","flex flex_cx flex_cy overhide cursor_ptr pos_rel tag_add tag svelte-elfos6"),R(t,"background",e[20].background_color),R(t,"color",e[20].color),Q(t,"disabled",e[2]),this.first=t},m(d,_){C(d,t,_),h(t,i),h(t,s),h(t,r),c&&c.m(t,null),h(t,a),f=!0,u||(p=ee(t,"click",function(){je(e[7](e[20]))&&e[7](e[20]).apply(this,arguments)}),u=!0)},p(d,_){e=d,(!f||_&8)&&n!==(n=e[20].title+"")&&te(i,n),_&13&&(o=e[2]===e[6](e[0].id,e[20])),o?c?_&13&&D(c,1):(c=vl(),c.c(),D(c,1),c.m(t,a)):c&&(ae(),q(c,1,1,()=>{c=null}),fe()),(!f||_&8)&&R(t,"background",e[20].background_color),(!f||_&8)&&R(t,"color",e[20].color),(!f||_&4)&&Q(t,"disabled",e[2])},i(d){f||(D(c),f=!0)},o(d){q(c),f=!1},d(d){d&&E(t),c&&c.d(),u=!1,p()}}}function fi(l){let e,t,n,i,s=l[0]&&gl(l);return{c(){s&&s.c(),e=Je()},m(r,o){s&&s.m(r,o),C(r,e,o),t=!0,n||(i=[ee(window,"mousedown",l[9]),ee(window,"blur",l[9])],n=!0)},p(r,[o]){r[0]?s?(s.p(r,o),o&1&&D(s,1)):(s=gl(r),s.c(),D(s,1),s.m(e.parentNode,e)):s&&(ae(),q(s,1,1,()=>{s=null}),fe())},i(r){t||(D(s),t=!0)},o(r){q(s),t=!1},d(r){s&&s.d(r),r&&E(e),n=!1,Se(i)}}}function ui(l,e,t){let n,i,{app:s}=e;const{dialogMap_r:r,dialogMap_SetDialog:o}=s;pe(l,r,b=>t(12,i=b));let{dialog_id:a=null}=e,f=null,u=!1;const p=async(b,M)=>{const A=await g_Api.dialog_SetTags(n.id,M);return A&&o(A),A},c=(b,M)=>{var A;return`${b}|${(A=M==null?void 0:M.title)!=null?A:"*"}`},d=b=>async M=>{if(!n||u)return;t(2,u=c(n.id,b));const A={color:"#fff",background_color:"#f00",...b,title:b.title.toLowerCase().trim()};await p(n.id,[...n.tag,A]),t(2,u=!1)},_=b=>async M=>{if(!n||u)return;t(2,u=c(n.id,b));const A=n.tag.filter(y=>y.id!==b.id).map(y=>({title:y.title,color:y.color,background_color:y.background_color}));await p(n.id,A),t(2,u=!1)};let m=[];function w(){var M;if(!n)return;const b=new Set(((M=n==null?void 0:n.tag)!=null?M:[]).map(A=>A.title));t(3,m=g_Config.pinnedTags.filter(A=>!b.has(A.title)))}let L;const g=b=>{let M=b.target;for(;M;){if(M===L)return;M=M.parentNode}t(1,f=null)},v=()=>t(1,f=n.id);function I(b){Ie[b?"unshift":"push"](()=>{L=b,t(4,L)})}return l.$$set=b=>{"app"in b&&t(10,s=b.app),"dialog_id"in b&&t(11,a=b.dialog_id)},l.$$.update=()=>{l.$$.dirty&6144&&t(0,n=i[a]),l.$$.dirty&1&&w()},[n,f,u,m,L,r,c,d,_,g,s,a,i,v,I]}class ci extends ge{constructor(e){super(),_e(this,e,ui,fi,de,{app:10,dialog_id:11})}}function wl(l){var V,H,z,K,Y,B,X,le,N,x;let e,t,n,i,s=((z=(H=(V=l[2])==null?void 0:V.lead)==null?void 0:H.first_name)!=null?z:"")+"",r,o,a,f,u,p=((B=(Y=(K=l[2])==null?void 0:K.lead)==null?void 0:Y.last_name)!=null?B:"")+"",c,d,_,m,w,L,g,v,I,b,M,A,y,T,O=((le=(X=l[2])==null?void 0:X.lead)==null?void 0:le.username)&&yl(l),F=((x=(N=l[2])==null?void 0:N.lead)==null?void 0:x.ref_link)&&kl(l);return g=new ai({props:{app:l[0],dialog_id:l[2].id}}),M=new ci({props:{app:l[0],dialog_id:l[2].id}}),{c(){e=k("div"),t=k("div"),n=j(),i=k("div"),r=U(s),o=j(),a=k("div"),f=j(),u=k("div"),c=U(p),d=j(),_=k("div"),O&&O.c(),m=j(),F&&F.c(),w=j(),L=k("div"),re(g.$$.fragment),v=j(),I=k("div"),b=j(),re(M.$$.fragment),A=j(),y=k("div"),R(t,"width","8px"),R(a,"width","8px"),S(e,"class","flex nowrap textOverEllipsis userFirstLastName pos_rel svelte-qywc37"),S(_,"class","nowrap textOverEllipsis username svelte-qywc37"),R(I,"width","4px"),S(L,"class","flex"),R(y,"height","4px")},m(P,W){C(P,e,W),h(e,t),h(e,n),h(e,i),h(i,r),h(e,o),h(e,a),h(e,f),h(e,u),h(u,c),C(P,d,W),C(P,_,W),O&&O.m(_,null),C(P,m,W),F&&F.m(P,W),C(P,w,W),C(P,L,W),ie(g,L,null),h(L,v),h(L,I),h(L,b),ie(M,L,null),C(P,A,W),C(P,y,W),T=!0},p(P,W){var he,ve,Oe,Te,ue,oe,Me,Ce,ne,be;(!T||W&4)&&s!==(s=((Oe=(ve=(he=P[2])==null?void 0:he.lead)==null?void 0:ve.first_name)!=null?Oe:"")+"")&&te(r,s),(!T||W&4)&&p!==(p=((oe=(ue=(Te=P[2])==null?void 0:Te.lead)==null?void 0:ue.last_name)!=null?oe:"")+"")&&te(c,p),(Ce=(Me=P[2])==null?void 0:Me.lead)!=null&&Ce.username?O?O.p(P,W):(O=yl(P),O.c(),O.m(_,null)):O&&(O.d(1),O=null),(be=(ne=P[2])==null?void 0:ne.lead)!=null&&be.ref_link?F?F.p(P,W):(F=kl(P),F.c(),F.m(w.parentNode,w)):F&&(F.d(1),F=null);const J={};W&1&&(J.app=P[0]),W&4&&(J.dialog_id=P[2].id),g.$set(J);const $={};W&1&&($.app=P[0]),W&4&&($.dialog_id=P[2].id),M.$set($)},i(P){T||(D(g.$$.fragment,P),D(M.$$.fragment,P),T=!0)},o(P){q(g.$$.fragment,P),q(M.$$.fragment,P),T=!1},d(P){P&&E(e),P&&E(d),P&&E(_),O&&O.d(),P&&E(m),F&&F.d(P),P&&E(w),P&&E(L),se(g),se(M),P&&E(A),P&&E(y)}}}function yl(l){let e,t=l[2].lead.username+"",n;return{c(){e=U("@"),n=U(t)},m(i,s){C(i,e,s),C(i,n,s)},p(i,s){s&4&&t!==(t=i[2].lead.username+"")&&te(n,t)},d(i){i&&E(e),i&&E(n)}}}function kl(l){var p,c;let e,t,n,i,s=((c=(p=l[2])==null?void 0:p.lead)==null?void 0:c.ref_link)+"",r,o,a,f,u;return{c(){e=k("div"),t=k("div"),t.innerHTML=`Ref link
						<img src="assets/icons/copy-clipboard.png" class="refLinkIcon svelte-qywc37" style="width: 14px; height: 14px; filter: invert(1);"/>`,n=j(),i=k("div"),r=U(s),o=j(),a=k("div"),S(t,"class","flex flex_cy h100 refLinkLabel svelte-qywc37"),S(i,"class","flex flex_cy h100 overhide textOverEllipsis nowrap refLinkContent svelte-qywc37"),S(e,"class","flex flex_cy nowrap refLink overhide textOverEllipsis cursor_ptr unselect svelte-qywc37"),R(a,"height","4px")},m(d,_){C(d,e,_),h(e,t),h(e,n),h(e,i),h(i,r),C(d,o,_),C(d,a,_),f||(u=ee(e,"click",l[6]),f=!0)},p(d,_){var m,w;_&4&&s!==(s=((w=(m=d[2])==null?void 0:m.lead)==null?void 0:w.ref_link)+"")&&te(r,s)},d(d){d&&E(e),d&&E(o),d&&E(a),f=!1,u()}}}function Ll(l){let e,t,n,i;return t=new Pe({}),{c(){e=k("div"),re(t.$$.fragment),S(e,"class","pos_abs loading svelte-qywc37")},m(s,r){C(s,e,r),ie(t,e,null),i=!0},i(s){i||(D(t.$$.fragment,s),s&&ye(()=>{n||(n=me(e,we,{},!0)),n.run(1)}),i=!0)},o(s){q(t.$$.fragment,s),s&&(n||(n=me(e,we,{},!1)),n.run(0)),i=!1},d(s){s&&E(e),se(t),s&&n&&n.end()}}}function di(l){let e,t,n,i,s=l[2]&&wl(l),r=l[1]&&Ll();return{c(){e=k("div"),t=k("div"),s&&s.c(),n=j(),r&&r.c(),S(t,"class","flex flex_clm flex_cx flex_grow_1"),S(e,"class","flex flex_cy header pos_rel svelte-qywc37")},m(o,a){C(o,e,a),h(e,t),s&&s.m(t,null),h(e,n),r&&r.m(e,null),i=!0},p(o,[a]){o[2]?s?(s.p(o,a),a&4&&D(s,1)):(s=wl(o),s.c(),D(s,1),s.m(t,null)):s&&(ae(),q(s,1,1,()=>{s=null}),fe()),o[1]?r?a&2&&D(r,1):(r=Ll(),r.c(),D(r,1),r.m(e,null)):r&&(ae(),q(r,1,1,()=>{r=null}),fe())},i(o){i||(D(s),D(r),i=!0)},o(o){q(s),q(r),i=!1},d(o){o&&E(e),s&&s.d(),r&&r.d()}}}function _i(l,e,t){let n,i,{app:s}=e;const{dialogMap_r:r}=s;pe(l,r,u=>t(5,i=u));let{dialog_id:o=null}=e,{loading:a=!1}=e;const f=()=>{var u;return _n((u=n==null?void 0:n.lead)==null?void 0:u.ref_link)};return l.$$set=u=>{"app"in u&&t(0,s=u.app),"dialog_id"in u&&t(4,o=u.dialog_id),"loading"in u&&t(1,a=u.loading)},l.$$.update=()=>{l.$$.dirty&48&&t(2,n=i[o])},[s,a,n,r,o,i,f]}class gi extends ge{constructor(e){super(),_e(this,e,_i,di,de,{app:0,dialog_id:4,loading:1})}}function Sl(l,e,t){const n=l.slice();return n[36]=e[t],n}function Tl(l,e){var s,r,o,a,f,u,p,c;let t,n,i;return n=new si({props:{render_Width:e[9],incoming:(s=e[36])==null?void 0:s.incoming,username:(a=(o=(r=e[2])==null?void 0:r.lead)==null?void 0:o.username)!=null?a:"",text:(u=(f=e[36])==null?void 0:f.text)!=null?u:"",attachments:(c=(p=e[36])==null?void 0:p.attachments)!=null?c:[]}}),{key:l,first:null,c(){t=Je(),re(n.$$.fragment),this.first=t},m(d,_){C(d,t,_),ie(n,d,_),i=!0},p(d,_){var w,L,g,v,I,b,M,A;e=d;const m={};_[0]&512&&(m.render_Width=e[9]),_[0]&8&&(m.incoming=(w=e[36])==null?void 0:w.incoming),_[0]&4&&(m.username=(v=(g=(L=e[2])==null?void 0:L.lead)==null?void 0:g.username)!=null?v:""),_[0]&8&&(m.text=(b=(I=e[36])==null?void 0:I.text)!=null?b:""),_[0]&8&&(m.attachments=(A=(M=e[36])==null?void 0:M.attachments)!=null?A:[]),n.$set(m)},i(d){i||(D(n.$$.fragment,d),i=!0)},o(d){q(n.$$.fragment,d),i=!1},d(d){d&&E(t),se(n,d)}}}function pi(l){let e,t,n,i,s,r,o,a=[],f=new Map,u,p,c,d,_,m,w,L,g,v;t=new gi({props:{app:l[0],dialog_id:l[1],loading:l[4]}});let I=l[3];const b=y=>y[36].index;for(let y=0;y<I.length;y+=1){let T=Sl(l,I,y),O=b(T);f.set(O,a[y]=Tl(O,T))}function M(y){l[16](y)}let A={value_in:l[5]};return l[6]!==void 0&&(A.value_out=l[6]),c=new Ul({props:A}),Ie.push(()=>wt(c,"value_out",M)),{c(){e=k("div"),re(t.$$.fragment),n=j(),i=k("div"),s=k("div"),r=k("div"),o=k("div");for(let y=0;y<a.length;y+=1)a[y].c();u=j(),p=k("div"),re(c.$$.fragment),_=j(),m=k("div"),w=k("textarea"),S(o,"class","pos_rel w100 h100"),S(p,"class","pos_abs h100 chatScroll svelte-13uz7b1"),S(r,"class","pos_rel w100 h100"),S(s,"class","flex pos_abs overhide"),S(i,"class","flex flex_grow_1 pos_rel overhide"),S(w,"class","flex flex_grow_1 chat_input_textarea svelte-13uz7b1"),S(m,"class","flex chat_input svelte-13uz7b1"),S(e,"class","flex flex_clm flex_grow_1 overhide")},m(y,T){C(y,e,T),ie(t,e,null),h(e,n),h(e,i),h(i,s),h(s,r),h(r,o);for(let O=0;O<a.length;O+=1)a[O].m(o,null);l[15](o),h(r,u),h(r,p),ie(c,p,null),h(e,_),h(e,m),h(m,w),qt(w,l[8]),L=!0,g||(v=[ee(r,"wheel",l[13]),Xe(rt.call(null,s,l[11])),ee(w,"input",l[17]),ee(w,"keyup",l[12])],g=!0)},p(y,T){const O={};T[0]&1&&(O.app=y[0]),T[0]&2&&(O.dialog_id=y[1]),T[0]&16&&(O.loading=y[4]),t.$set(O),T[0]&524&&(I=y[3],ae(),a=He(a,T,b,1,y,I,f,o,Ke,Tl,null,Sl),fe());const F={};T[0]&32&&(F.value_in=y[5]),!d&&T[0]&64&&(d=!0,F.value_out=y[6],vt(()=>d=!1)),c.$set(F),T[0]&256&&qt(w,y[8])},i(y){if(!L){D(t.$$.fragment,y);for(let T=0;T<I.length;T+=1)D(a[T]);D(c.$$.fragment,y),L=!0}},o(y){q(t.$$.fragment,y);for(let T=0;T<a.length;T+=1)q(a[T]);q(c.$$.fragment,y),L=!1},d(y){y&&E(e),se(t);for(let T=0;T<a.length;T+=1)a[T].d();l[15](null),se(c),g=!1,Se(v)}}}const Ml=10,et=4;function mi(l,e,t){let n,i,s,{app:r}=e;const{dialogMap_r:o}=r;pe(l,o,N=>t(14,i=N));let{dialog_id:a=null}=e,f=[],u=[],p=new Set,c=0,d=0,_=1,m=1,w=null;const L=Ee(null);pe(l,L,N=>t(26,s=N)),new Date().toJSON();let g=-1;async function v(N,x=0,P=20){const W=await g_Api.message_GetList({dialog_id:N,offset:x,limit:P});if(!!W&&n&&n.id===N){for(c=W.count;f.length<c;){const $=f.length;f.push({id:g--,index:$,_isFakeMsg:!0})}const J=W.results;J.map(($,he)=>$.index=x+he),J.map($=>f[$.index]=$)}}let I="";const b=async N=>{if(N.which===13&&(t(8,I=I.trim()),I)){const x=I;t(8,I=""),n&&await g_Api.message_Create(n.id,x)}};function M(){f=[],t(3,u=[]),p=new Set,c=0,console.log("clear all")}let A=null,y=null;async function T(N){if(!N){if(!A)return;A=null,M();return}y!==N.id&&(A=N,y=N.id,M(),f=[],t(3,u=[]),c=0,t(4,d++,d),await v(N.id),c&&await v(N.id,Math.max(c-20,0),20),await g_Api.dialog_SetReadFlagAllMessages(N.id),t(4,d--,d))}let O=1,F=!0;function V(){if(F&&requestAnimationFrame(V),!s||!w||!f.length)return;s.width;const N=s.height,x=s.width-Ml*2,P=Ml;t(9,O=Math.floor(x*.9));const W=1+m*(f.length-1);let J=Math.floor(W),$=W-J;J>=f.length&&(J=f.length-1,$=1);const he=[],ve=[];let Oe=null;t(3,u=[]);for(let ue=J-22,oe=0,Me=!0;ue<J+2;ue++)ue<0||ue>=f.length||(f[ue]._isFakeMsg&&p.add(ue),u[oe]!==f[ue]&&(Me&&(Me=!1,u.splice(oe,1e9)),t(3,u[oe]=f[ue],u),t(3,u)),t(3,u[oe]._drawIndex=oe,u),ue<J&&he.push(u[oe]),ue>J&&ve.push(u[oe]),ue===J&&(Oe=u[oe]),oe++);const Te=[...w.children];if(Te.length===u.length){Te.map((ne,be)=>{const ke=u[be];if(!ke||ne._remove)return;const Qe=ne.getBoundingClientRect();ne._bbox=Qe;const G=Math.floor(P+(ke.incoming?0:s.width*.05));ne.__cacheWidth!==O&&(ne.__cacheWidth=O,ne.style.width=O+"px"),ne.__cacheLeft!==G&&(ne.__cacheLeft=G,ne.style.left=G+"px")});const ue=(ne,be,ke=1)=>(ne.__cacheTop!==be&&(ne.__cacheTop=be,ne.style.top=be+"px"),be+(ne._bbox.height+et)*ke);let oe=0,Me=0;const Ce=Te[Oe._drawIndex];if(Ce){const ne=Ce;oe=N+et-(ne._bbox.height+et)*$,Me=oe,oe=ue(ne,oe,1)}ve.map((ne,be)=>{const ke=Te[ne._drawIndex];oe=ue(ke,oe,1)}),oe=Me,he.reverse().map((ne,be)=>{const ke=Te[ne._drawIndex];oe-=ke._bbox.height+et,ue(ke,oe,0)})}}requestAnimationFrame(V),Ve(()=>F=!1);async function H(){if(p.size){const N=[...p].sort((W,J)=>W-J);p.clear();const x=[];let P={offset:null,limit:0};for(const W of N){if(P.offset!==null){if(P.limit<=500&&P.offset+P.limit===W){P.limit++;continue}x.push(P)}P={offset:W,limit:1}}P.offset!==null&&x.push(P),n&&(t(4,d++,d),await Promise.all(x.map(W=>v(n.id,W.offset,W.limit))),t(4,d--,d))}F&&setTimeout(H,500)}H();async function z(){n&&await g_Api.dialog_SetReadFlagAllMessages(n.id),F&&setTimeout(z,5e3)}z();async function K(){n&&await v(n.id,c,20),F&&setTimeout(K,500)}K();const Y=N=>{t(5,_=f.length?m+Math.sign(N.deltaY)/(f.length-1):0)};function B(N){Ie[N?"unshift":"push"](()=>{w=N,t(7,w)})}function X(N){m=N,t(6,m)}function le(){I=this.value,t(8,I)}return l.$$set=N=>{"app"in N&&t(0,r=N.app),"dialog_id"in N&&t(1,a=N.dialog_id)},l.$$.update=()=>{l.$$.dirty[0]&16386&&t(2,n=i[a]),l.$$.dirty[0]&4&&T(n)},[r,a,n,u,d,_,m,w,I,O,o,L,b,Y,i,B,X,le]}class hi extends ge{constructor(e){super(),_e(this,e,mi,pi,de,{app:0,dialog_id:1},null,[-1,-1])}}function vi(l){let e,t,n,i,s,r,o,a,f,u,p,c,d,_,m,w;function L(v){l[6](v)}let g={app:l[0]};return l[1]!==void 0&&(g.filterTag=l[1]),a=new li({props:g}),Ie.push(()=>wt(a,"filterTag",L)),p=new $n({props:{app:l[0],filter:{filterTag:l[1],filterUnreadFirst:l[2]}}}),d=new hi({props:{app:l[0],dialog_id:l[3]}}),{c(){e=k("div"),t=k("div"),n=k("div"),i=k("button"),s=U("UF:"),r=U(l[2]),o=j(),re(a.$$.fragment),u=j(),re(p.$$.fragment),c=j(),re(d.$$.fragment),S(i,"class","pos_abs cursor_ptr"),R(i,"right","1px"),R(i,"background","#484848"),R(i,"color","#000"),S(n,"class","flex flex_cx flex_cy header pos_rel svelte-b47b5y"),S(t,"class","flex flex_clm list svelte-b47b5y"),S(e,"class","flex flex_grow_1")},m(v,I){C(v,e,I),h(e,t),h(t,n),h(n,i),h(i,s),h(i,r),h(t,o),ie(a,t,null),h(t,u),ie(p,t,null),h(e,c),ie(d,e,null),_=!0,m||(w=ee(i,"click",l[5]),m=!0)},p(v,[I]){(!_||I&4)&&te(r,v[2]);const b={};I&1&&(b.app=v[0]),!f&&I&2&&(f=!0,b.filterTag=v[1],vt(()=>f=!1)),a.$set(b);const M={};I&1&&(M.app=v[0]),I&6&&(M.filter={filterTag:v[1],filterUnreadFirst:v[2]}),p.$set(M);const A={};I&1&&(A.app=v[0]),I&8&&(A.dialog_id=v[3]),d.$set(A)},i(v){_||(D(a.$$.fragment,v),D(p.$$.fragment,v),D(d.$$.fragment,v),_=!0)},o(v){q(a.$$.fragment,v),q(p.$$.fragment,v),q(d.$$.fragment,v),_=!1},d(v){v&&E(e),se(a),se(p),se(d),m=!1,w()}}}function bi(l,e,t){let n,{app:i}=e;const{dialogActiveID_r:s}=i;pe(l,s,u=>t(3,n=u));let r=null,o=1;const a=()=>t(2,o^=1);function f(u){r=u,t(1,r)}return l.$$set=u=>{"app"in u&&t(0,i=u.app)},[i,r,o,n,s,a,f]}class wi extends ge{constructor(e){super(),_e(this,e,bi,vi,de,{app:0})}}function yi(l){let e,t,n,i,s,r,o,a;return n=new Hn({props:{app:l[0]}}),s=new Un({props:{app:l[0]}}),o=new wi({props:{app:l[0]}}),{c(){e=k("div"),t=k("div"),re(n.$$.fragment),i=j(),re(s.$$.fragment),r=j(),re(o.$$.fragment),S(t,"class","flex flex_clm flex_grow_1 leftBlock svelte-ufyhtq"),S(e,"class","flex w100 h100 pos_rel")},m(f,u){C(f,e,u),h(e,t),ie(n,t,null),h(t,i),ie(s,t,null),h(e,r),ie(o,e,null),a=!0},p:Z,i(f){a||(D(n.$$.fragment,f),D(s.$$.fragment,f),D(o.$$.fragment,f),a=!0)},o(f){q(n.$$.fragment,f),q(s.$$.fragment,f),q(o.$$.fragment,f),a=!1},d(f){f&&E(e),se(n),se(s),se(o)}}}function ki(l,e,t){let{operatorSelf:n}=e,{config:i}=e;const s=vn(n,i);return Ve(s.destroy),l.$$set=r=>{"operatorSelf"in r&&t(1,n=r.operatorSelf),"config"in r&&t(2,i=r.config)},[s,n,i]}class Li extends ge{constructor(e){super(),_e(this,e,ki,yi,de,{operatorSelf:1,config:2})}}function Il(l,e,t){const n=l.slice();return n[5]=e[t],n}function Si(l){let e,t,n=l[0],i=[];for(let r=0;r<n.length;r+=1)i[r]=Al(Il(l,n,r));const s=r=>q(i[r],1,1,()=>{i[r]=null});return{c(){for(let r=0;r<i.length;r+=1)i[r].c();e=Je()},m(r,o){for(let a=0;a<i.length;a+=1)i[a].m(r,o);C(r,e,o),t=!0},p(r,o){if(o&5){n=r[0];let a;for(a=0;a<n.length;a+=1){const f=Il(r,n,a);i[a]?(i[a].p(f,o),D(i[a],1)):(i[a]=Al(f),i[a].c(),D(i[a],1),i[a].m(e.parentNode,e))}for(ae(),a=n.length;a<i.length;a+=1)s(a);fe()}},i(r){if(!t){for(let o=0;o<n.length;o+=1)D(i[o]);t=!0}},o(r){i=i.filter(Boolean);for(let o=0;o<i.length;o+=1)q(i[o]);t=!1},d(r){Hl(i,r),r&&E(e)}}}function Ti(l){let e,t,n,i,s;return i=new Pe({}),{c(){e=k("div"),t=k("div"),n=j(),re(i.$$.fragment),R(t,"height","20px"),S(e,"class","flex flex_clm flex_grow_1 flex_cy")},m(r,o){C(r,e,o),h(e,t),h(e,n),ie(i,e,null),s=!0},p:Z,i(r){s||(D(i.$$.fragment,r),s=!0)},o(r){q(i.$$.fragment,r),s=!1},d(r){r&&E(e),se(i)}}}function Ol(l){let e,t,n=l[5].username+"",i;return{c(){e=k("div"),t=U("@"),i=U(n),S(e,"class","nowrap textOverEllipsis")},m(s,r){C(s,e,r),h(e,t),h(e,i)},p(s,r){r&1&&n!==(n=s[5].username+"")&&te(i,n)},d(s){s&&E(e)}}}function Al(l){var v,I;let e,t,n,i=((v=l[5].first_name)!=null?v:"")+"",s,r,o,a,f,u=((I=l[5].last_name)!=null?I:"")+"",p,c,d,_,m,w,L,g=l[5].username&&Ol(l);return{c(){e=k("div"),t=k("div"),n=k("div"),s=U(i),r=j(),o=k("div"),a=j(),f=k("div"),p=U(u),c=j(),g&&g.c(),d=j(),R(o,"width","8px"),S(t,"class","flex nowrap textOverEllipsis"),S(e,"class","flex flex_clm cursor_ptr item unselect svelte-1n771m2")},m(b,M){C(b,e,M),h(e,t),h(t,n),h(n,s),h(t,r),h(t,o),h(t,a),h(t,f),h(f,p),h(e,c),g&&g.m(e,null),h(e,d),m=!0,w||(L=ee(e,"click",function(){je(l[2](l[5]))&&l[2](l[5]).apply(this,arguments)}),w=!0)},p(b,M){var A,y;l=b,(!m||M&1)&&i!==(i=((A=l[5].first_name)!=null?A:"")+"")&&te(s,i),(!m||M&1)&&u!==(u=((y=l[5].last_name)!=null?y:"")+"")&&te(p,u),l[5].username?g?g.p(l,M):(g=Ol(l),g.c(),g.m(e,d)):g&&(g.d(1),g=null)},i(b){m||(b&&ye(()=>{_||(_=me(e,we,{},!0)),_.run(1)}),m=!0)},o(b){b&&(_||(_=me(e,we,{},!1)),_.run(0)),m=!1},d(b){b&&E(e),g&&g.d(),b&&_&&_.end(),w=!1,L()}}}function Mi(l){let e,t,n,i;const s=[Ti,Si],r=[];function o(a,f){return a[1]?0:1}return t=o(l),n=r[t]=s[t](l),{c(){e=k("div"),n.c(),S(e,"class","flex list flex_grow_1 svelte-1n771m2")},m(a,f){C(a,e,f),r[t].m(e,null),i=!0},p(a,[f]){let u=t;t=o(a),t===u?r[t].p(a,f):(ae(),q(r[u],1,1,()=>{r[u]=null}),fe(),n=r[t],n?n.p(a,f):(n=r[t]=s[t](a),n.c()),D(n,1),n.m(e,null))},i(a){i||(D(n),i=!0)},o(a){q(n),i=!1},d(a){a&&E(e),r[t].d()}}}function Ii(l,e,t){let n=[],i=!1;const s=async()=>{var a;t(1,i=!0),t(0,n=[]);try{const f=await g_Api("GET","operators");t(0,n=(a=f.results)!=null?a:[])}catch{}t(1,i=!1)};let r=!1;const o=a=>f=>{r||(Bl(a),r=!0)};return s(),[n,i,o]}class Oi extends ge{constructor(e){super(),_e(this,e,Ii,Mi,de,{})}}function Ai(l){let e,t,n,i,s;return t=new Li({props:{operatorSelf:l[0],config:g_Config}}),{c(){e=k("div"),re(t.$$.fragment),S(e,"class","pos_rel flex")},m(r,o){C(r,e,o),ie(t,e,null),n=!0,i||(s=Xe(rt.call(null,e)),i=!0)},p(r,o){const a={};o&1&&(a.operatorSelf=r[0]),t.$set(a)},i(r){n||(D(t.$$.fragment,r),n=!0)},o(r){q(t.$$.fragment,r),n=!1},d(r){r&&E(e),se(t),i=!1,s()}}}function Di(l){let e,t,n,i,s;return e=new yn({props:{select:"operators"}}),i=new Oi({}),{c(){re(e.$$.fragment),t=j(),n=k("div"),re(i.$$.fragment),S(n,"class","flex")},m(r,o){ie(e,r,o),C(r,t,o),C(r,n,o),ie(i,n,null),s=!0},p:Z,i(r){s||(D(e.$$.fragment,r),D(i.$$.fragment,r),s=!0)},o(r){q(e.$$.fragment,r),q(i.$$.fragment,r),s=!1},d(r){se(e,r),r&&E(t),r&&E(n),se(i)}}}function Ei(l){let e,t,n,i,s,r;const o=[Di,Ai],a=[];function f(u,p){return u[0]?1:0}return t=f(l),n=a[t]=o[t](l),s=new Ln({}),{c(){e=k("main"),n.c(),i=j(),re(s.$$.fragment),S(e,"class","flex flex_clm flex_grow_1 pos_rel overhide svelte-116f09r")},m(u,p){C(u,e,p),a[t].m(e,null),h(e,i),ie(s,e,null),r=!0},p(u,[p]){let c=t;t=f(u),t===c?a[t].p(u,p):(ae(),q(a[c],1,1,()=>{a[c]=null}),fe(),n=a[t],n?n.p(u,p):(n=a[t]=o[t](u),n.c()),D(n,1),n.m(e,i))},i(u){r||(D(n),D(s.$$.fragment,u),r=!0)},o(u){q(n),q(s.$$.fragment,u),r=!1},d(u){u&&E(e),a[t].d(),se(s)}}}function ji(){const l=r=>new Promise(o=>setTimeout(o,r)),t=(()=>{const r=()=>l(1500+(Math.random()*200|0)),o={id:1};let a=0;const f={tg_id:123123124,username:"123124123",first_name:"test",last_name:"ewr",date_joined:"2022-10-27T13:48:51.054781Z",esub:"123123",pub_id:"2312",refcode:"123123",subpub:"23123",hasOperator:!1,ref_link:"https://ref.global.com/getRef?tg_id=1232132"};let u=[];const p=b=>u.find(M=>String(M.tg_id)===String(b)),c=()=>{const b={...f};b.tg_id+=a,b.first_name+=" "+a,b.last_name+=" "+a,b.date_joined=new Date().toJSON(),b.username=[b.first_name,b.last_name].map(M=>M.trim()).filter(Boolean).join(" ").replace(/\s/g,"_"),a++,u.push(b)},d=()=>[...u],_=()=>d().filter(b=>!b.hasOperator),m=(b,M)=>{var F;const A=M.offset|0,y=Math.max(1,Math.min(1e6,((F=M.limit)!=null?F:20)|0)),T=b.length,O=b.slice(A).slice(0,y);return{count:T,results:O}},w={},L={};let g=1,v=1;const I=b=>(b!=null?b:[]).map(M=>({...M,id:v++}));return Array(1e4).fill().map(c),setInterval(()=>{},2400),setInterval(()=>{},3e3),setInterval(()=>{const b=Object.keys(L),M=b[b.length*Math.random()|0],A=L[M];if(A){const y=A.length?0:10;for(let T=0;T<y;T++)A.push({id:g++,dialog:M,text:Math.random()<.5?"Hi. And short message "+(g-1)+" ...":"Hi. And long message "+(g-1)+" ..."+`
 Long!`.repeat(20),is_read:!1,incoming:!0,received_at:new Date().toJSON(),attachments:[]})}},1e3),async(b,M,A={})=>{var y,T,O,F,V,H,z,K;if(await r(),b==="GET"&&M==="operators")return{results:[{username:"stan18k",first_name:"Stanislav",last_name:"Kulakov"},{username:"dmodev",first_name:"Demon",last_name:"Dev"},{username:"idandrey",first_name:"Andrey",last_name:""},{username:"eveascigarettesnbeer",first_name:"YEHA",last_name:""},{username:"eveascigarettesnbeer ".repeat(1e3),first_name:"YEHA",last_name:""},{username:"eveascigarettesnbeer",first_name:"YEHA",last_name:""},{username:"eveascigarettesnbeer",first_name:"YEHA",last_name:""},{username:"eveascigarettesnbeer",first_name:"YEHA",last_name:""},{username:"eveascigarettesnbeer",first_name:"YEHA",last_name:""},{username:"eveascigarettesnbeer ".repeat(1e3),first_name:"YEHA ".repeat(1e3),last_name:"D sf  ".repeat(1e3)}]};if(b==="GET"&&M==="leads/unassigned")return m(_(),A);if(b==="POST"&&/leads\/\d+\/assign/.test(M)){const Y=(y=M.match(/leads\/(\d+)\/assign/))==null?void 0:y[1],B=n["x-username"];if(!Y||!B)return!1;const X=p(Y);if(!X||X.hasOperator)return!1;X.hasOperator=!0,o.id++;const le={...o,lead_id:Y,lead:X,operator:B,tag:I([g_Config.pinnedTags[0]])};return w[B]=(T=w[B])!=null?T:[],w[B].push(le),L[le.id]=[],!0}if(b==="GET"&&M==="dialogs"){let Y=[...(O=w[n["x-username"]])!=null?O:[]].map(B=>({...B,lead:p(B.lead_id)}));return A.tag&&(Y=Y.filter(B=>B.tag.map(X=>X.title).includes(A.tag))),m(Y,A)}if(b==="PATCH"&&/dialogs\/\d+/.test(M)){const Y=((V=(F=M.match(/dialogs\/(\d+)/))==null?void 0:F[1])!=null?V:-1)|0,B=n["x-username"],le=((H=w[B])!=null?H:[]).find(N=>N.id===Y);return le&&A.tag&&(le.tag=I(A.tag)),le}if(b==="GET"&&M==="messages"){const Y=L[A.dialog_id]=(z=L[A.dialog_id])!=null?z:[];return m(Y,A)}if(b==="POST"&&M==="messages")return L[A.dialog]=(K=L[A.dialog])!=null?K:[],L[A.dialog].push({id:g++,dialog:A.dialog,text:A.text,is_read:!!A.is_read,incoming:!1,received_at:new Date().toJSON()}),!0}})(),n={"Content-Type":"application/json"},i=async(r,o,a={},f=0,u=!0)=>{var v,I,b;if(!location.hash.match(/real\-api/)){const M=await t(r,o,a);if(f===0)return M;if(f===1)return{status:200,json:()=>M}}const c=g_Config.api,d=(v=c.protocol)!=null?v:location.protocol,_=(I=c.host)!=null?I:location.host,m=(b=c.path_base)!=null?b:"/",w=new URL(`${d}//${_}/${m}`);r==="GET"&&Object.entries(a).map(([M,A])=>w.searchParams.append(M,A)),w.pathname=[w.pathname,o].join("/").split("/").filter(Boolean).concat(u?" ":"").filter(Boolean).join("/").trim();let L;(r==="POST"||r==="PATCH"||r==="PUT")&&(L=JSON.stringify(a));const g=await fetch(w,{method:r,headers:n,body:L});if(f===0)return await g.json();if(f===1)return g},s=r=>{var a,f,u;const o=(u=(a=r==null?void 0:r.last_message)==null?void 0:a.received_at)!=null?u:(f=r==null?void 0:r.lead)==null?void 0:f.date_joined;return{...r,_lastTime:o?+new Date(o):null}};return i.message_GetList=async r=>{try{const o=await g_Api("GET","messages",r,1);if(o.status===200)return await o.json()}catch(o){console.error(o.message)}},i.message_Create=async(r,o)=>{try{const a=await g_Api("POST","messages",{dialog:r,text:o,is_read:!0},1);if(a.status===200)return await a.json()}catch(a){console.error(a.message)}return null},i.dialog_SetTags=async(r,o)=>{try{const a=await g_Api("PATCH",`dialogs/${r}`,{tag:o},1);if(a.status===200)return await a.json()}catch(a){console.error(a.message)}return null},i.dialog_GetList=async r=>{try{const o=await g_Api("GET","dialogs",r,1);if(o.status===200){const a=await o.json();return a.results=a.results.map(s),a}}catch(o){console.error(o.message)}return null},i.dialog_SetReadFlagAllMessages=async r=>{try{const o=await g_Api("POST",`dialogs/${r}/read`,{},1);if(o.status===200||o.status===204)return!0}catch(o){console.log(o.message)}return!1},i.lead_GetUnassignedList=async r=>{try{const o=await g_Api("GET","leads/unassigned",r,1);if(o.status===200)return await o.json()}catch(o){console.error(o.message)}return null},i.lead_AssignOperatorSelft=async r=>{try{const o=await g_Api("POST",`leads/${r}/assign`,{},1),a=await o.json();if(o.status===200)return!0;if(o.status===400)return!1}catch(o){console.error(o.message)}return null},i.lead_SetStatus=async(r,o)=>{try{const a=await g_Api("PATCH",`leads/${r}`,{status:o},1);if(a.status===200)return await a.json()}catch(a){console.error(a.message)}return null},i.operatorSelf_GetOnlineInfo=async()=>{try{const r=await g_Api("GET","online",{},1,!1);if(r.status===200)return await r.json()}catch(r){console.error(r.message)}return null},i.setHeader=(r,o)=>{n[r]=o,o==null&&delete n[r]},i}function Ci(l,e,t){let n;return pe(l,yt,i=>t(0,n=i)),globalThis.g_Api=ji(),[n]}class qi extends ge{constructor(e){super(),_e(this,e,Ci,Ei,de,{})}}new qi({target:document.getElementById("app")});
